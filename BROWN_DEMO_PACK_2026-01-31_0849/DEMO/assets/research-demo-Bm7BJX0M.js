var $i=Object.defineProperty;var Yi=(t,f,n)=>f in t?$i(t,f,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[f]=n;var Ce=(t,f,n)=>Yi(t,typeof f!="symbol"?f+"":f,n);import{c as Qe,r as J,j as e,p as ht,q as Ki,X as Di,d as zi,i as Ze,F as at,k as bt,b as Ue,C as Rt,U as gt,I as pt,g as rt,P as tt,B as Ke,Z as Oi,a as De,A as je,n as lt,L as vt,m as Xe,S as nt,e as Tt,D as kt,f as Ni,H as Zi,T as qi,R as mt,l as Xi,h as Qi,o as Ji}from"./zap-S11i9ads.js";/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Et=Qe("BookOpen",[["path",{d:"M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z",key:"vv98re"}],["path",{d:"M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z",key:"1cyq3y"}]]);/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mi=Qe("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bi=Qe("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ut=Qe("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Li=Qe("Gavel",[["path",{d:"m14.5 12.5-8 8a2.119 2.119 0 1 1-3-3l8-8",key:"15492f"}],["path",{d:"m16 16 6-6",key:"vzrcl6"}],["path",{d:"m8 8 6-6",key:"18bi4p"}],["path",{d:"m9 7 8 8",key:"5jnvq1"}],["path",{d:"m21 11-8-8",key:"z4y7zo"}]]);/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pi=Qe("Link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]);/**
 * @license lucide-react v0.312.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const en=Qe("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]),ot={Standard:{center:.5,width:1},"High Contrast":{center:.45,width:.7},"Soft Tissue":{center:.55,width:1.2},Dense:{center:.4,width:.6},Inverted:{center:.5,width:-1}},Ri={RCC:"/images/inbreast/20586908_6c613a14b80a8591_MG_R_CC_ANON.png",LCC:"/images/inbreast/20586934_6c613a14b80a8591_MG_L_CC_ANON.png"},Ct=({leftImage:t,rightImage:f,leftLabel:n="L CC",rightLabel:g="R CC",showAI:c=!1,showAIOverlay:r=!1,aiConfidence:o=87,onInteraction:i,onZoom:u,onPan:b,onToolChange:a,onWLPresetChange:y,onOverlayToggle:v})=>{const p=J.useRef(null),[m,l]=J.useState(1),[x,h]=J.useState({x:0,y:0}),[C,E]=J.useState(ot.Standard),[D,j]=J.useState("Standard"),[_,N]=J.useState(null),[H,T]=J.useState(!1),[G,ne]=J.useState({x:0,y:0}),[A,W]=J.useState(!1),[d,w]=J.useState(!0),[Q,Y]=J.useState("PAN"),[le,Z]=J.useState({box:!0,contour:!1,heatmap:!1}),[ie,L]=J.useState(null),[B,re]=J.useState(null),[te,q]=J.useState([]),[de,be]=J.useState(null),ue={left:t||Ri.LCC,right:f||Ri.RCC},he=J.useCallback(z=>{j(z),E(ot[z]),y==null||y(z),i==null||i("WL_PRESET_CHANGED",{preset:z,values:ot[z]})},[y,i]),Se=J.useCallback(z=>{Y(z),a==null||a(z),i==null||i("TOOL_CHANGED",{tool:z}),z!=="MEASURE"&&(L(null),re(null))},[a,i]),ge=J.useCallback(z=>{Z(ee=>{const $={...ee,[z]:!ee[z]};return v==null||v(z,$[z]),i==null||i("OVERLAY_TOGGLED",{overlay:z,enabled:$[z]}),$})},[v,i]);J.useEffect(()=>{const z=p.current;if(!z)return;const ee=$=>{$.preventDefault(),$.stopPropagation();const X=Math.max(.5,Math.min(4,m*($.deltaY>0?.9:1.1)));l(X),u==null||u(),i==null||i("ZOOM_CHANGED",{zoom:X,method:"wheel"})};return z.addEventListener("wheel",ee,{passive:!1}),()=>z.removeEventListener("wheel",ee)},[m,u,i]);const Ie=J.useCallback((z,ee)=>{z.preventDefault(),N(ee);const $=z.currentTarget.getBoundingClientRect(),X=z.clientX-$.left,oe=z.clientY-$.top;if(Q==="MEASURE"){if(!ie)L({x:X,y:oe}),i==null||i("MEASURE_STARTED",{x:X,y:oe,view:ee});else{const ce=Math.sqrt(Math.pow(X-ie.x,2)+Math.pow(oe-ie.y,2)),ae=Math.round(ce*.26);q(_e=>[..._e,{start:ie,end:{x:X,y:oe},distance:ae}]),i==null||i("MEASURE_COMPLETED",{start:ie,end:{x:X,y:oe},distanceMm:ae}),L(null),re(null)}return}Q==="ROI"&&(be({x:X,y:oe,w:0,h:0}),i==null||i("ROI_STARTED",{x:X,y:oe,view:ee})),T(!0),ne({x:z.clientX,y:z.clientY}),W(z.button===2),i==null||i("VIEW_FOCUSED",{view:ee})},[Q,ie,i]),Ae=J.useCallback(z=>{if(Q==="MEASURE"&&ie){const X=z.currentTarget.getBoundingClientRect();re({x:z.clientX-X.left,y:z.clientY-X.top})}if(Q==="ROI"&&de&&H){const X=z.currentTarget.getBoundingClientRect(),oe=z.clientX-X.left,ce=z.clientY-X.top;be(ae=>ae?{...ae,w:oe-ae.x,h:ce-ae.y}:null)}if(!H||Q!=="PAN")return;const ee=z.clientX-G.x,$=z.clientY-G.y;A?(E(X=>({center:Math.max(0,Math.min(1,X.center+$*.002)),width:X.width>0?Math.max(.1,Math.min(2,X.width+ee*.002)):Math.min(-.1,Math.max(-2,X.width+ee*.002))})),j("Standard")):(h(X=>({x:X.x+ee,y:X.y+$})),b==null||b()),ne({x:z.clientX,y:z.clientY})},[H,G,A,b,Q,ie,de]),s=J.useCallback(()=>{Q==="ROI"&&de&&de.w!==0&&(i==null||i("ROI_COMPLETED",{x:de.x,y:de.y,width:Math.abs(de.w),height:Math.abs(de.h)})),T(!1)},[Q,de,i]),V=J.useCallback(()=>{l(1),h({x:0,y:0}),E(ot.Standard),j("Standard"),q([]),be(null),L(null),re(null),i==null||i("VIEW_RESET",{})},[i]),U=J.useCallback(()=>{const z=Math.min(4,m*1.2);l(z),u==null||u()},[m,u]),I=J.useCallback(()=>{const z=Math.max(.5,m*.8);l(z),u==null||u()},[m,u]),S=C.center,k=Math.abs(C.width),F=C.width<0,O=c||r,M=(z,ee,$)=>{const X=O&&z==="right";return e.jsxs("div",{onMouseDown:oe=>Ie(oe,z),onMouseMove:Ae,onMouseUp:s,onMouseLeave:s,onContextMenu:oe=>oe.preventDefault(),style:{position:"relative",backgroundColor:"#000",borderRadius:4,overflow:"hidden",cursor:Q==="MEASURE"?"crosshair":Q==="ROI"?"cell":"grab",aspectRatio:"3/4",border:_===z?"2px solid #3b82f6":"2px solid transparent"},children:[e.jsx("div",{style:{position:"absolute",top:8,left:8,backgroundColor:"rgba(0,0,0,0.85)",color:"#fff",padding:"4px 10px",borderRadius:4,fontSize:12,fontFamily:"monospace",fontWeight:"bold",zIndex:10},children:$}),e.jsx("div",{style:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",transform:`scale(${m}) translate(${x.x/m}px, ${x.y/m}px)`,filter:`brightness(${S}) contrast(${k}) ${F?"invert(1)":""}`,transition:H?"none":"transform 0.1s"},children:e.jsx("img",{src:ee,alt:$,style:{maxWidth:"100%",maxHeight:"100%",objectFit:"contain",pointerEvents:"none"},draggable:!1})}),X&&e.jsxs(e.Fragment,{children:[le.box&&e.jsx("div",{style:{position:"absolute",top:"30%",right:"25%",width:80,height:80,border:"2px solid #a855f7",backgroundColor:"transparent",borderRadius:4,zIndex:5,boxShadow:"0 0 15px rgba(168,85,247,0.5)"},children:e.jsxs("div",{style:{position:"absolute",top:-24,left:0,backgroundColor:"rgba(0,0,0,0.9)",color:"#a855f7",padding:"4px 10px",borderRadius:4,fontSize:12,fontWeight:"bold"},children:["AI: ",o,"%"]})}),le.contour&&e.jsx("svg",{style:{position:"absolute",inset:0,pointerEvents:"none",zIndex:6},children:e.jsx("ellipse",{cx:"75%",cy:"35%",rx:"45",ry:"55",fill:"none",stroke:"#22c55e",strokeWidth:"2",strokeDasharray:"5,3",opacity:"0.8"})}),le.heatmap&&e.jsx("div",{style:{position:"absolute",top:"25%",right:"20%",width:100,height:100,background:"radial-gradient(ellipse at center, rgba(239,68,68,0.6) 0%, rgba(239,68,68,0.3) 40%, rgba(251,191,36,0.2) 70%, transparent 100%)",borderRadius:"50%",zIndex:4,filter:"blur(8px)"}})]}),e.jsxs("svg",{style:{position:"absolute",inset:0,pointerEvents:"none",zIndex:15},children:[te.map((oe,ce)=>e.jsxs("g",{children:[e.jsx("line",{x1:oe.start.x,y1:oe.start.y,x2:oe.end.x,y2:oe.end.y,stroke:"#fbbf24",strokeWidth:"2"}),e.jsx("circle",{cx:oe.start.x,cy:oe.start.y,r:"4",fill:"#fbbf24"}),e.jsx("circle",{cx:oe.end.x,cy:oe.end.y,r:"4",fill:"#fbbf24"}),e.jsxs("text",{x:(oe.start.x+oe.end.x)/2,y:(oe.start.y+oe.end.y)/2-8,fill:"#fbbf24",fontSize:"12",fontWeight:"bold",textAnchor:"middle",children:[oe.distance,"mm"]})]},ce)),ie&&B&&e.jsxs("g",{children:[e.jsx("line",{x1:ie.x,y1:ie.y,x2:B.x,y2:B.y,stroke:"#fbbf24",strokeWidth:"2",strokeDasharray:"5,5"}),e.jsx("circle",{cx:ie.x,cy:ie.y,r:"4",fill:"#fbbf24"})]})]}),de&&de.w!==0&&e.jsx("div",{style:{position:"absolute",left:de.w>0?de.x:de.x+de.w,top:de.h>0?de.y:de.y+de.h,width:Math.abs(de.w),height:Math.abs(de.h),border:"2px dashed #22d3ee",backgroundColor:"rgba(34, 211, 238, 0.1)",zIndex:15}}),m!==1&&e.jsxs("div",{style:{position:"absolute",bottom:8,left:8,backgroundColor:"rgba(0,0,0,0.8)",color:"#9ca3af",padding:"3px 8px",borderRadius:4,fontSize:11,fontFamily:"monospace"},children:[Math.round(m*100),"%"]})]},z)};return e.jsxs("div",{ref:p,style:{backgroundColor:"#111827",borderRadius:8,overflow:"hidden",border:"1px solid #374151"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 12px",backgroundColor:"#1f2937",borderBottom:"1px solid #374151",flexWrap:"wrap",gap:"8px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx("span",{style:{color:"#6b7280",fontSize:10,marginRight:4,fontWeight:600},children:"TOOLS:"}),["PAN","MEASURE","ROI"].map(z=>e.jsxs("button",{onClick:()=>Se(z),style:{padding:"5px 10px",backgroundColor:Q===z?"#3b82f6":"#374151",border:"none",borderRadius:4,color:Q===z?"white":"#d1d5db",cursor:"pointer",fontSize:11,fontWeight:Q===z?600:400,display:"flex",alignItems:"center",gap:4},children:[z==="PAN"&&"Pan",z==="MEASURE"&&"Measure",z==="ROI"&&"⬜",z]},z))]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx("span",{style:{color:"#6b7280",fontSize:10,marginRight:4,fontWeight:600},children:"W/L:"}),Object.keys(ot).map(z=>e.jsxs("button",{onClick:()=>he(z),style:{padding:"5px 8px",backgroundColor:D===z?"#7c3aed":"#374151",border:"none",borderRadius:4,color:D===z?"white":"#d1d5db",cursor:"pointer",fontSize:10,fontWeight:D===z?600:400},children:[z==="Inverted"?"◐":""," ",z]},z))]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx("button",{onClick:I,style:{padding:"5px 10px",backgroundColor:"#374151",border:"none",borderRadius:4,color:"#d1d5db",cursor:"pointer",fontSize:14,fontWeight:"bold"},children:"−"}),e.jsxs("span",{style:{color:"#9ca3af",fontSize:11,width:45,textAlign:"center",fontFamily:"monospace"},children:[Math.round(m*100),"%"]}),e.jsx("button",{onClick:U,style:{padding:"5px 10px",backgroundColor:"#374151",border:"none",borderRadius:4,color:"#d1d5db",cursor:"pointer",fontSize:14,fontWeight:"bold"},children:"+"}),e.jsx("div",{style:{width:1,height:20,backgroundColor:"#4b5563",margin:"0 4px"}}),e.jsx("button",{onClick:V,style:{padding:"5px 10px",backgroundColor:"#374151",border:"none",borderRadius:4,color:"#d1d5db",cursor:"pointer",fontSize:11},children:"↺ Reset"}),e.jsx("button",{onClick:()=>w(z=>!z),style:{padding:"5px 10px",backgroundColor:d?"#2563eb":"#374151",border:"none",borderRadius:4,color:"#fff",cursor:"pointer",fontSize:11},children:d?"Linked":"Unlinked"})]})]}),O&&e.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"6px 12px",backgroundColor:"#1e1b4b",borderBottom:"1px solid #4338ca",gap:"12px"},children:[e.jsx("span",{style:{color:"#a5b4fc",fontSize:10,fontWeight:600},children:"AI OVERLAYS:"}),["box","contour","heatmap"].map(z=>e.jsxs("button",{onClick:()=>ge(z),style:{padding:"4px 10px",backgroundColor:le[z]?"#7c3aed":"#374151",border:le[z]?"1px solid #a855f7":"1px solid #4b5563",borderRadius:4,color:le[z]?"white":"#9ca3af",cursor:"pointer",fontSize:10,fontWeight:le[z]?600:400,textTransform:"capitalize"},children:[z==="box"&&"⬜",z==="contour"&&"◯",z==="heatmap"&&"Heatmap"," ",z]},z)),e.jsxs("div",{style:{marginLeft:"auto",color:"#818cf8",fontSize:10},children:["Confidence: ",e.jsxs("strong",{children:[o,"%"]})]})]}),e.jsx("div",{style:{padding:8,backgroundColor:"#0f172a"},children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8},children:[M("left",ue.left,n),M("right",ue.right,g)]})}),e.jsxs("div",{style:{padding:"8px 12px",backgroundColor:"#1f2937",borderTop:"1px solid #374151",display:"flex",justifyContent:"space-between",alignItems:"center",fontSize:10,color:"#9ca3af"},children:[e.jsxs("div",{style:{display:"flex",gap:16},children:[e.jsxs("span",{children:[e.jsx("strong",{children:"Pan:"})," Left-drag"]}),e.jsxs("span",{children:[e.jsx("strong",{children:"W/L:"})," Right-drag"]}),e.jsxs("span",{children:[e.jsx("strong",{children:"Zoom:"})," Scroll"]}),Q==="MEASURE"&&e.jsxs("span",{style:{color:"#fbbf24"},children:[e.jsx("strong",{children:"Measure:"})," Click two points"]}),Q==="ROI"&&e.jsxs("span",{style:{color:"#22d3ee"},children:[e.jsx("strong",{children:"⬜ ROI:"})," Click and drag"]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[te.length>0&&e.jsxs("span",{style:{color:"#fbbf24"},children:[te.length," measurement",te.length>1?"s":""]}),e.jsx("span",{style:{color:"#f59e0b"},children:"Research simulation"})]})]})]})};function ft(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Fi={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(t,f){(function(n){t.exports=n()})(function(){return function n(g,c,r){function o(b,a){if(!c[b]){if(!g[b]){var y=typeof ft=="function"&&ft;if(!a&&y)return y(b,!0);if(i)return i(b,!0);var v=new Error("Cannot find module '"+b+"'");throw v.code="MODULE_NOT_FOUND",v}var p=c[b]={exports:{}};g[b][0].call(p.exports,function(m){var l=g[b][1][m];return o(l||m)},p,p.exports,n,g,c,r)}return c[b].exports}for(var i=typeof ft=="function"&&ft,u=0;u<r.length;u++)o(r[u]);return o}({1:[function(n,g,c){var r=n("./utils"),o=n("./support"),i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";c.encode=function(u){for(var b,a,y,v,p,m,l,x=[],h=0,C=u.length,E=C,D=r.getTypeOf(u)!=="string";h<u.length;)E=C-h,y=D?(b=u[h++],a=h<C?u[h++]:0,h<C?u[h++]:0):(b=u.charCodeAt(h++),a=h<C?u.charCodeAt(h++):0,h<C?u.charCodeAt(h++):0),v=b>>2,p=(3&b)<<4|a>>4,m=1<E?(15&a)<<2|y>>6:64,l=2<E?63&y:64,x.push(i.charAt(v)+i.charAt(p)+i.charAt(m)+i.charAt(l));return x.join("")},c.decode=function(u){var b,a,y,v,p,m,l=0,x=0,h="data:";if(u.substr(0,h.length)===h)throw new Error("Invalid base64 input, it looks like a data url.");var C,E=3*(u=u.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(u.charAt(u.length-1)===i.charAt(64)&&E--,u.charAt(u.length-2)===i.charAt(64)&&E--,E%1!=0)throw new Error("Invalid base64 input, bad content length.");for(C=o.uint8array?new Uint8Array(0|E):new Array(0|E);l<u.length;)b=i.indexOf(u.charAt(l++))<<2|(v=i.indexOf(u.charAt(l++)))>>4,a=(15&v)<<4|(p=i.indexOf(u.charAt(l++)))>>2,y=(3&p)<<6|(m=i.indexOf(u.charAt(l++))),C[x++]=b,p!==64&&(C[x++]=a),m!==64&&(C[x++]=y);return C}},{"./support":30,"./utils":32}],2:[function(n,g,c){var r=n("./external"),o=n("./stream/DataWorker"),i=n("./stream/Crc32Probe"),u=n("./stream/DataLengthProbe");function b(a,y,v,p,m){this.compressedSize=a,this.uncompressedSize=y,this.crc32=v,this.compression=p,this.compressedContent=m}b.prototype={getContentWorker:function(){var a=new o(r.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new u("data_length")),y=this;return a.on("end",function(){if(this.streamInfo.data_length!==y.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),a},getCompressedWorker:function(){return new o(r.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},b.createWorkerFrom=function(a,y,v){return a.pipe(new i).pipe(new u("uncompressedSize")).pipe(y.compressWorker(v)).pipe(new u("compressedSize")).withStreamInfo("compression",y)},g.exports=b},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(n,g,c){var r=n("./stream/GenericWorker");c.STORE={magic:"\0\0",compressWorker:function(){return new r("STORE compression")},uncompressWorker:function(){return new r("STORE decompression")}},c.DEFLATE=n("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(n,g,c){var r=n("./utils"),o=function(){for(var i,u=[],b=0;b<256;b++){i=b;for(var a=0;a<8;a++)i=1&i?3988292384^i>>>1:i>>>1;u[b]=i}return u}();g.exports=function(i,u){return i!==void 0&&i.length?r.getTypeOf(i)!=="string"?function(b,a,y,v){var p=o,m=v+y;b^=-1;for(var l=v;l<m;l++)b=b>>>8^p[255&(b^a[l])];return-1^b}(0|u,i,i.length,0):function(b,a,y,v){var p=o,m=v+y;b^=-1;for(var l=v;l<m;l++)b=b>>>8^p[255&(b^a.charCodeAt(l))];return-1^b}(0|u,i,i.length,0):0}},{"./utils":32}],5:[function(n,g,c){c.base64=!1,c.binary=!1,c.dir=!1,c.createFolders=!0,c.date=null,c.compression=null,c.compressionOptions=null,c.comment=null,c.unixPermissions=null,c.dosPermissions=null},{}],6:[function(n,g,c){var r=null;r=typeof Promise<"u"?Promise:n("lie"),g.exports={Promise:r}},{lie:37}],7:[function(n,g,c){var r=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",o=n("pako"),i=n("./utils"),u=n("./stream/GenericWorker"),b=r?"uint8array":"array";function a(y,v){u.call(this,"FlateWorker/"+y),this._pako=null,this._pakoAction=y,this._pakoOptions=v,this.meta={}}c.magic="\b\0",i.inherits(a,u),a.prototype.processChunk=function(y){this.meta=y.meta,this._pako===null&&this._createPako(),this._pako.push(i.transformTo(b,y.data),!1)},a.prototype.flush=function(){u.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},a.prototype.cleanUp=function(){u.prototype.cleanUp.call(this),this._pako=null},a.prototype._createPako=function(){this._pako=new o[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var y=this;this._pako.onData=function(v){y.push({data:v,meta:y.meta})}},c.compressWorker=function(y){return new a("Deflate",y)},c.uncompressWorker=function(){return new a("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(n,g,c){function r(p,m){var l,x="";for(l=0;l<m;l++)x+=String.fromCharCode(255&p),p>>>=8;return x}function o(p,m,l,x,h,C){var E,D,j=p.file,_=p.compression,N=C!==b.utf8encode,H=i.transformTo("string",C(j.name)),T=i.transformTo("string",b.utf8encode(j.name)),G=j.comment,ne=i.transformTo("string",C(G)),A=i.transformTo("string",b.utf8encode(G)),W=T.length!==j.name.length,d=A.length!==G.length,w="",Q="",Y="",le=j.dir,Z=j.date,ie={crc32:0,compressedSize:0,uncompressedSize:0};m&&!l||(ie.crc32=p.crc32,ie.compressedSize=p.compressedSize,ie.uncompressedSize=p.uncompressedSize);var L=0;m&&(L|=8),N||!W&&!d||(L|=2048);var B=0,re=0;le&&(B|=16),h==="UNIX"?(re=798,B|=function(q,de){var be=q;return q||(be=de?16893:33204),(65535&be)<<16}(j.unixPermissions,le)):(re=20,B|=function(q){return 63&(q||0)}(j.dosPermissions)),E=Z.getUTCHours(),E<<=6,E|=Z.getUTCMinutes(),E<<=5,E|=Z.getUTCSeconds()/2,D=Z.getUTCFullYear()-1980,D<<=4,D|=Z.getUTCMonth()+1,D<<=5,D|=Z.getUTCDate(),W&&(Q=r(1,1)+r(a(H),4)+T,w+="up"+r(Q.length,2)+Q),d&&(Y=r(1,1)+r(a(ne),4)+A,w+="uc"+r(Y.length,2)+Y);var te="";return te+=`
\0`,te+=r(L,2),te+=_.magic,te+=r(E,2),te+=r(D,2),te+=r(ie.crc32,4),te+=r(ie.compressedSize,4),te+=r(ie.uncompressedSize,4),te+=r(H.length,2),te+=r(w.length,2),{fileRecord:y.LOCAL_FILE_HEADER+te+H+w,dirRecord:y.CENTRAL_FILE_HEADER+r(re,2)+te+r(ne.length,2)+"\0\0\0\0"+r(B,4)+r(x,4)+H+w+ne}}var i=n("../utils"),u=n("../stream/GenericWorker"),b=n("../utf8"),a=n("../crc32"),y=n("../signature");function v(p,m,l,x){u.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=m,this.zipPlatform=l,this.encodeFileName=x,this.streamFiles=p,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}i.inherits(v,u),v.prototype.push=function(p){var m=p.meta.percent||0,l=this.entriesCount,x=this._sources.length;this.accumulate?this.contentBuffer.push(p):(this.bytesWritten+=p.data.length,u.prototype.push.call(this,{data:p.data,meta:{currentFile:this.currentFile,percent:l?(m+100*(l-x-1))/l:100}}))},v.prototype.openedSource=function(p){this.currentSourceOffset=this.bytesWritten,this.currentFile=p.file.name;var m=this.streamFiles&&!p.file.dir;if(m){var l=o(p,m,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:l.fileRecord,meta:{percent:0}})}else this.accumulate=!0},v.prototype.closedSource=function(p){this.accumulate=!1;var m=this.streamFiles&&!p.file.dir,l=o(p,m,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(l.dirRecord),m)this.push({data:function(x){return y.DATA_DESCRIPTOR+r(x.crc32,4)+r(x.compressedSize,4)+r(x.uncompressedSize,4)}(p),meta:{percent:100}});else for(this.push({data:l.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},v.prototype.flush=function(){for(var p=this.bytesWritten,m=0;m<this.dirRecords.length;m++)this.push({data:this.dirRecords[m],meta:{percent:100}});var l=this.bytesWritten-p,x=function(h,C,E,D,j){var _=i.transformTo("string",j(D));return y.CENTRAL_DIRECTORY_END+"\0\0\0\0"+r(h,2)+r(h,2)+r(C,4)+r(E,4)+r(_.length,2)+_}(this.dirRecords.length,l,p,this.zipComment,this.encodeFileName);this.push({data:x,meta:{percent:100}})},v.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},v.prototype.registerPrevious=function(p){this._sources.push(p);var m=this;return p.on("data",function(l){m.processChunk(l)}),p.on("end",function(){m.closedSource(m.previous.streamInfo),m._sources.length?m.prepareNextSource():m.end()}),p.on("error",function(l){m.error(l)}),this},v.prototype.resume=function(){return!!u.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},v.prototype.error=function(p){var m=this._sources;if(!u.prototype.error.call(this,p))return!1;for(var l=0;l<m.length;l++)try{m[l].error(p)}catch{}return!0},v.prototype.lock=function(){u.prototype.lock.call(this);for(var p=this._sources,m=0;m<p.length;m++)p[m].lock()},g.exports=v},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(n,g,c){var r=n("../compressions"),o=n("./ZipFileWorker");c.generateWorker=function(i,u,b){var a=new o(u.streamFiles,b,u.platform,u.encodeFileName),y=0;try{i.forEach(function(v,p){y++;var m=function(C,E){var D=C||E,j=r[D];if(!j)throw new Error(D+" is not a valid compression method !");return j}(p.options.compression,u.compression),l=p.options.compressionOptions||u.compressionOptions||{},x=p.dir,h=p.date;p._compressWorker(m,l).withStreamInfo("file",{name:v,dir:x,date:h,comment:p.comment||"",unixPermissions:p.unixPermissions,dosPermissions:p.dosPermissions}).pipe(a)}),a.entriesCount=y}catch(v){a.error(v)}return a}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(n,g,c){function r(){if(!(this instanceof r))return new r;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var o=new r;for(var i in this)typeof this[i]!="function"&&(o[i]=this[i]);return o}}(r.prototype=n("./object")).loadAsync=n("./load"),r.support=n("./support"),r.defaults=n("./defaults"),r.version="3.10.1",r.loadAsync=function(o,i){return new r().loadAsync(o,i)},r.external=n("./external"),g.exports=r},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(n,g,c){var r=n("./utils"),o=n("./external"),i=n("./utf8"),u=n("./zipEntries"),b=n("./stream/Crc32Probe"),a=n("./nodejsUtils");function y(v){return new o.Promise(function(p,m){var l=v.decompressed.getContentWorker().pipe(new b);l.on("error",function(x){m(x)}).on("end",function(){l.streamInfo.crc32!==v.decompressed.crc32?m(new Error("Corrupted zip : CRC32 mismatch")):p()}).resume()})}g.exports=function(v,p){var m=this;return p=r.extend(p||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:i.utf8decode}),a.isNode&&a.isStream(v)?o.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):r.prepareContent("the loaded zip file",v,!0,p.optimizedBinaryString,p.base64).then(function(l){var x=new u(p);return x.load(l),x}).then(function(l){var x=[o.Promise.resolve(l)],h=l.files;if(p.checkCRC32)for(var C=0;C<h.length;C++)x.push(y(h[C]));return o.Promise.all(x)}).then(function(l){for(var x=l.shift(),h=x.files,C=0;C<h.length;C++){var E=h[C],D=E.fileNameStr,j=r.resolve(E.fileNameStr);m.file(j,E.decompressed,{binary:!0,optimizedBinaryString:!0,date:E.date,dir:E.dir,comment:E.fileCommentStr.length?E.fileCommentStr:null,unixPermissions:E.unixPermissions,dosPermissions:E.dosPermissions,createFolders:p.createFolders}),E.dir||(m.file(j).unsafeOriginalName=D)}return x.zipComment.length&&(m.comment=x.zipComment),m})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(n,g,c){var r=n("../utils"),o=n("../stream/GenericWorker");function i(u,b){o.call(this,"Nodejs stream input adapter for "+u),this._upstreamEnded=!1,this._bindStream(b)}r.inherits(i,o),i.prototype._bindStream=function(u){var b=this;(this._stream=u).pause(),u.on("data",function(a){b.push({data:a,meta:{percent:0}})}).on("error",function(a){b.isPaused?this.generatedError=a:b.error(a)}).on("end",function(){b.isPaused?b._upstreamEnded=!0:b.end()})},i.prototype.pause=function(){return!!o.prototype.pause.call(this)&&(this._stream.pause(),!0)},i.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},g.exports=i},{"../stream/GenericWorker":28,"../utils":32}],13:[function(n,g,c){var r=n("readable-stream").Readable;function o(i,u,b){r.call(this,u),this._helper=i;var a=this;i.on("data",function(y,v){a.push(y)||a._helper.pause(),b&&b(v)}).on("error",function(y){a.emit("error",y)}).on("end",function(){a.push(null)})}n("../utils").inherits(o,r),o.prototype._read=function(){this._helper.resume()},g.exports=o},{"../utils":32,"readable-stream":16}],14:[function(n,g,c){g.exports={isNode:typeof Buffer<"u",newBufferFrom:function(r,o){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(r,o);if(typeof r=="number")throw new Error('The "data" argument must not be a number');return new Buffer(r,o)},allocBuffer:function(r){if(Buffer.alloc)return Buffer.alloc(r);var o=new Buffer(r);return o.fill(0),o},isBuffer:function(r){return Buffer.isBuffer(r)},isStream:function(r){return r&&typeof r.on=="function"&&typeof r.pause=="function"&&typeof r.resume=="function"}}},{}],15:[function(n,g,c){function r(j,_,N){var H,T=i.getTypeOf(_),G=i.extend(N||{},a);G.date=G.date||new Date,G.compression!==null&&(G.compression=G.compression.toUpperCase()),typeof G.unixPermissions=="string"&&(G.unixPermissions=parseInt(G.unixPermissions,8)),G.unixPermissions&&16384&G.unixPermissions&&(G.dir=!0),G.dosPermissions&&16&G.dosPermissions&&(G.dir=!0),G.dir&&(j=h(j)),G.createFolders&&(H=x(j))&&C.call(this,H,!0);var ne=T==="string"&&G.binary===!1&&G.base64===!1;N&&N.binary!==void 0||(G.binary=!ne),(_ instanceof y&&_.uncompressedSize===0||G.dir||!_||_.length===0)&&(G.base64=!1,G.binary=!0,_="",G.compression="STORE",T="string");var A=null;A=_ instanceof y||_ instanceof u?_:m.isNode&&m.isStream(_)?new l(j,_):i.prepareContent(j,_,G.binary,G.optimizedBinaryString,G.base64);var W=new v(j,A,G);this.files[j]=W}var o=n("./utf8"),i=n("./utils"),u=n("./stream/GenericWorker"),b=n("./stream/StreamHelper"),a=n("./defaults"),y=n("./compressedObject"),v=n("./zipObject"),p=n("./generate"),m=n("./nodejsUtils"),l=n("./nodejs/NodejsStreamInputAdapter"),x=function(j){j.slice(-1)==="/"&&(j=j.substring(0,j.length-1));var _=j.lastIndexOf("/");return 0<_?j.substring(0,_):""},h=function(j){return j.slice(-1)!=="/"&&(j+="/"),j},C=function(j,_){return _=_!==void 0?_:a.createFolders,j=h(j),this.files[j]||r.call(this,j,null,{dir:!0,createFolders:_}),this.files[j]};function E(j){return Object.prototype.toString.call(j)==="[object RegExp]"}var D={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(j){var _,N,H;for(_ in this.files)H=this.files[_],(N=_.slice(this.root.length,_.length))&&_.slice(0,this.root.length)===this.root&&j(N,H)},filter:function(j){var _=[];return this.forEach(function(N,H){j(N,H)&&_.push(H)}),_},file:function(j,_,N){if(arguments.length!==1)return j=this.root+j,r.call(this,j,_,N),this;if(E(j)){var H=j;return this.filter(function(G,ne){return!ne.dir&&H.test(G)})}var T=this.files[this.root+j];return T&&!T.dir?T:null},folder:function(j){if(!j)return this;if(E(j))return this.filter(function(T,G){return G.dir&&j.test(T)});var _=this.root+j,N=C.call(this,_),H=this.clone();return H.root=N.name,H},remove:function(j){j=this.root+j;var _=this.files[j];if(_||(j.slice(-1)!=="/"&&(j+="/"),_=this.files[j]),_&&!_.dir)delete this.files[j];else for(var N=this.filter(function(T,G){return G.name.slice(0,j.length)===j}),H=0;H<N.length;H++)delete this.files[N[H].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(j){var _,N={};try{if((N=i.extend(j||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:o.utf8encode})).type=N.type.toLowerCase(),N.compression=N.compression.toUpperCase(),N.type==="binarystring"&&(N.type="string"),!N.type)throw new Error("No output type specified.");i.checkSupport(N.type),N.platform!=="darwin"&&N.platform!=="freebsd"&&N.platform!=="linux"&&N.platform!=="sunos"||(N.platform="UNIX"),N.platform==="win32"&&(N.platform="DOS");var H=N.comment||this.comment||"";_=p.generateWorker(this,N,H)}catch(T){(_=new u("error")).error(T)}return new b(_,N.type||"string",N.mimeType)},generateAsync:function(j,_){return this.generateInternalStream(j).accumulate(_)},generateNodeStream:function(j,_){return(j=j||{}).type||(j.type="nodebuffer"),this.generateInternalStream(j).toNodejsStream(_)}};g.exports=D},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(n,g,c){g.exports=n("stream")},{stream:void 0}],17:[function(n,g,c){var r=n("./DataReader");function o(i){r.call(this,i);for(var u=0;u<this.data.length;u++)i[u]=255&i[u]}n("../utils").inherits(o,r),o.prototype.byteAt=function(i){return this.data[this.zero+i]},o.prototype.lastIndexOfSignature=function(i){for(var u=i.charCodeAt(0),b=i.charCodeAt(1),a=i.charCodeAt(2),y=i.charCodeAt(3),v=this.length-4;0<=v;--v)if(this.data[v]===u&&this.data[v+1]===b&&this.data[v+2]===a&&this.data[v+3]===y)return v-this.zero;return-1},o.prototype.readAndCheckSignature=function(i){var u=i.charCodeAt(0),b=i.charCodeAt(1),a=i.charCodeAt(2),y=i.charCodeAt(3),v=this.readData(4);return u===v[0]&&b===v[1]&&a===v[2]&&y===v[3]},o.prototype.readData=function(i){if(this.checkOffset(i),i===0)return[];var u=this.data.slice(this.zero+this.index,this.zero+this.index+i);return this.index+=i,u},g.exports=o},{"../utils":32,"./DataReader":18}],18:[function(n,g,c){var r=n("../utils");function o(i){this.data=i,this.length=i.length,this.index=0,this.zero=0}o.prototype={checkOffset:function(i){this.checkIndex(this.index+i)},checkIndex:function(i){if(this.length<this.zero+i||i<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+i+"). Corrupted zip ?")},setIndex:function(i){this.checkIndex(i),this.index=i},skip:function(i){this.setIndex(this.index+i)},byteAt:function(){},readInt:function(i){var u,b=0;for(this.checkOffset(i),u=this.index+i-1;u>=this.index;u--)b=(b<<8)+this.byteAt(u);return this.index+=i,b},readString:function(i){return r.transformTo("string",this.readData(i))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var i=this.readInt(4);return new Date(Date.UTC(1980+(i>>25&127),(i>>21&15)-1,i>>16&31,i>>11&31,i>>5&63,(31&i)<<1))}},g.exports=o},{"../utils":32}],19:[function(n,g,c){var r=n("./Uint8ArrayReader");function o(i){r.call(this,i)}n("../utils").inherits(o,r),o.prototype.readData=function(i){this.checkOffset(i);var u=this.data.slice(this.zero+this.index,this.zero+this.index+i);return this.index+=i,u},g.exports=o},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(n,g,c){var r=n("./DataReader");function o(i){r.call(this,i)}n("../utils").inherits(o,r),o.prototype.byteAt=function(i){return this.data.charCodeAt(this.zero+i)},o.prototype.lastIndexOfSignature=function(i){return this.data.lastIndexOf(i)-this.zero},o.prototype.readAndCheckSignature=function(i){return i===this.readData(4)},o.prototype.readData=function(i){this.checkOffset(i);var u=this.data.slice(this.zero+this.index,this.zero+this.index+i);return this.index+=i,u},g.exports=o},{"../utils":32,"./DataReader":18}],21:[function(n,g,c){var r=n("./ArrayReader");function o(i){r.call(this,i)}n("../utils").inherits(o,r),o.prototype.readData=function(i){if(this.checkOffset(i),i===0)return new Uint8Array(0);var u=this.data.subarray(this.zero+this.index,this.zero+this.index+i);return this.index+=i,u},g.exports=o},{"../utils":32,"./ArrayReader":17}],22:[function(n,g,c){var r=n("../utils"),o=n("../support"),i=n("./ArrayReader"),u=n("./StringReader"),b=n("./NodeBufferReader"),a=n("./Uint8ArrayReader");g.exports=function(y){var v=r.getTypeOf(y);return r.checkSupport(v),v!=="string"||o.uint8array?v==="nodebuffer"?new b(y):o.uint8array?new a(r.transformTo("uint8array",y)):new i(r.transformTo("array",y)):new u(y)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(n,g,c){c.LOCAL_FILE_HEADER="PK",c.CENTRAL_FILE_HEADER="PK",c.CENTRAL_DIRECTORY_END="PK",c.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",c.ZIP64_CENTRAL_DIRECTORY_END="PK",c.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(n,g,c){var r=n("./GenericWorker"),o=n("../utils");function i(u){r.call(this,"ConvertWorker to "+u),this.destType=u}o.inherits(i,r),i.prototype.processChunk=function(u){this.push({data:o.transformTo(this.destType,u.data),meta:u.meta})},g.exports=i},{"../utils":32,"./GenericWorker":28}],25:[function(n,g,c){var r=n("./GenericWorker"),o=n("../crc32");function i(){r.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}n("../utils").inherits(i,r),i.prototype.processChunk=function(u){this.streamInfo.crc32=o(u.data,this.streamInfo.crc32||0),this.push(u)},g.exports=i},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(n,g,c){var r=n("../utils"),o=n("./GenericWorker");function i(u){o.call(this,"DataLengthProbe for "+u),this.propName=u,this.withStreamInfo(u,0)}r.inherits(i,o),i.prototype.processChunk=function(u){if(u){var b=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=b+u.data.length}o.prototype.processChunk.call(this,u)},g.exports=i},{"../utils":32,"./GenericWorker":28}],27:[function(n,g,c){var r=n("../utils"),o=n("./GenericWorker");function i(u){o.call(this,"DataWorker");var b=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,u.then(function(a){b.dataIsReady=!0,b.data=a,b.max=a&&a.length||0,b.type=r.getTypeOf(a),b.isPaused||b._tickAndRepeat()},function(a){b.error(a)})}r.inherits(i,o),i.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this.data=null},i.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,r.delay(this._tickAndRepeat,[],this)),!0)},i.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(r.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},i.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var u=null,b=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":u=this.data.substring(this.index,b);break;case"uint8array":u=this.data.subarray(this.index,b);break;case"array":case"nodebuffer":u=this.data.slice(this.index,b)}return this.index=b,this.push({data:u,meta:{percent:this.max?this.index/this.max*100:0}})},g.exports=i},{"../utils":32,"./GenericWorker":28}],28:[function(n,g,c){function r(o){this.name=o||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}r.prototype={push:function(o){this.emit("data",o)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(o){this.emit("error",o)}return!0},error:function(o){return!this.isFinished&&(this.isPaused?this.generatedError=o:(this.isFinished=!0,this.emit("error",o),this.previous&&this.previous.error(o),this.cleanUp()),!0)},on:function(o,i){return this._listeners[o].push(i),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(o,i){if(this._listeners[o])for(var u=0;u<this._listeners[o].length;u++)this._listeners[o][u].call(this,i)},pipe:function(o){return o.registerPrevious(this)},registerPrevious:function(o){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=o.streamInfo,this.mergeStreamInfo(),this.previous=o;var i=this;return o.on("data",function(u){i.processChunk(u)}),o.on("end",function(){i.end()}),o.on("error",function(u){i.error(u)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var o=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),o=!0),this.previous&&this.previous.resume(),!o},flush:function(){},processChunk:function(o){this.push(o)},withStreamInfo:function(o,i){return this.extraStreamInfo[o]=i,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var o in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,o)&&(this.streamInfo[o]=this.extraStreamInfo[o])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var o="Worker "+this.name;return this.previous?this.previous+" -> "+o:o}},g.exports=r},{}],29:[function(n,g,c){var r=n("../utils"),o=n("./ConvertWorker"),i=n("./GenericWorker"),u=n("../base64"),b=n("../support"),a=n("../external"),y=null;if(b.nodestream)try{y=n("../nodejs/NodejsStreamOutputAdapter")}catch{}function v(m,l){return new a.Promise(function(x,h){var C=[],E=m._internalType,D=m._outputType,j=m._mimeType;m.on("data",function(_,N){C.push(_),l&&l(N)}).on("error",function(_){C=[],h(_)}).on("end",function(){try{var _=function(N,H,T){switch(N){case"blob":return r.newBlob(r.transformTo("arraybuffer",H),T);case"base64":return u.encode(H);default:return r.transformTo(N,H)}}(D,function(N,H){var T,G=0,ne=null,A=0;for(T=0;T<H.length;T++)A+=H[T].length;switch(N){case"string":return H.join("");case"array":return Array.prototype.concat.apply([],H);case"uint8array":for(ne=new Uint8Array(A),T=0;T<H.length;T++)ne.set(H[T],G),G+=H[T].length;return ne;case"nodebuffer":return Buffer.concat(H);default:throw new Error("concat : unsupported type '"+N+"'")}}(E,C),j);x(_)}catch(N){h(N)}C=[]}).resume()})}function p(m,l,x){var h=l;switch(l){case"blob":case"arraybuffer":h="uint8array";break;case"base64":h="string"}try{this._internalType=h,this._outputType=l,this._mimeType=x,r.checkSupport(h),this._worker=m.pipe(new o(h)),m.lock()}catch(C){this._worker=new i("error"),this._worker.error(C)}}p.prototype={accumulate:function(m){return v(this,m)},on:function(m,l){var x=this;return m==="data"?this._worker.on(m,function(h){l.call(x,h.data,h.meta)}):this._worker.on(m,function(){r.delay(l,arguments,x)}),this},resume:function(){return r.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(m){if(r.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new y(this,{objectMode:this._outputType!=="nodebuffer"},m)}},g.exports=p},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(n,g,c){if(c.base64=!0,c.array=!0,c.string=!0,c.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",c.nodebuffer=typeof Buffer<"u",c.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")c.blob=!1;else{var r=new ArrayBuffer(0);try{c.blob=new Blob([r],{type:"application/zip"}).size===0}catch{try{var o=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);o.append(r),c.blob=o.getBlob("application/zip").size===0}catch{c.blob=!1}}}try{c.nodestream=!!n("readable-stream").Readable}catch{c.nodestream=!1}},{"readable-stream":16}],31:[function(n,g,c){for(var r=n("./utils"),o=n("./support"),i=n("./nodejsUtils"),u=n("./stream/GenericWorker"),b=new Array(256),a=0;a<256;a++)b[a]=252<=a?6:248<=a?5:240<=a?4:224<=a?3:192<=a?2:1;b[254]=b[254]=1;function y(){u.call(this,"utf-8 decode"),this.leftOver=null}function v(){u.call(this,"utf-8 encode")}c.utf8encode=function(p){return o.nodebuffer?i.newBufferFrom(p,"utf-8"):function(m){var l,x,h,C,E,D=m.length,j=0;for(C=0;C<D;C++)(64512&(x=m.charCodeAt(C)))==55296&&C+1<D&&(64512&(h=m.charCodeAt(C+1)))==56320&&(x=65536+(x-55296<<10)+(h-56320),C++),j+=x<128?1:x<2048?2:x<65536?3:4;for(l=o.uint8array?new Uint8Array(j):new Array(j),C=E=0;E<j;C++)(64512&(x=m.charCodeAt(C)))==55296&&C+1<D&&(64512&(h=m.charCodeAt(C+1)))==56320&&(x=65536+(x-55296<<10)+(h-56320),C++),x<128?l[E++]=x:(x<2048?l[E++]=192|x>>>6:(x<65536?l[E++]=224|x>>>12:(l[E++]=240|x>>>18,l[E++]=128|x>>>12&63),l[E++]=128|x>>>6&63),l[E++]=128|63&x);return l}(p)},c.utf8decode=function(p){return o.nodebuffer?r.transformTo("nodebuffer",p).toString("utf-8"):function(m){var l,x,h,C,E=m.length,D=new Array(2*E);for(l=x=0;l<E;)if((h=m[l++])<128)D[x++]=h;else if(4<(C=b[h]))D[x++]=65533,l+=C-1;else{for(h&=C===2?31:C===3?15:7;1<C&&l<E;)h=h<<6|63&m[l++],C--;1<C?D[x++]=65533:h<65536?D[x++]=h:(h-=65536,D[x++]=55296|h>>10&1023,D[x++]=56320|1023&h)}return D.length!==x&&(D.subarray?D=D.subarray(0,x):D.length=x),r.applyFromCharCode(D)}(p=r.transformTo(o.uint8array?"uint8array":"array",p))},r.inherits(y,u),y.prototype.processChunk=function(p){var m=r.transformTo(o.uint8array?"uint8array":"array",p.data);if(this.leftOver&&this.leftOver.length){if(o.uint8array){var l=m;(m=new Uint8Array(l.length+this.leftOver.length)).set(this.leftOver,0),m.set(l,this.leftOver.length)}else m=this.leftOver.concat(m);this.leftOver=null}var x=function(C,E){var D;for((E=E||C.length)>C.length&&(E=C.length),D=E-1;0<=D&&(192&C[D])==128;)D--;return D<0||D===0?E:D+b[C[D]]>E?D:E}(m),h=m;x!==m.length&&(o.uint8array?(h=m.subarray(0,x),this.leftOver=m.subarray(x,m.length)):(h=m.slice(0,x),this.leftOver=m.slice(x,m.length))),this.push({data:c.utf8decode(h),meta:p.meta})},y.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:c.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},c.Utf8DecodeWorker=y,r.inherits(v,u),v.prototype.processChunk=function(p){this.push({data:c.utf8encode(p.data),meta:p.meta})},c.Utf8EncodeWorker=v},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(n,g,c){var r=n("./support"),o=n("./base64"),i=n("./nodejsUtils"),u=n("./external");function b(l){return l}function a(l,x){for(var h=0;h<l.length;++h)x[h]=255&l.charCodeAt(h);return x}n("setimmediate"),c.newBlob=function(l,x){c.checkSupport("blob");try{return new Blob([l],{type:x})}catch{try{var h=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return h.append(l),h.getBlob(x)}catch{throw new Error("Bug : can't construct the Blob.")}}};var y={stringifyByChunk:function(l,x,h){var C=[],E=0,D=l.length;if(D<=h)return String.fromCharCode.apply(null,l);for(;E<D;)x==="array"||x==="nodebuffer"?C.push(String.fromCharCode.apply(null,l.slice(E,Math.min(E+h,D)))):C.push(String.fromCharCode.apply(null,l.subarray(E,Math.min(E+h,D)))),E+=h;return C.join("")},stringifyByChar:function(l){for(var x="",h=0;h<l.length;h++)x+=String.fromCharCode(l[h]);return x},applyCanBeUsed:{uint8array:function(){try{return r.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return r.nodebuffer&&String.fromCharCode.apply(null,i.allocBuffer(1)).length===1}catch{return!1}}()}};function v(l){var x=65536,h=c.getTypeOf(l),C=!0;if(h==="uint8array"?C=y.applyCanBeUsed.uint8array:h==="nodebuffer"&&(C=y.applyCanBeUsed.nodebuffer),C)for(;1<x;)try{return y.stringifyByChunk(l,h,x)}catch{x=Math.floor(x/2)}return y.stringifyByChar(l)}function p(l,x){for(var h=0;h<l.length;h++)x[h]=l[h];return x}c.applyFromCharCode=v;var m={};m.string={string:b,array:function(l){return a(l,new Array(l.length))},arraybuffer:function(l){return m.string.uint8array(l).buffer},uint8array:function(l){return a(l,new Uint8Array(l.length))},nodebuffer:function(l){return a(l,i.allocBuffer(l.length))}},m.array={string:v,array:b,arraybuffer:function(l){return new Uint8Array(l).buffer},uint8array:function(l){return new Uint8Array(l)},nodebuffer:function(l){return i.newBufferFrom(l)}},m.arraybuffer={string:function(l){return v(new Uint8Array(l))},array:function(l){return p(new Uint8Array(l),new Array(l.byteLength))},arraybuffer:b,uint8array:function(l){return new Uint8Array(l)},nodebuffer:function(l){return i.newBufferFrom(new Uint8Array(l))}},m.uint8array={string:v,array:function(l){return p(l,new Array(l.length))},arraybuffer:function(l){return l.buffer},uint8array:b,nodebuffer:function(l){return i.newBufferFrom(l)}},m.nodebuffer={string:v,array:function(l){return p(l,new Array(l.length))},arraybuffer:function(l){return m.nodebuffer.uint8array(l).buffer},uint8array:function(l){return p(l,new Uint8Array(l.length))},nodebuffer:b},c.transformTo=function(l,x){if(x=x||"",!l)return x;c.checkSupport(l);var h=c.getTypeOf(x);return m[h][l](x)},c.resolve=function(l){for(var x=l.split("/"),h=[],C=0;C<x.length;C++){var E=x[C];E==="."||E===""&&C!==0&&C!==x.length-1||(E===".."?h.pop():h.push(E))}return h.join("/")},c.getTypeOf=function(l){return typeof l=="string"?"string":Object.prototype.toString.call(l)==="[object Array]"?"array":r.nodebuffer&&i.isBuffer(l)?"nodebuffer":r.uint8array&&l instanceof Uint8Array?"uint8array":r.arraybuffer&&l instanceof ArrayBuffer?"arraybuffer":void 0},c.checkSupport=function(l){if(!r[l.toLowerCase()])throw new Error(l+" is not supported by this platform")},c.MAX_VALUE_16BITS=65535,c.MAX_VALUE_32BITS=-1,c.pretty=function(l){var x,h,C="";for(h=0;h<(l||"").length;h++)C+="\\x"+((x=l.charCodeAt(h))<16?"0":"")+x.toString(16).toUpperCase();return C},c.delay=function(l,x,h){setImmediate(function(){l.apply(h||null,x||[])})},c.inherits=function(l,x){function h(){}h.prototype=x.prototype,l.prototype=new h},c.extend=function(){var l,x,h={};for(l=0;l<arguments.length;l++)for(x in arguments[l])Object.prototype.hasOwnProperty.call(arguments[l],x)&&h[x]===void 0&&(h[x]=arguments[l][x]);return h},c.prepareContent=function(l,x,h,C,E){return u.Promise.resolve(x).then(function(D){return r.blob&&(D instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(D))!==-1)&&typeof FileReader<"u"?new u.Promise(function(j,_){var N=new FileReader;N.onload=function(H){j(H.target.result)},N.onerror=function(H){_(H.target.error)},N.readAsArrayBuffer(D)}):D}).then(function(D){var j=c.getTypeOf(D);return j?(j==="arraybuffer"?D=c.transformTo("uint8array",D):j==="string"&&(E?D=o.decode(D):h&&C!==!0&&(D=function(_){return a(_,r.uint8array?new Uint8Array(_.length):new Array(_.length))}(D))),D):u.Promise.reject(new Error("Can't read the data of '"+l+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(n,g,c){var r=n("./reader/readerFor"),o=n("./utils"),i=n("./signature"),u=n("./zipEntry"),b=n("./support");function a(y){this.files=[],this.loadOptions=y}a.prototype={checkSignature:function(y){if(!this.reader.readAndCheckSignature(y)){this.reader.index-=4;var v=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+o.pretty(v)+", expected "+o.pretty(y)+")")}},isSignature:function(y,v){var p=this.reader.index;this.reader.setIndex(y);var m=this.reader.readString(4)===v;return this.reader.setIndex(p),m},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var y=this.reader.readData(this.zipCommentLength),v=b.uint8array?"uint8array":"array",p=o.transformTo(v,y);this.zipComment=this.loadOptions.decodeFileName(p)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var y,v,p,m=this.zip64EndOfCentralSize-44;0<m;)y=this.reader.readInt(2),v=this.reader.readInt(4),p=this.reader.readData(v),this.zip64ExtensibleData[y]={id:y,length:v,value:p}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var y,v;for(y=0;y<this.files.length;y++)v=this.files[y],this.reader.setIndex(v.localHeaderOffset),this.checkSignature(i.LOCAL_FILE_HEADER),v.readLocalPart(this.reader),v.handleUTF8(),v.processAttributes()},readCentralDir:function(){var y;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(i.CENTRAL_FILE_HEADER);)(y=new u({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(y);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var y=this.reader.lastIndexOfSignature(i.CENTRAL_DIRECTORY_END);if(y<0)throw this.isSignature(0,i.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(y);var v=y;if(this.checkSignature(i.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===o.MAX_VALUE_16BITS||this.diskWithCentralDirStart===o.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===o.MAX_VALUE_16BITS||this.centralDirRecords===o.MAX_VALUE_16BITS||this.centralDirSize===o.MAX_VALUE_32BITS||this.centralDirOffset===o.MAX_VALUE_32BITS){if(this.zip64=!0,(y=this.reader.lastIndexOfSignature(i.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(y),this.checkSignature(i.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,i.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(i.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(i.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var p=this.centralDirOffset+this.centralDirSize;this.zip64&&(p+=20,p+=12+this.zip64EndOfCentralSize);var m=v-p;if(0<m)this.isSignature(v,i.CENTRAL_FILE_HEADER)||(this.reader.zero=m);else if(m<0)throw new Error("Corrupted zip: missing "+Math.abs(m)+" bytes.")},prepareReader:function(y){this.reader=r(y)},load:function(y){this.prepareReader(y),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},g.exports=a},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(n,g,c){var r=n("./reader/readerFor"),o=n("./utils"),i=n("./compressedObject"),u=n("./crc32"),b=n("./utf8"),a=n("./compressions"),y=n("./support");function v(p,m){this.options=p,this.loadOptions=m}v.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(p){var m,l;if(p.skip(22),this.fileNameLength=p.readInt(2),l=p.readInt(2),this.fileName=p.readData(this.fileNameLength),p.skip(l),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((m=function(x){for(var h in a)if(Object.prototype.hasOwnProperty.call(a,h)&&a[h].magic===x)return a[h];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+o.pretty(this.compressionMethod)+" unknown (inner file : "+o.transformTo("string",this.fileName)+")");this.decompressed=new i(this.compressedSize,this.uncompressedSize,this.crc32,m,p.readData(this.compressedSize))},readCentralPart:function(p){this.versionMadeBy=p.readInt(2),p.skip(2),this.bitFlag=p.readInt(2),this.compressionMethod=p.readString(2),this.date=p.readDate(),this.crc32=p.readInt(4),this.compressedSize=p.readInt(4),this.uncompressedSize=p.readInt(4);var m=p.readInt(2);if(this.extraFieldsLength=p.readInt(2),this.fileCommentLength=p.readInt(2),this.diskNumberStart=p.readInt(2),this.internalFileAttributes=p.readInt(2),this.externalFileAttributes=p.readInt(4),this.localHeaderOffset=p.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");p.skip(m),this.readExtraFields(p),this.parseZIP64ExtraField(p),this.fileComment=p.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var p=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),p==0&&(this.dosPermissions=63&this.externalFileAttributes),p==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var p=r(this.extraFields[1].value);this.uncompressedSize===o.MAX_VALUE_32BITS&&(this.uncompressedSize=p.readInt(8)),this.compressedSize===o.MAX_VALUE_32BITS&&(this.compressedSize=p.readInt(8)),this.localHeaderOffset===o.MAX_VALUE_32BITS&&(this.localHeaderOffset=p.readInt(8)),this.diskNumberStart===o.MAX_VALUE_32BITS&&(this.diskNumberStart=p.readInt(4))}},readExtraFields:function(p){var m,l,x,h=p.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});p.index+4<h;)m=p.readInt(2),l=p.readInt(2),x=p.readData(l),this.extraFields[m]={id:m,length:l,value:x};p.setIndex(h)},handleUTF8:function(){var p=y.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=b.utf8decode(this.fileName),this.fileCommentStr=b.utf8decode(this.fileComment);else{var m=this.findExtraFieldUnicodePath();if(m!==null)this.fileNameStr=m;else{var l=o.transformTo(p,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(l)}var x=this.findExtraFieldUnicodeComment();if(x!==null)this.fileCommentStr=x;else{var h=o.transformTo(p,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(h)}}},findExtraFieldUnicodePath:function(){var p=this.extraFields[28789];if(p){var m=r(p.value);return m.readInt(1)!==1||u(this.fileName)!==m.readInt(4)?null:b.utf8decode(m.readData(p.length-5))}return null},findExtraFieldUnicodeComment:function(){var p=this.extraFields[25461];if(p){var m=r(p.value);return m.readInt(1)!==1||u(this.fileComment)!==m.readInt(4)?null:b.utf8decode(m.readData(p.length-5))}return null}},g.exports=v},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(n,g,c){function r(m,l,x){this.name=m,this.dir=x.dir,this.date=x.date,this.comment=x.comment,this.unixPermissions=x.unixPermissions,this.dosPermissions=x.dosPermissions,this._data=l,this._dataBinary=x.binary,this.options={compression:x.compression,compressionOptions:x.compressionOptions}}var o=n("./stream/StreamHelper"),i=n("./stream/DataWorker"),u=n("./utf8"),b=n("./compressedObject"),a=n("./stream/GenericWorker");r.prototype={internalStream:function(m){var l=null,x="string";try{if(!m)throw new Error("No output type specified.");var h=(x=m.toLowerCase())==="string"||x==="text";x!=="binarystring"&&x!=="text"||(x="string"),l=this._decompressWorker();var C=!this._dataBinary;C&&!h&&(l=l.pipe(new u.Utf8EncodeWorker)),!C&&h&&(l=l.pipe(new u.Utf8DecodeWorker))}catch(E){(l=new a("error")).error(E)}return new o(l,x,"")},async:function(m,l){return this.internalStream(m).accumulate(l)},nodeStream:function(m,l){return this.internalStream(m||"nodebuffer").toNodejsStream(l)},_compressWorker:function(m,l){if(this._data instanceof b&&this._data.compression.magic===m.magic)return this._data.getCompressedWorker();var x=this._decompressWorker();return this._dataBinary||(x=x.pipe(new u.Utf8EncodeWorker)),b.createWorkerFrom(x,m,l)},_decompressWorker:function(){return this._data instanceof b?this._data.getContentWorker():this._data instanceof a?this._data:new i(this._data)}};for(var y=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],v=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},p=0;p<y.length;p++)r.prototype[y[p]]=v;g.exports=r},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(n,g,c){(function(r){var o,i,u=r.MutationObserver||r.WebKitMutationObserver;if(u){var b=0,a=new u(m),y=r.document.createTextNode("");a.observe(y,{characterData:!0}),o=function(){y.data=b=++b%2}}else if(r.setImmediate||r.MessageChannel===void 0)o="document"in r&&"onreadystatechange"in r.document.createElement("script")?function(){var l=r.document.createElement("script");l.onreadystatechange=function(){m(),l.onreadystatechange=null,l.parentNode.removeChild(l),l=null},r.document.documentElement.appendChild(l)}:function(){setTimeout(m,0)};else{var v=new r.MessageChannel;v.port1.onmessage=m,o=function(){v.port2.postMessage(0)}}var p=[];function m(){var l,x;i=!0;for(var h=p.length;h;){for(x=p,p=[],l=-1;++l<h;)x[l]();h=p.length}i=!1}g.exports=function(l){p.push(l)!==1||i||o()}}).call(this,typeof ht<"u"?ht:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(n,g,c){var r=n("immediate");function o(){}var i={},u=["REJECTED"],b=["FULFILLED"],a=["PENDING"];function y(h){if(typeof h!="function")throw new TypeError("resolver must be a function");this.state=a,this.queue=[],this.outcome=void 0,h!==o&&l(this,h)}function v(h,C,E){this.promise=h,typeof C=="function"&&(this.onFulfilled=C,this.callFulfilled=this.otherCallFulfilled),typeof E=="function"&&(this.onRejected=E,this.callRejected=this.otherCallRejected)}function p(h,C,E){r(function(){var D;try{D=C(E)}catch(j){return i.reject(h,j)}D===h?i.reject(h,new TypeError("Cannot resolve promise with itself")):i.resolve(h,D)})}function m(h){var C=h&&h.then;if(h&&(typeof h=="object"||typeof h=="function")&&typeof C=="function")return function(){C.apply(h,arguments)}}function l(h,C){var E=!1;function D(N){E||(E=!0,i.reject(h,N))}function j(N){E||(E=!0,i.resolve(h,N))}var _=x(function(){C(j,D)});_.status==="error"&&D(_.value)}function x(h,C){var E={};try{E.value=h(C),E.status="success"}catch(D){E.status="error",E.value=D}return E}(g.exports=y).prototype.finally=function(h){if(typeof h!="function")return this;var C=this.constructor;return this.then(function(E){return C.resolve(h()).then(function(){return E})},function(E){return C.resolve(h()).then(function(){throw E})})},y.prototype.catch=function(h){return this.then(null,h)},y.prototype.then=function(h,C){if(typeof h!="function"&&this.state===b||typeof C!="function"&&this.state===u)return this;var E=new this.constructor(o);return this.state!==a?p(E,this.state===b?h:C,this.outcome):this.queue.push(new v(E,h,C)),E},v.prototype.callFulfilled=function(h){i.resolve(this.promise,h)},v.prototype.otherCallFulfilled=function(h){p(this.promise,this.onFulfilled,h)},v.prototype.callRejected=function(h){i.reject(this.promise,h)},v.prototype.otherCallRejected=function(h){p(this.promise,this.onRejected,h)},i.resolve=function(h,C){var E=x(m,C);if(E.status==="error")return i.reject(h,E.value);var D=E.value;if(D)l(h,D);else{h.state=b,h.outcome=C;for(var j=-1,_=h.queue.length;++j<_;)h.queue[j].callFulfilled(C)}return h},i.reject=function(h,C){h.state=u,h.outcome=C;for(var E=-1,D=h.queue.length;++E<D;)h.queue[E].callRejected(C);return h},y.resolve=function(h){return h instanceof this?h:i.resolve(new this(o),h)},y.reject=function(h){var C=new this(o);return i.reject(C,h)},y.all=function(h){var C=this;if(Object.prototype.toString.call(h)!=="[object Array]")return this.reject(new TypeError("must be an array"));var E=h.length,D=!1;if(!E)return this.resolve([]);for(var j=new Array(E),_=0,N=-1,H=new this(o);++N<E;)T(h[N],N);return H;function T(G,ne){C.resolve(G).then(function(A){j[ne]=A,++_!==E||D||(D=!0,i.resolve(H,j))},function(A){D||(D=!0,i.reject(H,A))})}},y.race=function(h){var C=this;if(Object.prototype.toString.call(h)!=="[object Array]")return this.reject(new TypeError("must be an array"));var E=h.length,D=!1;if(!E)return this.resolve([]);for(var j=-1,_=new this(o);++j<E;)N=h[j],C.resolve(N).then(function(H){D||(D=!0,i.resolve(_,H))},function(H){D||(D=!0,i.reject(_,H))});var N;return _}},{immediate:36}],38:[function(n,g,c){var r={};(0,n("./lib/utils/common").assign)(r,n("./lib/deflate"),n("./lib/inflate"),n("./lib/zlib/constants")),g.exports=r},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(n,g,c){var r=n("./zlib/deflate"),o=n("./utils/common"),i=n("./utils/strings"),u=n("./zlib/messages"),b=n("./zlib/zstream"),a=Object.prototype.toString,y=0,v=-1,p=0,m=8;function l(h){if(!(this instanceof l))return new l(h);this.options=o.assign({level:v,method:m,chunkSize:16384,windowBits:15,memLevel:8,strategy:p,to:""},h||{});var C=this.options;C.raw&&0<C.windowBits?C.windowBits=-C.windowBits:C.gzip&&0<C.windowBits&&C.windowBits<16&&(C.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new b,this.strm.avail_out=0;var E=r.deflateInit2(this.strm,C.level,C.method,C.windowBits,C.memLevel,C.strategy);if(E!==y)throw new Error(u[E]);if(C.header&&r.deflateSetHeader(this.strm,C.header),C.dictionary){var D;if(D=typeof C.dictionary=="string"?i.string2buf(C.dictionary):a.call(C.dictionary)==="[object ArrayBuffer]"?new Uint8Array(C.dictionary):C.dictionary,(E=r.deflateSetDictionary(this.strm,D))!==y)throw new Error(u[E]);this._dict_set=!0}}function x(h,C){var E=new l(C);if(E.push(h,!0),E.err)throw E.msg||u[E.err];return E.result}l.prototype.push=function(h,C){var E,D,j=this.strm,_=this.options.chunkSize;if(this.ended)return!1;D=C===~~C?C:C===!0?4:0,typeof h=="string"?j.input=i.string2buf(h):a.call(h)==="[object ArrayBuffer]"?j.input=new Uint8Array(h):j.input=h,j.next_in=0,j.avail_in=j.input.length;do{if(j.avail_out===0&&(j.output=new o.Buf8(_),j.next_out=0,j.avail_out=_),(E=r.deflate(j,D))!==1&&E!==y)return this.onEnd(E),!(this.ended=!0);j.avail_out!==0&&(j.avail_in!==0||D!==4&&D!==2)||(this.options.to==="string"?this.onData(i.buf2binstring(o.shrinkBuf(j.output,j.next_out))):this.onData(o.shrinkBuf(j.output,j.next_out)))}while((0<j.avail_in||j.avail_out===0)&&E!==1);return D===4?(E=r.deflateEnd(this.strm),this.onEnd(E),this.ended=!0,E===y):D!==2||(this.onEnd(y),!(j.avail_out=0))},l.prototype.onData=function(h){this.chunks.push(h)},l.prototype.onEnd=function(h){h===y&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=h,this.msg=this.strm.msg},c.Deflate=l,c.deflate=x,c.deflateRaw=function(h,C){return(C=C||{}).raw=!0,x(h,C)},c.gzip=function(h,C){return(C=C||{}).gzip=!0,x(h,C)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(n,g,c){var r=n("./zlib/inflate"),o=n("./utils/common"),i=n("./utils/strings"),u=n("./zlib/constants"),b=n("./zlib/messages"),a=n("./zlib/zstream"),y=n("./zlib/gzheader"),v=Object.prototype.toString;function p(l){if(!(this instanceof p))return new p(l);this.options=o.assign({chunkSize:16384,windowBits:0,to:""},l||{});var x=this.options;x.raw&&0<=x.windowBits&&x.windowBits<16&&(x.windowBits=-x.windowBits,x.windowBits===0&&(x.windowBits=-15)),!(0<=x.windowBits&&x.windowBits<16)||l&&l.windowBits||(x.windowBits+=32),15<x.windowBits&&x.windowBits<48&&!(15&x.windowBits)&&(x.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new a,this.strm.avail_out=0;var h=r.inflateInit2(this.strm,x.windowBits);if(h!==u.Z_OK)throw new Error(b[h]);this.header=new y,r.inflateGetHeader(this.strm,this.header)}function m(l,x){var h=new p(x);if(h.push(l,!0),h.err)throw h.msg||b[h.err];return h.result}p.prototype.push=function(l,x){var h,C,E,D,j,_,N=this.strm,H=this.options.chunkSize,T=this.options.dictionary,G=!1;if(this.ended)return!1;C=x===~~x?x:x===!0?u.Z_FINISH:u.Z_NO_FLUSH,typeof l=="string"?N.input=i.binstring2buf(l):v.call(l)==="[object ArrayBuffer]"?N.input=new Uint8Array(l):N.input=l,N.next_in=0,N.avail_in=N.input.length;do{if(N.avail_out===0&&(N.output=new o.Buf8(H),N.next_out=0,N.avail_out=H),(h=r.inflate(N,u.Z_NO_FLUSH))===u.Z_NEED_DICT&&T&&(_=typeof T=="string"?i.string2buf(T):v.call(T)==="[object ArrayBuffer]"?new Uint8Array(T):T,h=r.inflateSetDictionary(this.strm,_)),h===u.Z_BUF_ERROR&&G===!0&&(h=u.Z_OK,G=!1),h!==u.Z_STREAM_END&&h!==u.Z_OK)return this.onEnd(h),!(this.ended=!0);N.next_out&&(N.avail_out!==0&&h!==u.Z_STREAM_END&&(N.avail_in!==0||C!==u.Z_FINISH&&C!==u.Z_SYNC_FLUSH)||(this.options.to==="string"?(E=i.utf8border(N.output,N.next_out),D=N.next_out-E,j=i.buf2string(N.output,E),N.next_out=D,N.avail_out=H-D,D&&o.arraySet(N.output,N.output,E,D,0),this.onData(j)):this.onData(o.shrinkBuf(N.output,N.next_out)))),N.avail_in===0&&N.avail_out===0&&(G=!0)}while((0<N.avail_in||N.avail_out===0)&&h!==u.Z_STREAM_END);return h===u.Z_STREAM_END&&(C=u.Z_FINISH),C===u.Z_FINISH?(h=r.inflateEnd(this.strm),this.onEnd(h),this.ended=!0,h===u.Z_OK):C!==u.Z_SYNC_FLUSH||(this.onEnd(u.Z_OK),!(N.avail_out=0))},p.prototype.onData=function(l){this.chunks.push(l)},p.prototype.onEnd=function(l){l===u.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=l,this.msg=this.strm.msg},c.Inflate=p,c.inflate=m,c.inflateRaw=function(l,x){return(x=x||{}).raw=!0,m(l,x)},c.ungzip=m},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(n,g,c){var r=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";c.assign=function(u){for(var b=Array.prototype.slice.call(arguments,1);b.length;){var a=b.shift();if(a){if(typeof a!="object")throw new TypeError(a+"must be non-object");for(var y in a)a.hasOwnProperty(y)&&(u[y]=a[y])}}return u},c.shrinkBuf=function(u,b){return u.length===b?u:u.subarray?u.subarray(0,b):(u.length=b,u)};var o={arraySet:function(u,b,a,y,v){if(b.subarray&&u.subarray)u.set(b.subarray(a,a+y),v);else for(var p=0;p<y;p++)u[v+p]=b[a+p]},flattenChunks:function(u){var b,a,y,v,p,m;for(b=y=0,a=u.length;b<a;b++)y+=u[b].length;for(m=new Uint8Array(y),b=v=0,a=u.length;b<a;b++)p=u[b],m.set(p,v),v+=p.length;return m}},i={arraySet:function(u,b,a,y,v){for(var p=0;p<y;p++)u[v+p]=b[a+p]},flattenChunks:function(u){return[].concat.apply([],u)}};c.setTyped=function(u){u?(c.Buf8=Uint8Array,c.Buf16=Uint16Array,c.Buf32=Int32Array,c.assign(c,o)):(c.Buf8=Array,c.Buf16=Array,c.Buf32=Array,c.assign(c,i))},c.setTyped(r)},{}],42:[function(n,g,c){var r=n("./common"),o=!0,i=!0;try{String.fromCharCode.apply(null,[0])}catch{o=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{i=!1}for(var u=new r.Buf8(256),b=0;b<256;b++)u[b]=252<=b?6:248<=b?5:240<=b?4:224<=b?3:192<=b?2:1;function a(y,v){if(v<65537&&(y.subarray&&i||!y.subarray&&o))return String.fromCharCode.apply(null,r.shrinkBuf(y,v));for(var p="",m=0;m<v;m++)p+=String.fromCharCode(y[m]);return p}u[254]=u[254]=1,c.string2buf=function(y){var v,p,m,l,x,h=y.length,C=0;for(l=0;l<h;l++)(64512&(p=y.charCodeAt(l)))==55296&&l+1<h&&(64512&(m=y.charCodeAt(l+1)))==56320&&(p=65536+(p-55296<<10)+(m-56320),l++),C+=p<128?1:p<2048?2:p<65536?3:4;for(v=new r.Buf8(C),l=x=0;x<C;l++)(64512&(p=y.charCodeAt(l)))==55296&&l+1<h&&(64512&(m=y.charCodeAt(l+1)))==56320&&(p=65536+(p-55296<<10)+(m-56320),l++),p<128?v[x++]=p:(p<2048?v[x++]=192|p>>>6:(p<65536?v[x++]=224|p>>>12:(v[x++]=240|p>>>18,v[x++]=128|p>>>12&63),v[x++]=128|p>>>6&63),v[x++]=128|63&p);return v},c.buf2binstring=function(y){return a(y,y.length)},c.binstring2buf=function(y){for(var v=new r.Buf8(y.length),p=0,m=v.length;p<m;p++)v[p]=y.charCodeAt(p);return v},c.buf2string=function(y,v){var p,m,l,x,h=v||y.length,C=new Array(2*h);for(p=m=0;p<h;)if((l=y[p++])<128)C[m++]=l;else if(4<(x=u[l]))C[m++]=65533,p+=x-1;else{for(l&=x===2?31:x===3?15:7;1<x&&p<h;)l=l<<6|63&y[p++],x--;1<x?C[m++]=65533:l<65536?C[m++]=l:(l-=65536,C[m++]=55296|l>>10&1023,C[m++]=56320|1023&l)}return a(C,m)},c.utf8border=function(y,v){var p;for((v=v||y.length)>y.length&&(v=y.length),p=v-1;0<=p&&(192&y[p])==128;)p--;return p<0||p===0?v:p+u[y[p]]>v?p:v}},{"./common":41}],43:[function(n,g,c){g.exports=function(r,o,i,u){for(var b=65535&r|0,a=r>>>16&65535|0,y=0;i!==0;){for(i-=y=2e3<i?2e3:i;a=a+(b=b+o[u++]|0)|0,--y;);b%=65521,a%=65521}return b|a<<16|0}},{}],44:[function(n,g,c){g.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(n,g,c){var r=function(){for(var o,i=[],u=0;u<256;u++){o=u;for(var b=0;b<8;b++)o=1&o?3988292384^o>>>1:o>>>1;i[u]=o}return i}();g.exports=function(o,i,u,b){var a=r,y=b+u;o^=-1;for(var v=b;v<y;v++)o=o>>>8^a[255&(o^i[v])];return-1^o}},{}],46:[function(n,g,c){var r,o=n("../utils/common"),i=n("./trees"),u=n("./adler32"),b=n("./crc32"),a=n("./messages"),y=0,v=4,p=0,m=-2,l=-1,x=4,h=2,C=8,E=9,D=286,j=30,_=19,N=2*D+1,H=15,T=3,G=258,ne=G+T+1,A=42,W=113,d=1,w=2,Q=3,Y=4;function le(s,V){return s.msg=a[V],V}function Z(s){return(s<<1)-(4<s?9:0)}function ie(s){for(var V=s.length;0<=--V;)s[V]=0}function L(s){var V=s.state,U=V.pending;U>s.avail_out&&(U=s.avail_out),U!==0&&(o.arraySet(s.output,V.pending_buf,V.pending_out,U,s.next_out),s.next_out+=U,V.pending_out+=U,s.total_out+=U,s.avail_out-=U,V.pending-=U,V.pending===0&&(V.pending_out=0))}function B(s,V){i._tr_flush_block(s,0<=s.block_start?s.block_start:-1,s.strstart-s.block_start,V),s.block_start=s.strstart,L(s.strm)}function re(s,V){s.pending_buf[s.pending++]=V}function te(s,V){s.pending_buf[s.pending++]=V>>>8&255,s.pending_buf[s.pending++]=255&V}function q(s,V){var U,I,S=s.max_chain_length,k=s.strstart,F=s.prev_length,O=s.nice_match,M=s.strstart>s.w_size-ne?s.strstart-(s.w_size-ne):0,z=s.window,ee=s.w_mask,$=s.prev,X=s.strstart+G,oe=z[k+F-1],ce=z[k+F];s.prev_length>=s.good_match&&(S>>=2),O>s.lookahead&&(O=s.lookahead);do if(z[(U=V)+F]===ce&&z[U+F-1]===oe&&z[U]===z[k]&&z[++U]===z[k+1]){k+=2,U++;do;while(z[++k]===z[++U]&&z[++k]===z[++U]&&z[++k]===z[++U]&&z[++k]===z[++U]&&z[++k]===z[++U]&&z[++k]===z[++U]&&z[++k]===z[++U]&&z[++k]===z[++U]&&k<X);if(I=G-(X-k),k=X-G,F<I){if(s.match_start=V,O<=(F=I))break;oe=z[k+F-1],ce=z[k+F]}}while((V=$[V&ee])>M&&--S!=0);return F<=s.lookahead?F:s.lookahead}function de(s){var V,U,I,S,k,F,O,M,z,ee,$=s.w_size;do{if(S=s.window_size-s.lookahead-s.strstart,s.strstart>=$+($-ne)){for(o.arraySet(s.window,s.window,$,$,0),s.match_start-=$,s.strstart-=$,s.block_start-=$,V=U=s.hash_size;I=s.head[--V],s.head[V]=$<=I?I-$:0,--U;);for(V=U=$;I=s.prev[--V],s.prev[V]=$<=I?I-$:0,--U;);S+=$}if(s.strm.avail_in===0)break;if(F=s.strm,O=s.window,M=s.strstart+s.lookahead,z=S,ee=void 0,ee=F.avail_in,z<ee&&(ee=z),U=ee===0?0:(F.avail_in-=ee,o.arraySet(O,F.input,F.next_in,ee,M),F.state.wrap===1?F.adler=u(F.adler,O,ee,M):F.state.wrap===2&&(F.adler=b(F.adler,O,ee,M)),F.next_in+=ee,F.total_in+=ee,ee),s.lookahead+=U,s.lookahead+s.insert>=T)for(k=s.strstart-s.insert,s.ins_h=s.window[k],s.ins_h=(s.ins_h<<s.hash_shift^s.window[k+1])&s.hash_mask;s.insert&&(s.ins_h=(s.ins_h<<s.hash_shift^s.window[k+T-1])&s.hash_mask,s.prev[k&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=k,k++,s.insert--,!(s.lookahead+s.insert<T)););}while(s.lookahead<ne&&s.strm.avail_in!==0)}function be(s,V){for(var U,I;;){if(s.lookahead<ne){if(de(s),s.lookahead<ne&&V===y)return d;if(s.lookahead===0)break}if(U=0,s.lookahead>=T&&(s.ins_h=(s.ins_h<<s.hash_shift^s.window[s.strstart+T-1])&s.hash_mask,U=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=s.strstart),U!==0&&s.strstart-U<=s.w_size-ne&&(s.match_length=q(s,U)),s.match_length>=T)if(I=i._tr_tally(s,s.strstart-s.match_start,s.match_length-T),s.lookahead-=s.match_length,s.match_length<=s.max_lazy_match&&s.lookahead>=T){for(s.match_length--;s.strstart++,s.ins_h=(s.ins_h<<s.hash_shift^s.window[s.strstart+T-1])&s.hash_mask,U=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=s.strstart,--s.match_length!=0;);s.strstart++}else s.strstart+=s.match_length,s.match_length=0,s.ins_h=s.window[s.strstart],s.ins_h=(s.ins_h<<s.hash_shift^s.window[s.strstart+1])&s.hash_mask;else I=i._tr_tally(s,0,s.window[s.strstart]),s.lookahead--,s.strstart++;if(I&&(B(s,!1),s.strm.avail_out===0))return d}return s.insert=s.strstart<T-1?s.strstart:T-1,V===v?(B(s,!0),s.strm.avail_out===0?Q:Y):s.last_lit&&(B(s,!1),s.strm.avail_out===0)?d:w}function ue(s,V){for(var U,I,S;;){if(s.lookahead<ne){if(de(s),s.lookahead<ne&&V===y)return d;if(s.lookahead===0)break}if(U=0,s.lookahead>=T&&(s.ins_h=(s.ins_h<<s.hash_shift^s.window[s.strstart+T-1])&s.hash_mask,U=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=s.strstart),s.prev_length=s.match_length,s.prev_match=s.match_start,s.match_length=T-1,U!==0&&s.prev_length<s.max_lazy_match&&s.strstart-U<=s.w_size-ne&&(s.match_length=q(s,U),s.match_length<=5&&(s.strategy===1||s.match_length===T&&4096<s.strstart-s.match_start)&&(s.match_length=T-1)),s.prev_length>=T&&s.match_length<=s.prev_length){for(S=s.strstart+s.lookahead-T,I=i._tr_tally(s,s.strstart-1-s.prev_match,s.prev_length-T),s.lookahead-=s.prev_length-1,s.prev_length-=2;++s.strstart<=S&&(s.ins_h=(s.ins_h<<s.hash_shift^s.window[s.strstart+T-1])&s.hash_mask,U=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=s.strstart),--s.prev_length!=0;);if(s.match_available=0,s.match_length=T-1,s.strstart++,I&&(B(s,!1),s.strm.avail_out===0))return d}else if(s.match_available){if((I=i._tr_tally(s,0,s.window[s.strstart-1]))&&B(s,!1),s.strstart++,s.lookahead--,s.strm.avail_out===0)return d}else s.match_available=1,s.strstart++,s.lookahead--}return s.match_available&&(I=i._tr_tally(s,0,s.window[s.strstart-1]),s.match_available=0),s.insert=s.strstart<T-1?s.strstart:T-1,V===v?(B(s,!0),s.strm.avail_out===0?Q:Y):s.last_lit&&(B(s,!1),s.strm.avail_out===0)?d:w}function he(s,V,U,I,S){this.good_length=s,this.max_lazy=V,this.nice_length=U,this.max_chain=I,this.func=S}function Se(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=C,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new o.Buf16(2*N),this.dyn_dtree=new o.Buf16(2*(2*j+1)),this.bl_tree=new o.Buf16(2*(2*_+1)),ie(this.dyn_ltree),ie(this.dyn_dtree),ie(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new o.Buf16(H+1),this.heap=new o.Buf16(2*D+1),ie(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new o.Buf16(2*D+1),ie(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function ge(s){var V;return s&&s.state?(s.total_in=s.total_out=0,s.data_type=h,(V=s.state).pending=0,V.pending_out=0,V.wrap<0&&(V.wrap=-V.wrap),V.status=V.wrap?A:W,s.adler=V.wrap===2?0:1,V.last_flush=y,i._tr_init(V),p):le(s,m)}function Ie(s){var V=ge(s);return V===p&&function(U){U.window_size=2*U.w_size,ie(U.head),U.max_lazy_match=r[U.level].max_lazy,U.good_match=r[U.level].good_length,U.nice_match=r[U.level].nice_length,U.max_chain_length=r[U.level].max_chain,U.strstart=0,U.block_start=0,U.lookahead=0,U.insert=0,U.match_length=U.prev_length=T-1,U.match_available=0,U.ins_h=0}(s.state),V}function Ae(s,V,U,I,S,k){if(!s)return m;var F=1;if(V===l&&(V=6),I<0?(F=0,I=-I):15<I&&(F=2,I-=16),S<1||E<S||U!==C||I<8||15<I||V<0||9<V||k<0||x<k)return le(s,m);I===8&&(I=9);var O=new Se;return(s.state=O).strm=s,O.wrap=F,O.gzhead=null,O.w_bits=I,O.w_size=1<<O.w_bits,O.w_mask=O.w_size-1,O.hash_bits=S+7,O.hash_size=1<<O.hash_bits,O.hash_mask=O.hash_size-1,O.hash_shift=~~((O.hash_bits+T-1)/T),O.window=new o.Buf8(2*O.w_size),O.head=new o.Buf16(O.hash_size),O.prev=new o.Buf16(O.w_size),O.lit_bufsize=1<<S+6,O.pending_buf_size=4*O.lit_bufsize,O.pending_buf=new o.Buf8(O.pending_buf_size),O.d_buf=1*O.lit_bufsize,O.l_buf=3*O.lit_bufsize,O.level=V,O.strategy=k,O.method=U,Ie(s)}r=[new he(0,0,0,0,function(s,V){var U=65535;for(U>s.pending_buf_size-5&&(U=s.pending_buf_size-5);;){if(s.lookahead<=1){if(de(s),s.lookahead===0&&V===y)return d;if(s.lookahead===0)break}s.strstart+=s.lookahead,s.lookahead=0;var I=s.block_start+U;if((s.strstart===0||s.strstart>=I)&&(s.lookahead=s.strstart-I,s.strstart=I,B(s,!1),s.strm.avail_out===0)||s.strstart-s.block_start>=s.w_size-ne&&(B(s,!1),s.strm.avail_out===0))return d}return s.insert=0,V===v?(B(s,!0),s.strm.avail_out===0?Q:Y):(s.strstart>s.block_start&&(B(s,!1),s.strm.avail_out),d)}),new he(4,4,8,4,be),new he(4,5,16,8,be),new he(4,6,32,32,be),new he(4,4,16,16,ue),new he(8,16,32,32,ue),new he(8,16,128,128,ue),new he(8,32,128,256,ue),new he(32,128,258,1024,ue),new he(32,258,258,4096,ue)],c.deflateInit=function(s,V){return Ae(s,V,C,15,8,0)},c.deflateInit2=Ae,c.deflateReset=Ie,c.deflateResetKeep=ge,c.deflateSetHeader=function(s,V){return s&&s.state?s.state.wrap!==2?m:(s.state.gzhead=V,p):m},c.deflate=function(s,V){var U,I,S,k;if(!s||!s.state||5<V||V<0)return s?le(s,m):m;if(I=s.state,!s.output||!s.input&&s.avail_in!==0||I.status===666&&V!==v)return le(s,s.avail_out===0?-5:m);if(I.strm=s,U=I.last_flush,I.last_flush=V,I.status===A)if(I.wrap===2)s.adler=0,re(I,31),re(I,139),re(I,8),I.gzhead?(re(I,(I.gzhead.text?1:0)+(I.gzhead.hcrc?2:0)+(I.gzhead.extra?4:0)+(I.gzhead.name?8:0)+(I.gzhead.comment?16:0)),re(I,255&I.gzhead.time),re(I,I.gzhead.time>>8&255),re(I,I.gzhead.time>>16&255),re(I,I.gzhead.time>>24&255),re(I,I.level===9?2:2<=I.strategy||I.level<2?4:0),re(I,255&I.gzhead.os),I.gzhead.extra&&I.gzhead.extra.length&&(re(I,255&I.gzhead.extra.length),re(I,I.gzhead.extra.length>>8&255)),I.gzhead.hcrc&&(s.adler=b(s.adler,I.pending_buf,I.pending,0)),I.gzindex=0,I.status=69):(re(I,0),re(I,0),re(I,0),re(I,0),re(I,0),re(I,I.level===9?2:2<=I.strategy||I.level<2?4:0),re(I,3),I.status=W);else{var F=C+(I.w_bits-8<<4)<<8;F|=(2<=I.strategy||I.level<2?0:I.level<6?1:I.level===6?2:3)<<6,I.strstart!==0&&(F|=32),F+=31-F%31,I.status=W,te(I,F),I.strstart!==0&&(te(I,s.adler>>>16),te(I,65535&s.adler)),s.adler=1}if(I.status===69)if(I.gzhead.extra){for(S=I.pending;I.gzindex<(65535&I.gzhead.extra.length)&&(I.pending!==I.pending_buf_size||(I.gzhead.hcrc&&I.pending>S&&(s.adler=b(s.adler,I.pending_buf,I.pending-S,S)),L(s),S=I.pending,I.pending!==I.pending_buf_size));)re(I,255&I.gzhead.extra[I.gzindex]),I.gzindex++;I.gzhead.hcrc&&I.pending>S&&(s.adler=b(s.adler,I.pending_buf,I.pending-S,S)),I.gzindex===I.gzhead.extra.length&&(I.gzindex=0,I.status=73)}else I.status=73;if(I.status===73)if(I.gzhead.name){S=I.pending;do{if(I.pending===I.pending_buf_size&&(I.gzhead.hcrc&&I.pending>S&&(s.adler=b(s.adler,I.pending_buf,I.pending-S,S)),L(s),S=I.pending,I.pending===I.pending_buf_size)){k=1;break}k=I.gzindex<I.gzhead.name.length?255&I.gzhead.name.charCodeAt(I.gzindex++):0,re(I,k)}while(k!==0);I.gzhead.hcrc&&I.pending>S&&(s.adler=b(s.adler,I.pending_buf,I.pending-S,S)),k===0&&(I.gzindex=0,I.status=91)}else I.status=91;if(I.status===91)if(I.gzhead.comment){S=I.pending;do{if(I.pending===I.pending_buf_size&&(I.gzhead.hcrc&&I.pending>S&&(s.adler=b(s.adler,I.pending_buf,I.pending-S,S)),L(s),S=I.pending,I.pending===I.pending_buf_size)){k=1;break}k=I.gzindex<I.gzhead.comment.length?255&I.gzhead.comment.charCodeAt(I.gzindex++):0,re(I,k)}while(k!==0);I.gzhead.hcrc&&I.pending>S&&(s.adler=b(s.adler,I.pending_buf,I.pending-S,S)),k===0&&(I.status=103)}else I.status=103;if(I.status===103&&(I.gzhead.hcrc?(I.pending+2>I.pending_buf_size&&L(s),I.pending+2<=I.pending_buf_size&&(re(I,255&s.adler),re(I,s.adler>>8&255),s.adler=0,I.status=W)):I.status=W),I.pending!==0){if(L(s),s.avail_out===0)return I.last_flush=-1,p}else if(s.avail_in===0&&Z(V)<=Z(U)&&V!==v)return le(s,-5);if(I.status===666&&s.avail_in!==0)return le(s,-5);if(s.avail_in!==0||I.lookahead!==0||V!==y&&I.status!==666){var O=I.strategy===2?function(M,z){for(var ee;;){if(M.lookahead===0&&(de(M),M.lookahead===0)){if(z===y)return d;break}if(M.match_length=0,ee=i._tr_tally(M,0,M.window[M.strstart]),M.lookahead--,M.strstart++,ee&&(B(M,!1),M.strm.avail_out===0))return d}return M.insert=0,z===v?(B(M,!0),M.strm.avail_out===0?Q:Y):M.last_lit&&(B(M,!1),M.strm.avail_out===0)?d:w}(I,V):I.strategy===3?function(M,z){for(var ee,$,X,oe,ce=M.window;;){if(M.lookahead<=G){if(de(M),M.lookahead<=G&&z===y)return d;if(M.lookahead===0)break}if(M.match_length=0,M.lookahead>=T&&0<M.strstart&&($=ce[X=M.strstart-1])===ce[++X]&&$===ce[++X]&&$===ce[++X]){oe=M.strstart+G;do;while($===ce[++X]&&$===ce[++X]&&$===ce[++X]&&$===ce[++X]&&$===ce[++X]&&$===ce[++X]&&$===ce[++X]&&$===ce[++X]&&X<oe);M.match_length=G-(oe-X),M.match_length>M.lookahead&&(M.match_length=M.lookahead)}if(M.match_length>=T?(ee=i._tr_tally(M,1,M.match_length-T),M.lookahead-=M.match_length,M.strstart+=M.match_length,M.match_length=0):(ee=i._tr_tally(M,0,M.window[M.strstart]),M.lookahead--,M.strstart++),ee&&(B(M,!1),M.strm.avail_out===0))return d}return M.insert=0,z===v?(B(M,!0),M.strm.avail_out===0?Q:Y):M.last_lit&&(B(M,!1),M.strm.avail_out===0)?d:w}(I,V):r[I.level].func(I,V);if(O!==Q&&O!==Y||(I.status=666),O===d||O===Q)return s.avail_out===0&&(I.last_flush=-1),p;if(O===w&&(V===1?i._tr_align(I):V!==5&&(i._tr_stored_block(I,0,0,!1),V===3&&(ie(I.head),I.lookahead===0&&(I.strstart=0,I.block_start=0,I.insert=0))),L(s),s.avail_out===0))return I.last_flush=-1,p}return V!==v?p:I.wrap<=0?1:(I.wrap===2?(re(I,255&s.adler),re(I,s.adler>>8&255),re(I,s.adler>>16&255),re(I,s.adler>>24&255),re(I,255&s.total_in),re(I,s.total_in>>8&255),re(I,s.total_in>>16&255),re(I,s.total_in>>24&255)):(te(I,s.adler>>>16),te(I,65535&s.adler)),L(s),0<I.wrap&&(I.wrap=-I.wrap),I.pending!==0?p:1)},c.deflateEnd=function(s){var V;return s&&s.state?(V=s.state.status)!==A&&V!==69&&V!==73&&V!==91&&V!==103&&V!==W&&V!==666?le(s,m):(s.state=null,V===W?le(s,-3):p):m},c.deflateSetDictionary=function(s,V){var U,I,S,k,F,O,M,z,ee=V.length;if(!s||!s.state||(k=(U=s.state).wrap)===2||k===1&&U.status!==A||U.lookahead)return m;for(k===1&&(s.adler=u(s.adler,V,ee,0)),U.wrap=0,ee>=U.w_size&&(k===0&&(ie(U.head),U.strstart=0,U.block_start=0,U.insert=0),z=new o.Buf8(U.w_size),o.arraySet(z,V,ee-U.w_size,U.w_size,0),V=z,ee=U.w_size),F=s.avail_in,O=s.next_in,M=s.input,s.avail_in=ee,s.next_in=0,s.input=V,de(U);U.lookahead>=T;){for(I=U.strstart,S=U.lookahead-(T-1);U.ins_h=(U.ins_h<<U.hash_shift^U.window[I+T-1])&U.hash_mask,U.prev[I&U.w_mask]=U.head[U.ins_h],U.head[U.ins_h]=I,I++,--S;);U.strstart=I,U.lookahead=T-1,de(U)}return U.strstart+=U.lookahead,U.block_start=U.strstart,U.insert=U.lookahead,U.lookahead=0,U.match_length=U.prev_length=T-1,U.match_available=0,s.next_in=O,s.input=M,s.avail_in=F,U.wrap=k,p},c.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(n,g,c){g.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(n,g,c){g.exports=function(r,o){var i,u,b,a,y,v,p,m,l,x,h,C,E,D,j,_,N,H,T,G,ne,A,W,d,w;i=r.state,u=r.next_in,d=r.input,b=u+(r.avail_in-5),a=r.next_out,w=r.output,y=a-(o-r.avail_out),v=a+(r.avail_out-257),p=i.dmax,m=i.wsize,l=i.whave,x=i.wnext,h=i.window,C=i.hold,E=i.bits,D=i.lencode,j=i.distcode,_=(1<<i.lenbits)-1,N=(1<<i.distbits)-1;e:do{E<15&&(C+=d[u++]<<E,E+=8,C+=d[u++]<<E,E+=8),H=D[C&_];t:for(;;){if(C>>>=T=H>>>24,E-=T,(T=H>>>16&255)===0)w[a++]=65535&H;else{if(!(16&T)){if(!(64&T)){H=D[(65535&H)+(C&(1<<T)-1)];continue t}if(32&T){i.mode=12;break e}r.msg="invalid literal/length code",i.mode=30;break e}G=65535&H,(T&=15)&&(E<T&&(C+=d[u++]<<E,E+=8),G+=C&(1<<T)-1,C>>>=T,E-=T),E<15&&(C+=d[u++]<<E,E+=8,C+=d[u++]<<E,E+=8),H=j[C&N];i:for(;;){if(C>>>=T=H>>>24,E-=T,!(16&(T=H>>>16&255))){if(!(64&T)){H=j[(65535&H)+(C&(1<<T)-1)];continue i}r.msg="invalid distance code",i.mode=30;break e}if(ne=65535&H,E<(T&=15)&&(C+=d[u++]<<E,(E+=8)<T&&(C+=d[u++]<<E,E+=8)),p<(ne+=C&(1<<T)-1)){r.msg="invalid distance too far back",i.mode=30;break e}if(C>>>=T,E-=T,(T=a-y)<ne){if(l<(T=ne-T)&&i.sane){r.msg="invalid distance too far back",i.mode=30;break e}if(W=h,(A=0)===x){if(A+=m-T,T<G){for(G-=T;w[a++]=h[A++],--T;);A=a-ne,W=w}}else if(x<T){if(A+=m+x-T,(T-=x)<G){for(G-=T;w[a++]=h[A++],--T;);if(A=0,x<G){for(G-=T=x;w[a++]=h[A++],--T;);A=a-ne,W=w}}}else if(A+=x-T,T<G){for(G-=T;w[a++]=h[A++],--T;);A=a-ne,W=w}for(;2<G;)w[a++]=W[A++],w[a++]=W[A++],w[a++]=W[A++],G-=3;G&&(w[a++]=W[A++],1<G&&(w[a++]=W[A++]))}else{for(A=a-ne;w[a++]=w[A++],w[a++]=w[A++],w[a++]=w[A++],2<(G-=3););G&&(w[a++]=w[A++],1<G&&(w[a++]=w[A++]))}break}}break}}while(u<b&&a<v);u-=G=E>>3,C&=(1<<(E-=G<<3))-1,r.next_in=u,r.next_out=a,r.avail_in=u<b?b-u+5:5-(u-b),r.avail_out=a<v?v-a+257:257-(a-v),i.hold=C,i.bits=E}},{}],49:[function(n,g,c){var r=n("../utils/common"),o=n("./adler32"),i=n("./crc32"),u=n("./inffast"),b=n("./inftrees"),a=1,y=2,v=0,p=-2,m=1,l=852,x=592;function h(A){return(A>>>24&255)+(A>>>8&65280)+((65280&A)<<8)+((255&A)<<24)}function C(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new r.Buf16(320),this.work=new r.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function E(A){var W;return A&&A.state?(W=A.state,A.total_in=A.total_out=W.total=0,A.msg="",W.wrap&&(A.adler=1&W.wrap),W.mode=m,W.last=0,W.havedict=0,W.dmax=32768,W.head=null,W.hold=0,W.bits=0,W.lencode=W.lendyn=new r.Buf32(l),W.distcode=W.distdyn=new r.Buf32(x),W.sane=1,W.back=-1,v):p}function D(A){var W;return A&&A.state?((W=A.state).wsize=0,W.whave=0,W.wnext=0,E(A)):p}function j(A,W){var d,w;return A&&A.state?(w=A.state,W<0?(d=0,W=-W):(d=1+(W>>4),W<48&&(W&=15)),W&&(W<8||15<W)?p:(w.window!==null&&w.wbits!==W&&(w.window=null),w.wrap=d,w.wbits=W,D(A))):p}function _(A,W){var d,w;return A?(w=new C,(A.state=w).window=null,(d=j(A,W))!==v&&(A.state=null),d):p}var N,H,T=!0;function G(A){if(T){var W;for(N=new r.Buf32(512),H=new r.Buf32(32),W=0;W<144;)A.lens[W++]=8;for(;W<256;)A.lens[W++]=9;for(;W<280;)A.lens[W++]=7;for(;W<288;)A.lens[W++]=8;for(b(a,A.lens,0,288,N,0,A.work,{bits:9}),W=0;W<32;)A.lens[W++]=5;b(y,A.lens,0,32,H,0,A.work,{bits:5}),T=!1}A.lencode=N,A.lenbits=9,A.distcode=H,A.distbits=5}function ne(A,W,d,w){var Q,Y=A.state;return Y.window===null&&(Y.wsize=1<<Y.wbits,Y.wnext=0,Y.whave=0,Y.window=new r.Buf8(Y.wsize)),w>=Y.wsize?(r.arraySet(Y.window,W,d-Y.wsize,Y.wsize,0),Y.wnext=0,Y.whave=Y.wsize):(w<(Q=Y.wsize-Y.wnext)&&(Q=w),r.arraySet(Y.window,W,d-w,Q,Y.wnext),(w-=Q)?(r.arraySet(Y.window,W,d-w,w,0),Y.wnext=w,Y.whave=Y.wsize):(Y.wnext+=Q,Y.wnext===Y.wsize&&(Y.wnext=0),Y.whave<Y.wsize&&(Y.whave+=Q))),0}c.inflateReset=D,c.inflateReset2=j,c.inflateResetKeep=E,c.inflateInit=function(A){return _(A,15)},c.inflateInit2=_,c.inflate=function(A,W){var d,w,Q,Y,le,Z,ie,L,B,re,te,q,de,be,ue,he,Se,ge,Ie,Ae,s,V,U,I,S=0,k=new r.Buf8(4),F=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!A||!A.state||!A.output||!A.input&&A.avail_in!==0)return p;(d=A.state).mode===12&&(d.mode=13),le=A.next_out,Q=A.output,ie=A.avail_out,Y=A.next_in,w=A.input,Z=A.avail_in,L=d.hold,B=d.bits,re=Z,te=ie,V=v;e:for(;;)switch(d.mode){case m:if(d.wrap===0){d.mode=13;break}for(;B<16;){if(Z===0)break e;Z--,L+=w[Y++]<<B,B+=8}if(2&d.wrap&&L===35615){k[d.check=0]=255&L,k[1]=L>>>8&255,d.check=i(d.check,k,2,0),B=L=0,d.mode=2;break}if(d.flags=0,d.head&&(d.head.done=!1),!(1&d.wrap)||(((255&L)<<8)+(L>>8))%31){A.msg="incorrect header check",d.mode=30;break}if((15&L)!=8){A.msg="unknown compression method",d.mode=30;break}if(B-=4,s=8+(15&(L>>>=4)),d.wbits===0)d.wbits=s;else if(s>d.wbits){A.msg="invalid window size",d.mode=30;break}d.dmax=1<<s,A.adler=d.check=1,d.mode=512&L?10:12,B=L=0;break;case 2:for(;B<16;){if(Z===0)break e;Z--,L+=w[Y++]<<B,B+=8}if(d.flags=L,(255&d.flags)!=8){A.msg="unknown compression method",d.mode=30;break}if(57344&d.flags){A.msg="unknown header flags set",d.mode=30;break}d.head&&(d.head.text=L>>8&1),512&d.flags&&(k[0]=255&L,k[1]=L>>>8&255,d.check=i(d.check,k,2,0)),B=L=0,d.mode=3;case 3:for(;B<32;){if(Z===0)break e;Z--,L+=w[Y++]<<B,B+=8}d.head&&(d.head.time=L),512&d.flags&&(k[0]=255&L,k[1]=L>>>8&255,k[2]=L>>>16&255,k[3]=L>>>24&255,d.check=i(d.check,k,4,0)),B=L=0,d.mode=4;case 4:for(;B<16;){if(Z===0)break e;Z--,L+=w[Y++]<<B,B+=8}d.head&&(d.head.xflags=255&L,d.head.os=L>>8),512&d.flags&&(k[0]=255&L,k[1]=L>>>8&255,d.check=i(d.check,k,2,0)),B=L=0,d.mode=5;case 5:if(1024&d.flags){for(;B<16;){if(Z===0)break e;Z--,L+=w[Y++]<<B,B+=8}d.length=L,d.head&&(d.head.extra_len=L),512&d.flags&&(k[0]=255&L,k[1]=L>>>8&255,d.check=i(d.check,k,2,0)),B=L=0}else d.head&&(d.head.extra=null);d.mode=6;case 6:if(1024&d.flags&&(Z<(q=d.length)&&(q=Z),q&&(d.head&&(s=d.head.extra_len-d.length,d.head.extra||(d.head.extra=new Array(d.head.extra_len)),r.arraySet(d.head.extra,w,Y,q,s)),512&d.flags&&(d.check=i(d.check,w,q,Y)),Z-=q,Y+=q,d.length-=q),d.length))break e;d.length=0,d.mode=7;case 7:if(2048&d.flags){if(Z===0)break e;for(q=0;s=w[Y+q++],d.head&&s&&d.length<65536&&(d.head.name+=String.fromCharCode(s)),s&&q<Z;);if(512&d.flags&&(d.check=i(d.check,w,q,Y)),Z-=q,Y+=q,s)break e}else d.head&&(d.head.name=null);d.length=0,d.mode=8;case 8:if(4096&d.flags){if(Z===0)break e;for(q=0;s=w[Y+q++],d.head&&s&&d.length<65536&&(d.head.comment+=String.fromCharCode(s)),s&&q<Z;);if(512&d.flags&&(d.check=i(d.check,w,q,Y)),Z-=q,Y+=q,s)break e}else d.head&&(d.head.comment=null);d.mode=9;case 9:if(512&d.flags){for(;B<16;){if(Z===0)break e;Z--,L+=w[Y++]<<B,B+=8}if(L!==(65535&d.check)){A.msg="header crc mismatch",d.mode=30;break}B=L=0}d.head&&(d.head.hcrc=d.flags>>9&1,d.head.done=!0),A.adler=d.check=0,d.mode=12;break;case 10:for(;B<32;){if(Z===0)break e;Z--,L+=w[Y++]<<B,B+=8}A.adler=d.check=h(L),B=L=0,d.mode=11;case 11:if(d.havedict===0)return A.next_out=le,A.avail_out=ie,A.next_in=Y,A.avail_in=Z,d.hold=L,d.bits=B,2;A.adler=d.check=1,d.mode=12;case 12:if(W===5||W===6)break e;case 13:if(d.last){L>>>=7&B,B-=7&B,d.mode=27;break}for(;B<3;){if(Z===0)break e;Z--,L+=w[Y++]<<B,B+=8}switch(d.last=1&L,B-=1,3&(L>>>=1)){case 0:d.mode=14;break;case 1:if(G(d),d.mode=20,W!==6)break;L>>>=2,B-=2;break e;case 2:d.mode=17;break;case 3:A.msg="invalid block type",d.mode=30}L>>>=2,B-=2;break;case 14:for(L>>>=7&B,B-=7&B;B<32;){if(Z===0)break e;Z--,L+=w[Y++]<<B,B+=8}if((65535&L)!=(L>>>16^65535)){A.msg="invalid stored block lengths",d.mode=30;break}if(d.length=65535&L,B=L=0,d.mode=15,W===6)break e;case 15:d.mode=16;case 16:if(q=d.length){if(Z<q&&(q=Z),ie<q&&(q=ie),q===0)break e;r.arraySet(Q,w,Y,q,le),Z-=q,Y+=q,ie-=q,le+=q,d.length-=q;break}d.mode=12;break;case 17:for(;B<14;){if(Z===0)break e;Z--,L+=w[Y++]<<B,B+=8}if(d.nlen=257+(31&L),L>>>=5,B-=5,d.ndist=1+(31&L),L>>>=5,B-=5,d.ncode=4+(15&L),L>>>=4,B-=4,286<d.nlen||30<d.ndist){A.msg="too many length or distance symbols",d.mode=30;break}d.have=0,d.mode=18;case 18:for(;d.have<d.ncode;){for(;B<3;){if(Z===0)break e;Z--,L+=w[Y++]<<B,B+=8}d.lens[F[d.have++]]=7&L,L>>>=3,B-=3}for(;d.have<19;)d.lens[F[d.have++]]=0;if(d.lencode=d.lendyn,d.lenbits=7,U={bits:d.lenbits},V=b(0,d.lens,0,19,d.lencode,0,d.work,U),d.lenbits=U.bits,V){A.msg="invalid code lengths set",d.mode=30;break}d.have=0,d.mode=19;case 19:for(;d.have<d.nlen+d.ndist;){for(;he=(S=d.lencode[L&(1<<d.lenbits)-1])>>>16&255,Se=65535&S,!((ue=S>>>24)<=B);){if(Z===0)break e;Z--,L+=w[Y++]<<B,B+=8}if(Se<16)L>>>=ue,B-=ue,d.lens[d.have++]=Se;else{if(Se===16){for(I=ue+2;B<I;){if(Z===0)break e;Z--,L+=w[Y++]<<B,B+=8}if(L>>>=ue,B-=ue,d.have===0){A.msg="invalid bit length repeat",d.mode=30;break}s=d.lens[d.have-1],q=3+(3&L),L>>>=2,B-=2}else if(Se===17){for(I=ue+3;B<I;){if(Z===0)break e;Z--,L+=w[Y++]<<B,B+=8}B-=ue,s=0,q=3+(7&(L>>>=ue)),L>>>=3,B-=3}else{for(I=ue+7;B<I;){if(Z===0)break e;Z--,L+=w[Y++]<<B,B+=8}B-=ue,s=0,q=11+(127&(L>>>=ue)),L>>>=7,B-=7}if(d.have+q>d.nlen+d.ndist){A.msg="invalid bit length repeat",d.mode=30;break}for(;q--;)d.lens[d.have++]=s}}if(d.mode===30)break;if(d.lens[256]===0){A.msg="invalid code -- missing end-of-block",d.mode=30;break}if(d.lenbits=9,U={bits:d.lenbits},V=b(a,d.lens,0,d.nlen,d.lencode,0,d.work,U),d.lenbits=U.bits,V){A.msg="invalid literal/lengths set",d.mode=30;break}if(d.distbits=6,d.distcode=d.distdyn,U={bits:d.distbits},V=b(y,d.lens,d.nlen,d.ndist,d.distcode,0,d.work,U),d.distbits=U.bits,V){A.msg="invalid distances set",d.mode=30;break}if(d.mode=20,W===6)break e;case 20:d.mode=21;case 21:if(6<=Z&&258<=ie){A.next_out=le,A.avail_out=ie,A.next_in=Y,A.avail_in=Z,d.hold=L,d.bits=B,u(A,te),le=A.next_out,Q=A.output,ie=A.avail_out,Y=A.next_in,w=A.input,Z=A.avail_in,L=d.hold,B=d.bits,d.mode===12&&(d.back=-1);break}for(d.back=0;he=(S=d.lencode[L&(1<<d.lenbits)-1])>>>16&255,Se=65535&S,!((ue=S>>>24)<=B);){if(Z===0)break e;Z--,L+=w[Y++]<<B,B+=8}if(he&&!(240&he)){for(ge=ue,Ie=he,Ae=Se;he=(S=d.lencode[Ae+((L&(1<<ge+Ie)-1)>>ge)])>>>16&255,Se=65535&S,!(ge+(ue=S>>>24)<=B);){if(Z===0)break e;Z--,L+=w[Y++]<<B,B+=8}L>>>=ge,B-=ge,d.back+=ge}if(L>>>=ue,B-=ue,d.back+=ue,d.length=Se,he===0){d.mode=26;break}if(32&he){d.back=-1,d.mode=12;break}if(64&he){A.msg="invalid literal/length code",d.mode=30;break}d.extra=15&he,d.mode=22;case 22:if(d.extra){for(I=d.extra;B<I;){if(Z===0)break e;Z--,L+=w[Y++]<<B,B+=8}d.length+=L&(1<<d.extra)-1,L>>>=d.extra,B-=d.extra,d.back+=d.extra}d.was=d.length,d.mode=23;case 23:for(;he=(S=d.distcode[L&(1<<d.distbits)-1])>>>16&255,Se=65535&S,!((ue=S>>>24)<=B);){if(Z===0)break e;Z--,L+=w[Y++]<<B,B+=8}if(!(240&he)){for(ge=ue,Ie=he,Ae=Se;he=(S=d.distcode[Ae+((L&(1<<ge+Ie)-1)>>ge)])>>>16&255,Se=65535&S,!(ge+(ue=S>>>24)<=B);){if(Z===0)break e;Z--,L+=w[Y++]<<B,B+=8}L>>>=ge,B-=ge,d.back+=ge}if(L>>>=ue,B-=ue,d.back+=ue,64&he){A.msg="invalid distance code",d.mode=30;break}d.offset=Se,d.extra=15&he,d.mode=24;case 24:if(d.extra){for(I=d.extra;B<I;){if(Z===0)break e;Z--,L+=w[Y++]<<B,B+=8}d.offset+=L&(1<<d.extra)-1,L>>>=d.extra,B-=d.extra,d.back+=d.extra}if(d.offset>d.dmax){A.msg="invalid distance too far back",d.mode=30;break}d.mode=25;case 25:if(ie===0)break e;if(q=te-ie,d.offset>q){if((q=d.offset-q)>d.whave&&d.sane){A.msg="invalid distance too far back",d.mode=30;break}de=q>d.wnext?(q-=d.wnext,d.wsize-q):d.wnext-q,q>d.length&&(q=d.length),be=d.window}else be=Q,de=le-d.offset,q=d.length;for(ie<q&&(q=ie),ie-=q,d.length-=q;Q[le++]=be[de++],--q;);d.length===0&&(d.mode=21);break;case 26:if(ie===0)break e;Q[le++]=d.length,ie--,d.mode=21;break;case 27:if(d.wrap){for(;B<32;){if(Z===0)break e;Z--,L|=w[Y++]<<B,B+=8}if(te-=ie,A.total_out+=te,d.total+=te,te&&(A.adler=d.check=d.flags?i(d.check,Q,te,le-te):o(d.check,Q,te,le-te)),te=ie,(d.flags?L:h(L))!==d.check){A.msg="incorrect data check",d.mode=30;break}B=L=0}d.mode=28;case 28:if(d.wrap&&d.flags){for(;B<32;){if(Z===0)break e;Z--,L+=w[Y++]<<B,B+=8}if(L!==(4294967295&d.total)){A.msg="incorrect length check",d.mode=30;break}B=L=0}d.mode=29;case 29:V=1;break e;case 30:V=-3;break e;case 31:return-4;case 32:default:return p}return A.next_out=le,A.avail_out=ie,A.next_in=Y,A.avail_in=Z,d.hold=L,d.bits=B,(d.wsize||te!==A.avail_out&&d.mode<30&&(d.mode<27||W!==4))&&ne(A,A.output,A.next_out,te-A.avail_out)?(d.mode=31,-4):(re-=A.avail_in,te-=A.avail_out,A.total_in+=re,A.total_out+=te,d.total+=te,d.wrap&&te&&(A.adler=d.check=d.flags?i(d.check,Q,te,A.next_out-te):o(d.check,Q,te,A.next_out-te)),A.data_type=d.bits+(d.last?64:0)+(d.mode===12?128:0)+(d.mode===20||d.mode===15?256:0),(re==0&&te===0||W===4)&&V===v&&(V=-5),V)},c.inflateEnd=function(A){if(!A||!A.state)return p;var W=A.state;return W.window&&(W.window=null),A.state=null,v},c.inflateGetHeader=function(A,W){var d;return A&&A.state&&2&(d=A.state).wrap?((d.head=W).done=!1,v):p},c.inflateSetDictionary=function(A,W){var d,w=W.length;return A&&A.state?(d=A.state).wrap!==0&&d.mode!==11?p:d.mode===11&&o(1,W,w,0)!==d.check?-3:ne(A,W,w,w)?(d.mode=31,-4):(d.havedict=1,v):p},c.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(n,g,c){var r=n("../utils/common"),o=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],i=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],u=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],b=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];g.exports=function(a,y,v,p,m,l,x,h){var C,E,D,j,_,N,H,T,G,ne=h.bits,A=0,W=0,d=0,w=0,Q=0,Y=0,le=0,Z=0,ie=0,L=0,B=null,re=0,te=new r.Buf16(16),q=new r.Buf16(16),de=null,be=0;for(A=0;A<=15;A++)te[A]=0;for(W=0;W<p;W++)te[y[v+W]]++;for(Q=ne,w=15;1<=w&&te[w]===0;w--);if(w<Q&&(Q=w),w===0)return m[l++]=20971520,m[l++]=20971520,h.bits=1,0;for(d=1;d<w&&te[d]===0;d++);for(Q<d&&(Q=d),A=Z=1;A<=15;A++)if(Z<<=1,(Z-=te[A])<0)return-1;if(0<Z&&(a===0||w!==1))return-1;for(q[1]=0,A=1;A<15;A++)q[A+1]=q[A]+te[A];for(W=0;W<p;W++)y[v+W]!==0&&(x[q[y[v+W]]++]=W);if(N=a===0?(B=de=x,19):a===1?(B=o,re-=257,de=i,be-=257,256):(B=u,de=b,-1),A=d,_=l,le=W=L=0,D=-1,j=(ie=1<<(Y=Q))-1,a===1&&852<ie||a===2&&592<ie)return 1;for(;;){for(H=A-le,G=x[W]<N?(T=0,x[W]):x[W]>N?(T=de[be+x[W]],B[re+x[W]]):(T=96,0),C=1<<A-le,d=E=1<<Y;m[_+(L>>le)+(E-=C)]=H<<24|T<<16|G|0,E!==0;);for(C=1<<A-1;L&C;)C>>=1;if(C!==0?(L&=C-1,L+=C):L=0,W++,--te[A]==0){if(A===w)break;A=y[v+x[W]]}if(Q<A&&(L&j)!==D){for(le===0&&(le=Q),_+=d,Z=1<<(Y=A-le);Y+le<w&&!((Z-=te[Y+le])<=0);)Y++,Z<<=1;if(ie+=1<<Y,a===1&&852<ie||a===2&&592<ie)return 1;m[D=L&j]=Q<<24|Y<<16|_-l|0}}return L!==0&&(m[_+L]=A-le<<24|64<<16|0),h.bits=Q,0}},{"../utils/common":41}],51:[function(n,g,c){g.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(n,g,c){var r=n("../utils/common"),o=0,i=1;function u(S){for(var k=S.length;0<=--k;)S[k]=0}var b=0,a=29,y=256,v=y+1+a,p=30,m=19,l=2*v+1,x=15,h=16,C=7,E=256,D=16,j=17,_=18,N=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],H=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],T=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],G=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],ne=new Array(2*(v+2));u(ne);var A=new Array(2*p);u(A);var W=new Array(512);u(W);var d=new Array(256);u(d);var w=new Array(a);u(w);var Q,Y,le,Z=new Array(p);function ie(S,k,F,O,M){this.static_tree=S,this.extra_bits=k,this.extra_base=F,this.elems=O,this.max_length=M,this.has_stree=S&&S.length}function L(S,k){this.dyn_tree=S,this.max_code=0,this.stat_desc=k}function B(S){return S<256?W[S]:W[256+(S>>>7)]}function re(S,k){S.pending_buf[S.pending++]=255&k,S.pending_buf[S.pending++]=k>>>8&255}function te(S,k,F){S.bi_valid>h-F?(S.bi_buf|=k<<S.bi_valid&65535,re(S,S.bi_buf),S.bi_buf=k>>h-S.bi_valid,S.bi_valid+=F-h):(S.bi_buf|=k<<S.bi_valid&65535,S.bi_valid+=F)}function q(S,k,F){te(S,F[2*k],F[2*k+1])}function de(S,k){for(var F=0;F|=1&S,S>>>=1,F<<=1,0<--k;);return F>>>1}function be(S,k,F){var O,M,z=new Array(x+1),ee=0;for(O=1;O<=x;O++)z[O]=ee=ee+F[O-1]<<1;for(M=0;M<=k;M++){var $=S[2*M+1];$!==0&&(S[2*M]=de(z[$]++,$))}}function ue(S){var k;for(k=0;k<v;k++)S.dyn_ltree[2*k]=0;for(k=0;k<p;k++)S.dyn_dtree[2*k]=0;for(k=0;k<m;k++)S.bl_tree[2*k]=0;S.dyn_ltree[2*E]=1,S.opt_len=S.static_len=0,S.last_lit=S.matches=0}function he(S){8<S.bi_valid?re(S,S.bi_buf):0<S.bi_valid&&(S.pending_buf[S.pending++]=S.bi_buf),S.bi_buf=0,S.bi_valid=0}function Se(S,k,F,O){var M=2*k,z=2*F;return S[M]<S[z]||S[M]===S[z]&&O[k]<=O[F]}function ge(S,k,F){for(var O=S.heap[F],M=F<<1;M<=S.heap_len&&(M<S.heap_len&&Se(k,S.heap[M+1],S.heap[M],S.depth)&&M++,!Se(k,O,S.heap[M],S.depth));)S.heap[F]=S.heap[M],F=M,M<<=1;S.heap[F]=O}function Ie(S,k,F){var O,M,z,ee,$=0;if(S.last_lit!==0)for(;O=S.pending_buf[S.d_buf+2*$]<<8|S.pending_buf[S.d_buf+2*$+1],M=S.pending_buf[S.l_buf+$],$++,O===0?q(S,M,k):(q(S,(z=d[M])+y+1,k),(ee=N[z])!==0&&te(S,M-=w[z],ee),q(S,z=B(--O),F),(ee=H[z])!==0&&te(S,O-=Z[z],ee)),$<S.last_lit;);q(S,E,k)}function Ae(S,k){var F,O,M,z=k.dyn_tree,ee=k.stat_desc.static_tree,$=k.stat_desc.has_stree,X=k.stat_desc.elems,oe=-1;for(S.heap_len=0,S.heap_max=l,F=0;F<X;F++)z[2*F]!==0?(S.heap[++S.heap_len]=oe=F,S.depth[F]=0):z[2*F+1]=0;for(;S.heap_len<2;)z[2*(M=S.heap[++S.heap_len]=oe<2?++oe:0)]=1,S.depth[M]=0,S.opt_len--,$&&(S.static_len-=ee[2*M+1]);for(k.max_code=oe,F=S.heap_len>>1;1<=F;F--)ge(S,z,F);for(M=X;F=S.heap[1],S.heap[1]=S.heap[S.heap_len--],ge(S,z,1),O=S.heap[1],S.heap[--S.heap_max]=F,S.heap[--S.heap_max]=O,z[2*M]=z[2*F]+z[2*O],S.depth[M]=(S.depth[F]>=S.depth[O]?S.depth[F]:S.depth[O])+1,z[2*F+1]=z[2*O+1]=M,S.heap[1]=M++,ge(S,z,1),2<=S.heap_len;);S.heap[--S.heap_max]=S.heap[1],function(ce,ae){var _e,xe,ze,me,Oe,Ne,Me=ae.dyn_tree,qe=ae.max_code,Je=ae.stat_desc.static_tree,et=ae.stat_desc.has_stree,ye=ae.stat_desc.extra_bits,Fe=ae.stat_desc.extra_base,Le=ae.stat_desc.max_length,He=0;for(me=0;me<=x;me++)ce.bl_count[me]=0;for(Me[2*ce.heap[ce.heap_max]+1]=0,_e=ce.heap_max+1;_e<l;_e++)Le<(me=Me[2*Me[2*(xe=ce.heap[_e])+1]+1]+1)&&(me=Le,He++),Me[2*xe+1]=me,qe<xe||(ce.bl_count[me]++,Oe=0,Fe<=xe&&(Oe=ye[xe-Fe]),Ne=Me[2*xe],ce.opt_len+=Ne*(me+Oe),et&&(ce.static_len+=Ne*(Je[2*xe+1]+Oe)));if(He!==0){do{for(me=Le-1;ce.bl_count[me]===0;)me--;ce.bl_count[me]--,ce.bl_count[me+1]+=2,ce.bl_count[Le]--,He-=2}while(0<He);for(me=Le;me!==0;me--)for(xe=ce.bl_count[me];xe!==0;)qe<(ze=ce.heap[--_e])||(Me[2*ze+1]!==me&&(ce.opt_len+=(me-Me[2*ze+1])*Me[2*ze],Me[2*ze+1]=me),xe--)}}(S,k),be(z,oe,S.bl_count)}function s(S,k,F){var O,M,z=-1,ee=k[1],$=0,X=7,oe=4;for(ee===0&&(X=138,oe=3),k[2*(F+1)+1]=65535,O=0;O<=F;O++)M=ee,ee=k[2*(O+1)+1],++$<X&&M===ee||($<oe?S.bl_tree[2*M]+=$:M!==0?(M!==z&&S.bl_tree[2*M]++,S.bl_tree[2*D]++):$<=10?S.bl_tree[2*j]++:S.bl_tree[2*_]++,z=M,oe=($=0)===ee?(X=138,3):M===ee?(X=6,3):(X=7,4))}function V(S,k,F){var O,M,z=-1,ee=k[1],$=0,X=7,oe=4;for(ee===0&&(X=138,oe=3),O=0;O<=F;O++)if(M=ee,ee=k[2*(O+1)+1],!(++$<X&&M===ee)){if($<oe)for(;q(S,M,S.bl_tree),--$!=0;);else M!==0?(M!==z&&(q(S,M,S.bl_tree),$--),q(S,D,S.bl_tree),te(S,$-3,2)):$<=10?(q(S,j,S.bl_tree),te(S,$-3,3)):(q(S,_,S.bl_tree),te(S,$-11,7));z=M,oe=($=0)===ee?(X=138,3):M===ee?(X=6,3):(X=7,4)}}u(Z);var U=!1;function I(S,k,F,O){te(S,(b<<1)+(O?1:0),3),function(M,z,ee,$){he(M),re(M,ee),re(M,~ee),r.arraySet(M.pending_buf,M.window,z,ee,M.pending),M.pending+=ee}(S,k,F)}c._tr_init=function(S){U||(function(){var k,F,O,M,z,ee=new Array(x+1);for(M=O=0;M<a-1;M++)for(w[M]=O,k=0;k<1<<N[M];k++)d[O++]=M;for(d[O-1]=M,M=z=0;M<16;M++)for(Z[M]=z,k=0;k<1<<H[M];k++)W[z++]=M;for(z>>=7;M<p;M++)for(Z[M]=z<<7,k=0;k<1<<H[M]-7;k++)W[256+z++]=M;for(F=0;F<=x;F++)ee[F]=0;for(k=0;k<=143;)ne[2*k+1]=8,k++,ee[8]++;for(;k<=255;)ne[2*k+1]=9,k++,ee[9]++;for(;k<=279;)ne[2*k+1]=7,k++,ee[7]++;for(;k<=287;)ne[2*k+1]=8,k++,ee[8]++;for(be(ne,v+1,ee),k=0;k<p;k++)A[2*k+1]=5,A[2*k]=de(k,5);Q=new ie(ne,N,y+1,v,x),Y=new ie(A,H,0,p,x),le=new ie(new Array(0),T,0,m,C)}(),U=!0),S.l_desc=new L(S.dyn_ltree,Q),S.d_desc=new L(S.dyn_dtree,Y),S.bl_desc=new L(S.bl_tree,le),S.bi_buf=0,S.bi_valid=0,ue(S)},c._tr_stored_block=I,c._tr_flush_block=function(S,k,F,O){var M,z,ee=0;0<S.level?(S.strm.data_type===2&&(S.strm.data_type=function($){var X,oe=4093624447;for(X=0;X<=31;X++,oe>>>=1)if(1&oe&&$.dyn_ltree[2*X]!==0)return o;if($.dyn_ltree[18]!==0||$.dyn_ltree[20]!==0||$.dyn_ltree[26]!==0)return i;for(X=32;X<y;X++)if($.dyn_ltree[2*X]!==0)return i;return o}(S)),Ae(S,S.l_desc),Ae(S,S.d_desc),ee=function($){var X;for(s($,$.dyn_ltree,$.l_desc.max_code),s($,$.dyn_dtree,$.d_desc.max_code),Ae($,$.bl_desc),X=m-1;3<=X&&$.bl_tree[2*G[X]+1]===0;X--);return $.opt_len+=3*(X+1)+5+5+4,X}(S),M=S.opt_len+3+7>>>3,(z=S.static_len+3+7>>>3)<=M&&(M=z)):M=z=F+5,F+4<=M&&k!==-1?I(S,k,F,O):S.strategy===4||z===M?(te(S,2+(O?1:0),3),Ie(S,ne,A)):(te(S,4+(O?1:0),3),function($,X,oe,ce){var ae;for(te($,X-257,5),te($,oe-1,5),te($,ce-4,4),ae=0;ae<ce;ae++)te($,$.bl_tree[2*G[ae]+1],3);V($,$.dyn_ltree,X-1),V($,$.dyn_dtree,oe-1)}(S,S.l_desc.max_code+1,S.d_desc.max_code+1,ee+1),Ie(S,S.dyn_ltree,S.dyn_dtree)),ue(S),O&&he(S)},c._tr_tally=function(S,k,F){return S.pending_buf[S.d_buf+2*S.last_lit]=k>>>8&255,S.pending_buf[S.d_buf+2*S.last_lit+1]=255&k,S.pending_buf[S.l_buf+S.last_lit]=255&F,S.last_lit++,k===0?S.dyn_ltree[2*F]++:(S.matches++,k--,S.dyn_ltree[2*(d[F]+y+1)]++,S.dyn_dtree[2*B(k)]++),S.last_lit===S.lit_bufsize-1},c._tr_align=function(S){te(S,2,3),q(S,E,ne),function(k){k.bi_valid===16?(re(k,k.bi_buf),k.bi_buf=0,k.bi_valid=0):8<=k.bi_valid&&(k.pending_buf[k.pending++]=255&k.bi_buf,k.bi_buf>>=8,k.bi_valid-=8)}(S)}},{"../utils/common":41}],53:[function(n,g,c){g.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(n,g,c){(function(r){(function(o,i){if(!o.setImmediate){var u,b,a,y,v=1,p={},m=!1,l=o.document,x=Object.getPrototypeOf&&Object.getPrototypeOf(o);x=x&&x.setTimeout?x:o,u={}.toString.call(o.process)==="[object process]"?function(D){process.nextTick(function(){C(D)})}:function(){if(o.postMessage&&!o.importScripts){var D=!0,j=o.onmessage;return o.onmessage=function(){D=!1},o.postMessage("","*"),o.onmessage=j,D}}()?(y="setImmediate$"+Math.random()+"$",o.addEventListener?o.addEventListener("message",E,!1):o.attachEvent("onmessage",E),function(D){o.postMessage(y+D,"*")}):o.MessageChannel?((a=new MessageChannel).port1.onmessage=function(D){C(D.data)},function(D){a.port2.postMessage(D)}):l&&"onreadystatechange"in l.createElement("script")?(b=l.documentElement,function(D){var j=l.createElement("script");j.onreadystatechange=function(){C(D),j.onreadystatechange=null,b.removeChild(j),j=null},b.appendChild(j)}):function(D){setTimeout(C,0,D)},x.setImmediate=function(D){typeof D!="function"&&(D=new Function(""+D));for(var j=new Array(arguments.length-1),_=0;_<j.length;_++)j[_]=arguments[_+1];var N={callback:D,args:j};return p[v]=N,u(v),v++},x.clearImmediate=h}function h(D){delete p[D]}function C(D){if(m)setTimeout(C,0,D);else{var j=p[D];if(j){m=!0;try{(function(_){var N=_.callback,H=_.args;switch(H.length){case 0:N();break;case 1:N(H[0]);break;case 2:N(H[0],H[1]);break;case 3:N(H[0],H[1],H[2]);break;default:N.apply(i,H)}})(j)}finally{h(D),m=!1}}}}function E(D){D.source===o&&typeof D.data=="string"&&D.data.indexOf(y)===0&&C(+D.data.slice(y.length))}})(typeof self>"u"?r===void 0?this:r:self)}).call(this,typeof ht<"u"?ht:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(Fi);var tn=Fi.exports;const nn=Ki(tn);async function We(t){const f=new TextEncoder,n=await crypto.subtle.digest("SHA-256",f.encode(t));return Array.from(new Uint8Array(n)).map(g=>g.toString(16).padStart(2,"0")).join("")}function dt(t){return t==null?"null":typeof t=="boolean"?t?"true":"false":typeof t=="number"?Number.isFinite(t)?String(t):"null":typeof t=="string"?JSON.stringify(t):Array.isArray(t)?"["+t.map(dt).join(",")+"]":typeof t=="object"?"{"+Object.keys(t).sort().map(g=>`${JSON.stringify(g)}:${dt(t[g])}`).join(",")+"}":"null"}function sn(t,f,n,g){var a,y;if(n)return{preAiReadMs:0,postAiReadMs:0,totalReadMs:0};const c=v=>{console.warn(`[ReadEpisodes:${g}] ${v}`)},r=(v,p)=>{var l;const m=(l=v.payload)==null?void 0:l[p];return new Date(m!=null?m:v.timestamp).getTime()},o=v=>{const p=t.filter(x=>{var h;return x.type==="READ_EPISODE_STARTED"&&((h=x.payload)==null?void 0:h.episodeType)===v}),m=t.filter(x=>{var h;return x.type==="READ_EPISODE_ENDED"&&((h=x.payload)==null?void 0:h.episodeType)===v});if(p.length>1&&c(`Multiple ${v} starts detected for case ${f}.`),m.length>1&&c(`Multiple ${v} ends detected for case ${f}.`),p.length===0&&m.length>0)return c(`Missing ${v} start for case ${f}.`),null;if(p.length>0&&m.length===0)return c(`Missing ${v} end for case ${f}.`),null;if(p.length===0&&m.length===0)return null;const l=r(m[0],"tEndIso")-r(p[0],"tStartIso");return Number.isFinite(l)&&l>=0?l:null},i=(a=o("PRE_AI"))!=null?a:0,u=(y=o("POST_AI"))!=null?y:0,b=i+u;return{preAiReadMs:i,postAiReadMs:u,totalReadMs:b}}const ct=class ct{constructor(f){Ce(this,"events",[]);Ce(this,"seqCounter",0);Ce(this,"addEventLock",Promise.resolve());Ce(this,"ledger",[]);Ce(this,"sessionId");Ce(this,"participantId");Ce(this,"siteId");Ce(this,"studyId");Ce(this,"protocolVersion");Ce(this,"condition");Ce(this,"caseQueue");Ce(this,"sessionStartTime");Ce(this,"metricsPerCase",[]);Ce(this,"methodsSnapshot",null);this.sessionId=f.sessionId,this.participantId=f.participantId,this.siteId=f.siteId,this.studyId=f.studyId,this.protocolVersion=f.protocolVersion,this.condition=f.condition,this.caseQueue=f.caseQueue,this.sessionStartTime=new Date}getStudyMetadata(){return{studyId:this.studyId,protocolVersion:this.protocolVersion,siteId:this.siteId}}async addEvent(f,n){const g=this.addEventLock;let c;this.addEventLock=new Promise(r=>c=r),await g;try{const r=++this.seqCounter,o=this.generateUUID(),i=new Date().toISOString(),u={id:o,seq:r,type:f,timestamp:i,payload:n},b=await We(dt({type:f,payload:n,timestamp:i})),a=this.ledger.length===0?"0".repeat(64):this.ledger[this.ledger.length-1].chainHash,y=`${a}|${b}|${i}`,v=await We(y),p={seq:r,eventId:o,eventType:f,timestamp:i,contentHash:b,previousHash:a,chainHash:v};return this.events.push(u),this.ledger.push(p),p}finally{c()}}addCaseMetrics(f){const n=f.caseId;if(!n){this.metricsPerCase.push(f);return}this.metricsPerCase.find(c=>c.caseId===n)||this.metricsPerCase.push(f)}setMethodsSnapshot(f){this.methodsSnapshot=f}async runVerifier(){const f=[];let n=null;f.push({name:"EVENT_COUNT",status:this.events.length>0?"PASS":"FAIL",message:`Found ${this.events.length} events`});const g=["SESSION_STARTED","CASE_LOADED","FINAL_ASSESSMENT"],c=new Set(this.events.map(b=>b.type)),r=g.filter(b=>!c.has(b));f.push({name:"REQUIRED_EVENTS",status:r.length===0?"PASS":"WARN",message:r.length===0?"All required events present":`Missing: ${r.join(", ")}`});let o=0;for(let b=0;b<this.ledger.length;b++){const a=this.ledger[b],y=this.events[b],v=await We(dt({type:y.type,payload:y.payload,timestamp:y.timestamp}));if(a.contentHash!==v){n=b;break}const p=b===0?"0".repeat(64):this.ledger[b-1].chainHash;if(a.previousHash!==p){n=b;break}const m=await We(`${a.previousHash}|${a.contentHash}|${a.timestamp}`);if(a.chainHash!==m){n=b;break}o++}f.push({name:"CHAIN_INTEGRITY",status:n===null?"PASS":"FAIL",message:n===null?`All ${o} chain links valid`:`Chain broken at event ${n}`});let i=!0;for(let b=1;b<this.events.length;b++)if(new Date(this.events[b].timestamp)<new Date(this.events[b-1].timestamp)){i=!1;break}return f.push({name:"TIMESTAMP_MONOTONICITY",status:i?"PASS":"WARN",message:i?"Timestamps monotonically increasing":"Timestamp ordering issue detected"}),{result:f.every(b=>b.status!=="FAIL")?"PASS":"FAIL",timestamp:new Date().toISOString(),verifierVersion:"2.0.0",checks:f,chainIntegrity:{totalEvents:this.events.length,validLinks:o,brokenAt:n}}}async generateZip(){var H,T,G,ne;const f=new nn,n=new Date,g=await this.runVerifier(),c=this.events.map(A=>JSON.stringify(A)).join(`
`),r=await We(c),o=JSON.stringify(this.ledger,null,2),i=await We(o),u=this.generateMetricsCSV(),b=await We(u),a=this.generateCodebook(),y=await We(a),v={exportVersion:"2.0.0",schemaVersion:"2.0.0",exportTimestamp:n.toISOString(),sessionId:this.sessionId,participantId:this.participantId,siteId:this.siteId,studyId:this.studyId,protocolVersion:this.protocolVersion,condition:this.condition,caseQueue:{...this.caseQueue,completedCases:this.metricsPerCase.length},integrity:{eventCount:this.events.length,firstEventHash:((H=this.ledger[0])==null?void 0:H.chainHash)||"",finalChainHash:((T=this.ledger[this.ledger.length-1])==null?void 0:T.chainHash)||"",chainValid:g.result==="PASS"},timing:{sessionStartTime:this.sessionStartTime.toISOString(),sessionEndTime:n.toISOString(),totalDurationMs:n.getTime()-this.sessionStartTime.getTime()},fileChecksums:{events:r,ledger:i,metrics:b,codebook:y},timestampTrustModel:"client_clock_untrusted"},p=JSON.stringify(g,null,2),m={"events.jsonl":c,"ledger.json":o,"verifier_output.json":p,"derived_metrics.csv":u,"codebook.md":a};this.methodsSnapshot&&(m["methods_snapshot.json"]=JSON.stringify(this.methodsSnapshot,null,2));const l=[];for(const A of Object.keys(m).sort()){const W=m[A];l.push({path:A,sha256:await We(W),bytes:new TextEncoder().encode(W).byteLength})}const x=typeof((ne=(G=this.methodsSnapshot)==null?void 0:G.errorRateDisclosure)==null?void 0:ne.policy)=="string"?this.methodsSnapshot.errorRateDisclosure.policy:null,h={condition:{revealTiming:this.condition.revealTiming,disclosureFormat:this.condition.disclosureFormat},disclosurePolicy:x,protocolVersion:this.protocolVersion,studyId:this.studyId,siteId:this.siteId,eventSchemaVersion:"EVENT_SCHEMA_V1_DRAFT"},C={disclosure:{revealTiming:this.condition.revealTiming,disclosureFormat:this.condition.disclosureFormat,policy:x},...this.protocolVersion?{protocolVersion:this.protocolVersion}:{},...this.studyId?{studyId:this.studyId}:{},...this.siteId?{siteId:this.siteId}:{}},E={schema:"evidify.export_manifest.v1",created_utc:new Date().toISOString(),methodsSnapshot:h,researchMethods:C,entries:l},D=await We(dt(E)),j=JSON.stringify(E,null,2);v.export_root_hash=D,v.export_manifest_sha256=D,f.file("trial_manifest.json",JSON.stringify(v,null,2)),f.file("export_manifest.json",j),f.file("_DEBUG_SENTINEL.txt","ExportPackZip_v1_hit"),f.file("events.jsonl",c),f.file("ledger.json",o),f.file("verifier_output.json",p),f.file("derived_metrics.csv",u),f.file("codebook.md",a),this.methodsSnapshot&&f.file("methods_snapshot.json",JSON.stringify(this.methodsSnapshot,null,2));const _=await f.generateAsync({type:"blob"}),N=`evidify_export_${this.sessionId}_${new Date().toISOString().slice(0,10)}.zip`;return{blob:_,filename:N,manifest:v,exportManifestEntries:l,verifierOutput:g}}generateMetricsCSV(){if(this.metricsPerCase.length===0)return this.generateMetricsFromEvents();const f=[];for(const o of this.metricsPerCase){const i=o.preAiReadMs;typeof i=="number"&&i>0&&f.push(i)}const n=this.computeMedian(f),g=this.metricsPerCase.map(o=>{const i=o.preAiReadMs,u=o.postAiReadMs,b=typeof i=="number"&&typeof u=="number"&&u>0?Math.round(i/u*1e3)/1e3:null,a=typeof i=="number"&&n!==null?Math.round((i-n)*100)/100:null;return{...o,timeRatio:b,sessionMedianPreAITime:n,preAITimeVsMedian:a}}),c=Object.keys(g[0]).join(","),r=g.map(o=>Object.values(o).map(i=>this.formatCsvValue(this.normalizeMetricValue(i))).join(","));return[c,...r].join(`
`)}generateMetricsFromEvents(){var u,b;this.runMetricsSelfCheckOnce();const f=this.groupEventsByCase(this.events),n=this.dedupeCaseIds(this.caseQueue.caseIds),g=[],c=[];for(const a of n){const y=(u=f.get(a))!=null?u:[],v=y.find(h=>h.type==="CASE_LOADED"),p=!!((b=v==null?void 0:v.payload)!=null&&b.isCalibration),{preAiReadMs:m,postAiReadMs:l,totalReadMs:x}=sn(y,a,p,"ExportPackZip");c.push({caseId:a,caseEvents:y,preAiReadMs:m,postAiReadMs:l,totalReadMs:x}),typeof m=="number"&&m>0&&g.push(m)}const r=this.computeMedian(g),o="sessionId,caseId,condition,initialBirads,finalBirads,aiBirads,changeOccurred,aiConsistentChange,addaDenominator,adda,preAiReadMs,postAiReadMs,totalReadMs,timeRatio,sessionMedianPreAITime,preAITimeVsMedian,aiExposureMs,totalTimeMs,timeToLockMs,lockToRevealMs,revealToFinalMs,comprehensionItemId,comprehensionAnswer,comprehensionCorrect,comprehension_question_id,comprehension_answer,comprehension_correct,comprehension_response_ms",i=c.map(({caseId:a,caseEvents:y,preAiReadMs:v,postAiReadMs:p,totalReadMs:m})=>{var ge,Ie,Ae,s,V,U,I,S,k,F,O,M,z,ee,$,X,oe,ce,ae,_e;const l=y.find(xe=>xe.type==="FIRST_IMPRESSION_LOCKED"),x=y.find(xe=>xe.type==="AI_REVEALED"),h=y.find(xe=>xe.type==="FINAL_ASSESSMENT"),C=y.find(xe=>xe.type==="CASE_LOADED"),E=y.find(xe=>xe.type==="CASE_COMPLETED"),D=y.find(xe=>xe.type==="DISCLOSURE_COMPREHENSION_RESPONSE"),j=y.find(xe=>xe.type==="DISCLOSURE_PRESENTED"),_=(Ie=(ge=l==null?void 0:l.payload)==null?void 0:ge.birads)!=null?Ie:null,N=(s=(Ae=x==null?void 0:x.payload)==null?void 0:Ae.suggestedBirads)!=null?s:null,H=(I=(U=(V=h==null?void 0:h.payload)==null?void 0:V.birads)!=null?U:_)!=null?I:null,T=_==null||H==null?null:_!==H,G=T===null||N==null||H==null?null:T&&H===N,ne=N==null||_==null?null:_!==N,A=ne?G:ne===null?null:!1,W=(S=D==null?void 0:D.payload)!=null?S:{},d=(F=(k=W.selectedAnswer)!=null?k:W.response)!=null?F:null,w=(O=W.questionId)!=null?O:null,Q=(z=(M=W.itemId)!=null?M:w)!=null?z:null,Y=($=(ee=W.isCorrect)!=null?ee:W.correct)!=null?$:null,le=D&&j?new Date(D.timestamp).getTime()-new Date(j.timestamp).getTime():null,Z=typeof le=="number"&&Number.isFinite(le)&&le>=0?le:null,ie=(xe,ze)=>{if(!xe||!ze)return null;const me=new Date(xe.timestamp).getTime(),Ne=new Date(ze.timestamp).getTime()-me;return Number.isFinite(Ne)&&Ne>=0?Ne:null},L=(X=l==null?void 0:l.payload)==null?void 0:X.timeToLockMs,B=typeof L=="number"&&Number.isFinite(L)&&L>=0?L:ie(C,l),re=(oe=ie(x,h!=null?h:E))!=null?oe:0,te=(ce=ie(C,E))!=null?ce:ie(C,h),q=typeof te=="number"?Math.max(te,1):0,de=(ae=ie(l,x))!=null?ae:0,be=(_e=ie(x,h!=null?h:E))!=null?_e:0,ue=typeof v=="number"&&typeof p=="number"&&p>0?Math.round(v/p*1e3)/1e3:null,he=typeof v=="number"&&r!==null?Math.round((v-r)*100)/100:null;return[this.sessionId,a,this.condition.revealTiming,_,H,N,T,G,ne,A,v,p,m,ue,r,he,re,q,B,de,be,Q,d,Y,w,d,Y,Z].map(xe=>this.formatCsvValue(this.normalizeMetricValue(xe))).join(",")});return[o,...i].join(`
`)}computeMedian(f){if(f.length===0)return null;const n=[...f].sort((c,r)=>c-r),g=Math.floor(n.length/2);return n.length%2===0?Math.round((n[g-1]+n[g])/2):n[g]}normalizeMetricValue(f){return f==null||typeof f=="string"&&f.trim()===""?"NA":f}formatCsvValue(f){const n=String(f);return/[",\n]/.test(n)?`"${n.replace(/"/g,'""')}"`:n}dedupeCaseIds(f){const n=new Set,g=[];for(const c of f)n.has(c)||(n.add(c),g.push(c));return g}groupEventsByCase(f){var c,r,o;const n=new Map;let g=null;for(const i of f)i.type==="CASE_LOADED"&&((c=i.payload)!=null&&c.caseId)&&(g=i.payload.caseId,n.has(g)||n.set(g,[])),g&&((r=n.get(g))==null||r.push(i)),i.type==="CASE_COMPLETED"&&((o=i.payload)!=null&&o.caseId)&&i.payload.caseId===g&&(g=null);return n}runMetricsSelfCheckOnce(){if(ct.metricsSelfCheckRan)return;ct.metricsSelfCheckRan=!0;const f=[],g=[null,void 0,"",0,!1,"ok"].map(r=>this.formatCsvValue(this.normalizeMetricValue(r)));["NA","NA","NA","0","false","ok"].forEach((r,o)=>{g[o]!==r&&f.push(`Value at ${o} expected ${r} but got ${g[o]}`)}),f.length>0&&console.warn(`ExportPackZip metrics self-check failed: ${f.join("; ")}`)}generateCodebook(){return`# Evidify Export Codebook v2.0

## Study Information
- **Study ID**: ${this.studyId||"BRPLL-MAMMO-v1.0"}
- **Protocol Version**: ${this.protocolVersion}
- **Site ID**: ${this.siteId}

## Condition Assignment
- **Reveal Timing**: ${this.condition.revealTiming}
  - HUMAN_FIRST: Reader makes initial assessment before seeing AI
  - AI_FIRST: Reader sees AI suggestion before making assessment
  - CONCURRENT: Reader sees AI and makes assessment simultaneously
- **Disclosure Format**: ${this.condition.disclosureFormat}
  - FDR_FOR: False Discovery Rate and False Omission Rate shown
  - NATURAL_FREQUENCY: "X out of 100" format
  - NONE: No error rate disclosure

## Event Types

### Session Events
- **SESSION_STARTED**: Study session initialized
- **RANDOMIZATION_ASSIGNED**: Condition randomly assigned with seed
- **SESSION_ENDED**: Study session completed

### Case Events
- **CASE_LOADED**: Mammogram case presented to reader
- **IMAGE_VIEWED**: Reader viewed/interacted with image
- **FIRST_IMPRESSION_LOCKED**: Initial BI-RADS assessment locked
- **READ_EPISODE_STARTED**: Reader starts PRE_AI/POST_AI read episode
- **READ_EPISODE_ENDED**: Reader ends PRE_AI/POST_AI read episode
- **AI_REVEALED**: AI suggestion shown to reader
- **DISCLOSURE_PRESENTED**: Error rate information shown
- **DISCLOSURE_COMPREHENSION_RESPONSE**: Reader answered comprehension check (includes itemId)
- **DEVIATION_STARTED**: Reader began changing assessment
- **DEVIATION_SUBMITTED**: Reader documented rationale for change
- **DEVIATION_SKIPPED**: Reader skipped documentation (with attestation)
- **FINAL_ASSESSMENT**: Final BI-RADS assessment submitted
- **CASE_COMPLETED**: Case processing finished

### Attention & Calibration
- **CALIBRATION_STARTED**: Training case begun
- **CALIBRATION_FEEDBACK_SHOWN**: Feedback provided on training case
- **ATTENTION_CHECK_PRESENTED**: Catch trial presented
- **ATTENTION_CHECK_RESPONSE**: Reader response to catch trial

## Derived Metrics

### Primary Outcome: ADDA (Appropriate Deference to Decision Aid)
- **adda**: TRUE if reader changed toward AI when initial ≠ AI suggestion
- **adda_denominator**: TRUE if initial assessment differed from AI (eligible for ADDA)
- **change_occurred**: TRUE if final ≠ initial assessment
- **ai_consistent_change**: TRUE if change moved toward AI suggestion

### Timing Metrics
- **timeToLockMs**: Case load → first impression lock duration
- **lockToRevealMs**: First impression lock → AI reveal duration
- **revealToFinalMs**: AI reveal → final assessment duration
- **preAiReadMs**: PRE_AI read episode duration
- **postAiReadMs**: POST_AI read episode duration
- **totalReadMs**: PRE_AI + POST_AI durations (missing parts treated as 0)
- **timeRatio**: preAiReadMs / postAiReadMs (ratio of pre-AI to post-AI reading time)
- **sessionMedianPreAITime**: Median preAiReadMs across all cases in the session
- **preAITimeVsMedian**: This case's preAiReadMs minus the session median (positive = slower than median)
- **aiExposureMs**: AI reveal → final assessment duration (AI_FIRST/concurrent)
- **totalTimeMs**: CASE_COMPLETED − CASE_LOADED (fallback: FINAL_ASSESSMENT − CASE_LOADED)
- **comprehensionItemId**: Disclosure comprehension item identifier
- **comprehensionAnswer**: Reader answer to comprehension probe
- **comprehensionCorrect**: TRUE/FALSE/NA for comprehension probe correctness

## Hash Chain Verification

Each event is linked via SHA-256 hash chain:
\`\`\`
contentHash = SHA256(canonical_json(type + payload + timestamp))
chainHash[n] = SHA256(prevChainHash | contentHash | timestamp)
\`\`\`

Verification: Run \`verify-export.ts\` on the ZIP package.

## Timestamp Trust Model
**client_clock_untrusted**: Timestamps are from client device and not independently verified.
For legal defensibility, consider server-side receipt integration.

---
Generated by Evidify Export System v2.0
Timestamp Trust Model: client_clock_untrusted
`}generateUUID(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,f=>{const n=Math.random()*16|0;return(f==="x"?n:n&3|8).toString(16)})}getEvents(){return this.events}getLedger(){return this.ledger}getMetrics(){return this.metricsPerCase}};Ce(ct,"metricsSelfCheckRan",!1);let wt=ct;class rn{constructor(f){Ce(this,"exportPack");Ce(this,"interactionCounts");Ce(this,"caseStartTime",0);Ce(this,"aiRevealTime",0);Ce(this,"currentCaseId",null);Ce(this,"roiDwellTimes",new Map);Ce(this,"currentROI",null);Ce(this,"roiEnterTime",0);this.exportPack=f,this.interactionCounts={zoom:0,pan:0,windowLevel:0,viewsFocused:new Set}}resetForNewCase(f){this.interactionCounts={zoom:0,pan:0,windowLevel:0,viewsFocused:new Set},this.roiDwellTimes.clear(),this.currentROI=null,this.caseStartTime=Date.now(),this.aiRevealTime=0,this.currentCaseId=f!=null?f:null}async addEvent(f,n){return this.exportPack.addEvent(f,n)}async logSessionStarted(f){return this.exportPack.addEvent("SESSION_STARTED",f)}async logRandomizationAssigned(f){return this.exportPack.addEvent("RANDOMIZATION_ASSIGNED",f)}async logCaseLoaded(f){return this.resetForNewCase(f.caseId),this.exportPack.addEvent("CASE_LOADED",f)}async logImageViewed(f){return this.exportPack.addEvent("IMAGE_VIEWED",f)}async logViewportChanged(f){return f.changeType==="ZOOM"&&this.interactionCounts.zoom++,f.changeType==="PAN"&&this.interactionCounts.pan++,f.changeType==="WINDOW_LEVEL"&&this.interactionCounts.windowLevel++,this.interactionCounts.viewsFocused.add(f.viewKey),this.exportPack.addEvent("VIEWPORT_CHANGED",f)}async logFirstImpressionLocked(f,n){var r;const c={caseId:(r=this.currentCaseId)!=null?r:"UNKNOWN_CASE",birads:f,confidence:n,timeToLockMs:Date.now()-this.caseStartTime,viewerInteractions:{zoomCount:this.interactionCounts.zoom,panCount:this.interactionCounts.pan,windowLevelCount:this.interactionCounts.windowLevel,viewsFocused:Array.from(this.interactionCounts.viewsFocused)}};return this.exportPack.addEvent("FIRST_IMPRESSION_LOCKED",c)}async logReadEpisodeStarted(f,n){const g={caseId:f,episodeType:n,tStartIso:new Date().toISOString()};return this.exportPack.addEvent("READ_EPISODE_STARTED",g)}async logReadEpisodeEnded(f,n,g){const c={caseId:f,episodeType:n,tEndIso:new Date().toISOString(),reason:g};return this.exportPack.addEvent("READ_EPISODE_ENDED",c)}async logAIRevealed(f){var n,g;return this.aiRevealTime=Date.now(),this.exportPack.addEvent("AI_REVEALED",{...f,caseId:(g=(n=this.currentCaseId)!=null?n:f.caseId)!=null?g:"UNKNOWN_CASE"})}async logDisclosurePresented(f){var n,g;return this.exportPack.addEvent("DISCLOSURE_PRESENTED",{...f,caseId:(g=(n=this.currentCaseId)!=null?n:f.caseId)!=null?g:"UNKNOWN_CASE"})}async logComprehensionResponse(f){return this.exportPack.addEvent("DISCLOSURE_COMPREHENSION_RESPONSE",f)}async logDeviationStarted(f){return this.exportPack.addEvent("DEVIATION_STARTED",{previousBirads:f})}async logDeviationSubmitted(f){var n;return this.exportPack.addEvent("DEVIATION_SUBMITTED",{...f,rationaleWordCount:((n=f.rationale)==null?void 0:n.split(/\s+/).length)||0})}async logDeviationSkipped(f){return this.exportPack.addEvent("DEVIATION_SKIPPED",{...f,skipped:!0})}async logFinalAssessment(f,n,g,c,r){const o=n!==c;let i="NO_CHANGE";if(o){const b=Math.abs(c-r);i=Math.abs(n-r)<b?"TOWARD_AI":"AWAY_FROM_AI"}const u={caseId:f,birads:n,confidence:g,changeFromInitial:o,changeDirection:i,postAiTimeMs:this.aiRevealTime>0?Date.now()-this.aiRevealTime:0};return this.exportPack.addEvent("FINAL_ASSESSMENT",u)}async logCaseCompleted(f,n){const g=await this.exportPack.addEvent("CASE_COMPLETED",{caseId:f,totalTimeMs:Date.now()-this.caseStartTime,...n});return this.currentCaseId===f&&(this.currentCaseId=null),g}async logAttentionCheck(f){return this.exportPack.addEvent("ATTENTION_CHECK_RESPONSE",f)}async logCalibrationStarted(f){return this.exportPack.addEvent("CALIBRATION_STARTED",{caseId:f})}async logCalibrationResponse(f,n){return this.exportPack.addEvent("CALIBRATION_RESPONSE",{caseId:f,...n})}async logCalibrationFeedback(f,n){return this.exportPack.addEvent("CALIBRATION_FEEDBACK_SHOWN",{caseId:f,...n})}async logSessionEnded(f){return this.exportPack.addEvent("SESSION_ENDED",f)}async logExportGenerated(f){return this.exportPack.addEvent("EXPORT_GENERATED",f)}async logGazeEnteredROI(f,n,g){return this.currentROI=f,this.roiEnterTime=Date.now(),this.exportPack.addEvent("GAZE_ENTERED_ROI",{roiId:f,roiType:n,caseId:g,timestamp:new Date().toISOString()})}async logGazeExitedROI(f,n){if(this.currentROI!==f||this.roiEnterTime===0)return null;const g=Date.now()-this.roiEnterTime,c=this.roiDwellTimes.get(f)||0;return this.roiDwellTimes.set(f,c+g),this.currentROI=null,this.roiEnterTime=0,g>100?this.exportPack.addEvent("DWELL_TIME_ROI",{roiId:f,dwellMs:g,caseId:n}):null}async logAttentionCoverageProxy(f){const n={};let g=0;for(const[c,r]of this.roiDwellTimes)n[c]=r,g+=r;return this.exportPack.addEvent("ATTENTION_COVERAGE_PROXY",{caseId:f,totalROIDwellMs:g,roiDwellBreakdown:n,viewsExamined:Array.from(this.interactionCounts.viewsFocused),interactionCounts:{zooms:this.interactionCounts.zoom,pans:this.interactionCounts.pan,windowLevelChanges:this.interactionCounts.windowLevel}})}getROIDwellTimes(){return new Map(this.roiDwellTimes)}getInteractionCounts(){return{zoom:this.interactionCounts.zoom,pan:this.interactionCounts.pan,windowLevel:this.interactionCounts.windowLevel}}getExportPack(){return this.exportPack}}const Wi={studyId:"BRPLL_RADAI_001",protocolVersion:"1.0.0",conditions:["HUMAN_FIRST","AI_FIRST","CONCURRENT"],disclosureFormats:["FDR_FOR","NATURAL_FREQUENCY","NONE"],counterbalanceMethod:"LATIN_SQUARE"},Ei=[[0,1,2],[1,2,0],[2,0,1]];function on(){const t=new Uint8Array(16);return crypto.getRandomValues(t),Array.from(t).map(f=>f.toString(16).padStart(2,"0")).join("")}async function wi(t){const n=new TextEncoder().encode(t),g=await crypto.subtle.digest("SHA-256",n);return Array.from(new Uint8Array(g)).map(r=>r.toString(16).padStart(2,"0")).join("")}async function an(t,f,n=Wi){const g=await wi(t+f.toString()),c=parseInt(g.slice(0,8),16);let r,o;if(n.counterbalanceMethod==="LATIN_SQUARE"){const u=f%3,b=c%3;r=Ei[u][b],o=Ei[(u+1)%3][b]}else if(n.counterbalanceMethod==="RANDOM")r=c%n.conditions.length,o=(c>>8)%n.disclosureFormats.length;else{const u=n.conditions.length*n.disclosureFormats.length,b=f%u;r=Math.floor(b/n.disclosureFormats.length),o=b%n.disclosureFormats.length}const i=await wi(JSON.stringify(n));return{seed:t,condition:n.conditions[r],disclosureFormat:n.disclosureFormats[o],protocolVersion:n.protocolVersion,assignmentMethod:"SEEDED_RANDOM",conditionMatrixHash:i.slice(0,16)}}function ln(t,f="FDR_FOR"){return{seed:"MANUAL_OVERRIDE",condition:t,disclosureFormat:f,protocolVersion:Wi.protocolVersion,assignmentMethod:"MANUAL",conditionMatrixHash:"MANUAL"}}const It=[{caseId:"BRPLL-001",inbreastId:"20586908",difficulty:"MEDIUM",groundTruth:{birads:4,pathology:"MALIGNANT",lesionType:"MASS"},aiSuggestion:{birads:4,confidence:87,finding:"Suspicious mass in upper outer quadrant"},images:{RCC:"/images/inbreast/20586908_6c613a14b80a8591_MG_R_CC_ANON.png",LCC:"/images/inbreast/20586934_6c613a14b80a8591_MG_L_CC_ANON.png",RMLO:"/images/inbreast/20586960_6c613a14b80a8591_MG_R_ML_ANON.png",LMLO:"/images/inbreast/20586986_6c613a14b80a8591_MG_L_ML_ANON.png"},metadata:{patientAge:52,breastDensity:"B",indication:"SCREENING"}},{caseId:"BRPLL-002",inbreastId:"20587054",difficulty:"EASY",groundTruth:{birads:2,pathology:"BENIGN",lesionType:"NONE"},aiSuggestion:{birads:2,confidence:94,finding:"No suspicious findings"},images:{RCC:"/images/inbreast/20587054_b6a4f750c6df4f90_MG_R_CC_ANON.png",LCC:"/images/inbreast/20587054_b6a4f750c6df4f90_MG_R_CC_ANON.png",RMLO:"/images/inbreast/20587080_b6a4f750c6df4f90_MG_R_ML_ANON.png",LMLO:"/images/inbreast/20587080_b6a4f750c6df4f90_MG_R_ML_ANON.png"},metadata:{patientAge:45,breastDensity:"A",indication:"SCREENING"}},{caseId:"BRPLL-003",inbreastId:"20587148",difficulty:"HARD",groundTruth:{birads:5,pathology:"MALIGNANT",lesionType:"MASS"},aiSuggestion:{birads:3,confidence:62,finding:"Probably benign finding"},images:{RCC:"/images/inbreast/20587148_fd746d25eb40b3dc_MG_R_CC_ANON.png",LCC:"/images/inbreast/20587174_fd746d25eb40b3dc_MG_L_CC_ANON.png",RMLO:"/images/inbreast/20587200_fd746d25eb40b3dc_MG_R_ML_ANON.png",LMLO:"/images/inbreast/20587226_fd746d25eb40b3dc_MG_L_ML_ANON.png"},metadata:{patientAge:61,breastDensity:"C",indication:"DIAGNOSTIC"}},{caseId:"BRPLL-ATN-001",inbreastId:"20587294",difficulty:"EASY",groundTruth:{birads:5,pathology:"MALIGNANT",lesionType:"MASS"},aiSuggestion:{birads:5,confidence:99,finding:"Large obvious mass - attention check"},images:{RCC:"/images/inbreast/20587294_e634830794f5c1bd_MG_R_CC_ANON.png",LCC:"/images/inbreast/20587320_e634830794f5c1bd_MG_L_CC_ANON.png",RMLO:"/images/inbreast/20587346_e634830794f5c1bd_MG_R_ML_ANON.png",LMLO:"/images/inbreast/20587372_e634830794f5c1bd_MG_L_ML_ANON.png"},metadata:{patientAge:58,breastDensity:"B",indication:"DIAGNOSTIC"},isAttentionCheck:!0},{caseId:"BRPLL-CAL-001",inbreastId:"20587466",difficulty:"MEDIUM",groundTruth:{birads:4,pathology:"MALIGNANT",lesionType:"CALC"},aiSuggestion:{birads:4,confidence:78,finding:"Suspicious calcifications"},images:{RCC:"/images/inbreast/20587544_d571b5880ad2a016_MG_R_CC_ANON.png",LCC:"/images/inbreast/20587466_d571b5880ad2a016_MG_L_CC_ANON.png",RMLO:"/images/inbreast/20587492_d571b5880ad2a016_MG_R_ML_ANON.png",LMLO:"/images/inbreast/20587518_d571b5880ad2a016_MG_L_ML_ANON.png"},metadata:{patientAge:49,breastDensity:"B",indication:"SCREENING"},isCalibration:!0}];function dn(t,f){let n=[];if(t.includeCalibration){const r=It.filter(o=>o.isCalibration);n.push(...r)}let c=[...It.filter(r=>!r.isCalibration&&!r.isAttentionCheck)];if(t.randomizeOrder,c=c.slice(0,t.casesPerSession),t.includeAttentionChecks&&c.length>=2){const r=It.find(o=>o.isAttentionCheck);if(r){const o=Math.floor(c.length/2);c.splice(o,0,r)}}return n.push(...c),{queueId:`Q-${Date.now().toString(36)}`,cases:n,currentIndex:0,completedCases:[],startTime:new Date().toISOString(),config:t}}function it(t){return t.currentIndex>=t.cases.length?null:t.cases[t.currentIndex]}function _i(t){const f=it(t);return{...t,currentIndex:t.currentIndex+1,completedCases:f?[...t.completedCases,f.caseId]:t.completedCases}}function cn(t){return t.currentIndex>=t.cases.length}function pn(t){var n;const f=it(t);return{current:t.currentIndex+1,total:t.cases.length,percentComplete:Math.round(t.currentIndex/t.cases.length*100),isCalibrationPhase:(n=f==null?void 0:f.isCalibration)!=null?n:!1}}const At="evidify_ip_acknowledged",un=t=>{try{return sessionStorage.getItem(t)}catch{return null}},Ti=(t,f)=>{try{sessionStorage.setItem(t,f)}catch{}},hn=()=>e.jsxs("div",{style:{position:"fixed",bottom:0,left:0,right:0,backgroundColor:"#0f172a",borderTop:"1px solid #334155",padding:"12px 24px",paddingBottom:"calc(12px + env(safe-area-inset-bottom))",display:"flex",justifyContent:"center",alignItems:"center",gap:"8px",fontSize:"12px",color:"#94a3b8",zIndex:9998,fontFamily:"system-ui, sans-serif"},children:[e.jsx(zi,{size:14,style:{color:"#6366f1"}}),e.jsxs("span",{children:[e.jsx("strong",{style:{color:"#c7d2fe"},children:"Evidify™ Research Platform"})," — ",e.jsx("span",{style:{color:"#f59e0b"},children:"Confidential Preview Build"})," | ","© 2026 Josh Henderson"," | ","For evaluation only"," | ",e.jsx("a",{href:"mailto:evidify.ai@gmail.com",style:{color:"#60a5fa",textDecoration:"none"},children:"evidify.ai@gmail.com"})]})]}),fn=()=>{const[t,f]=J.useState(!1),n=J.useRef(null);J.useEffect(()=>{un(At)||f(!0)},[]),J.useEffect(()=>{var o;if(!t)return;(o=n.current)==null||o.focus();const r=i=>{i.key==="Escape"&&f(!1)};return window.addEventListener("keydown",r),()=>window.removeEventListener("keydown",r)},[t]);const g=()=>{Ti(At,"true"),f(!1)},c=()=>{Ti(At,"true"),f(!1)};return t?e.jsx("div",{role:"dialog","aria-modal":"true","aria-label":"Confidential preview notice",style:{position:"fixed",inset:0,backgroundColor:"rgba(0, 0, 0, 0.85)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1e4,fontFamily:"system-ui, sans-serif",padding:"24px"},onClick:r=>{r.target===r.currentTarget&&c()},children:e.jsxs("div",{style:{position:"relative",backgroundColor:"#1e293b",borderRadius:"16px",padding:"40px",maxWidth:"520px",width:"100%",border:"2px solid #6366f1",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.5)",textAlign:"center"},children:[e.jsx("button",{type:"button",onClick:c,"aria-label":"Close",style:{position:"absolute",top:"14px",right:"14px",background:"transparent",border:"1px solid #334155",borderRadius:"10px",width:"36px",height:"36px",color:"#cbd5e1",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Di,{size:16})}),e.jsx("div",{style:{width:"64px",height:"64px",backgroundColor:"#4f46e5",borderRadius:"50%",display:"flex",justifyContent:"center",alignItems:"center",margin:"0 auto 24px"},children:e.jsx(zi,{size:32,style:{color:"white"}})}),e.jsx("h1",{style:{margin:"0 0 8px",fontSize:"28px",fontWeight:700,color:"white"},children:"Evidify™ Research Platform"}),e.jsx("div",{style:{display:"inline-block",padding:"6px 16px",backgroundColor:"#dc2626",color:"white",borderRadius:"4px",fontSize:"12px",fontWeight:700,letterSpacing:"1.5px",marginBottom:"24px"},children:"CONFIDENTIAL PREVIEW BUILD"}),e.jsx("p",{style:{margin:"0 0 32px",fontSize:"15px",lineHeight:1.6,color:"#cbd5e1"},children:"This demo is provided for evaluation by Brown University Radiology Human Factors Lab only. All materials, code, and concepts remain the intellectual property of Josh Henderson."}),e.jsx("button",{type:"button",ref:n,onClick:g,style:{width:"100%",padding:"16px 32px",backgroundColor:"#4f46e5",color:"white",border:"none",borderRadius:"8px",fontSize:"16px",fontWeight:600,cursor:"pointer",transition:"background-color 0.2s"},onMouseOver:r=>r.currentTarget.style.backgroundColor="#4338ca",onMouseOut:r=>r.currentTarget.style.backgroundColor="#4f46e5",children:"I Understand — Continue to Demo"})]})}):null};function xn(t,f){if(f<=0)return{code:"HRI",name:"Hasty Review Index",value:100,level:"NORMAL",interpretation:"Within Normal Limits (insufficient data for comparison)",color:"#22c55e"};const n=t/f*100;let g,c,r;return n>=75?(g="NORMAL",c="Within Normal Limits",r="#22c55e"):n>=50?(g="MILD",c="Mildly Elevated",r="#f59e0b"):(g="ELEVATED",c="Elevated - Hasty Review",r="#ef4444"),{code:"HRI",name:"Hasty Review Index",value:Math.round(n),level:g,interpretation:c,color:r}}function gn(t,f){if(f===0)return{code:"CPI",name:"Conformity Pattern Index",value:0,level:"NORMAL",interpretation:"Within Normal Limits (no AI disagreements to evaluate)",color:"#22c55e"};const n=t/f*100;let g,c,r;return n<80?(g="NORMAL",c="Within Normal Limits",r="#22c55e"):n<=90?(g="MILD",c="Mildly Elevated",r="#f59e0b"):(g="ELEVATED",c="Elevated - High Conformity",r="#ef4444"),{code:"CPI",name:"Conformity Pattern Index",value:Math.round(n),level:g,interpretation:c,color:r}}function mn(t,f){if(f===0)return{code:"DAI",name:"Documentation Avoidance Index",value:0,level:"NORMAL",interpretation:"Within Normal Limits (no overrides requiring documentation)",color:"#22c55e"};const n=t===f;return{code:"DAI",name:"Documentation Avoidance Index",value:f-t,level:n?"NORMAL":"ELEVATED",interpretation:n?"Within Normal Limits":"Elevated - Override(s) Without Rationale",color:n?"#22c55e":"#ef4444"}}function yn(t,f,n,g){if(g===0)return{code:"ENG",name:"Engagement Index",value:0,level:"NORMAL",interpretation:"Pending (no cases completed)",color:"#64748b"};const r=(t+f)/g,o=n/g/1e3,i=Math.min(100,r/2*50),u=Math.min(100,o/30*50),b=i+u;let a,y,v;return b>=60?(a="NORMAL",y="Adequate Engagement",v="#22c55e"):b>=30?(a="MILD",y="Limited Engagement",v="#f59e0b"):(a="ELEVATED",y="Minimal Engagement",v="#ef4444"),{code:"ENG",name:"Engagement Index",value:Math.round(b),level:a,interpretation:y,color:v}}function bn(t,f,n,g){var E,D;const c=t.filter(j=>{var _;return!((_=j.caseId)!=null?_:"").includes("CALIB")}),r=c.map(j=>{var _,N;return(N=(_=j.preAiReadMs)!=null?_:j.timeToLockMs)!=null?N:0}).filter(j=>j>0).sort((j,_)=>j-_),o=r.length>0?r[Math.floor(r.length/2)]:3e4,i=f!=null?f:c.length>0&&(D=(E=c[c.length-1].preAiReadMs)!=null?E:c[c.length-1].timeToLockMs)!=null?D:0,u=xn(i,o),b=c.filter(j=>j.aiBirads!==null&&j.initialBirads!==j.aiBirads),a=b.filter(j=>j.finalBirads===j.aiBirads).length,y=gn(a,b.length),v=c.filter(j=>j.changeOccurred).length,p=c.filter(j=>j.changeOccurred&&j.deviationDocumented).length,m=mn(p,v),l=n!=null?n:{zooms:0,pans:0},x=g!=null?g:c.reduce((j,_)=>{var N;return j+((N=_.totalTimeMs)!=null?N:0)},0),h=yn(l.zooms,l.pans,x,c.length),C=[];return u.level==="ELEVATED"&&C.push("Elevated HRI (Hasty Review)"),y.level==="ELEVATED"&&C.push("Elevated CPI (High Conformity)"),m.level==="ELEVATED"&&C.push("Elevated DAI (Documentation Avoidance)"),h.level==="ELEVATED"&&C.push("Elevated ENG (Minimal Engagement)"),{HRI:u,CPI:y,DAI:m,ENG:h,overallValid:C.length===0,flags:C}}function vn(t,f){const n=f.filter(l=>{var x;return!((x=l.caseId)!=null?x:"").includes("CALIB")});if(n.length===0)return{engagementStatement:"No study cases completed.",responsePatternStatement:"Insufficient data for response pattern analysis.",aiInfluenceStatement:"AI influence cannot be assessed without completed cases.",cautionStatement:null,fullText:"No study cases completed. Insufficient data for interpretation."};const g=t.ENG.level==="NORMAL"?"adequate":t.ENG.level==="MILD"?"limited":"minimal",c=t.HRI.level!=="NORMAL",r=`Response patterns suggest ${g} task engagement${c?"":" with no evidence of hasty review"}.`,o="The reader's initial classification was recorded prior to AI exposure, supporting interpretability of pre/post influence analyses.",i=n.filter(l=>l.changeOccurred),u=i.filter(l=>l.finalBirads===l.aiBirads).length,b=i.filter(l=>l.finalBirads!==l.aiBirads&&l.aiBirads!==null).length;let a;i.length===0?a="no change":u>b?a="shift toward AI":b>u?a="shift away from AI":a="mixed pattern";let y;a==="no change"?y="independent judgment":a==="shift toward AI"?y=t.CPI.level==="ELEVATED"?"elevated reliance":"corrective updating":a==="shift away from AI"?y="independent override":y="varied response pattern";const v=`Following AI disclosure, the reader's final decision showed ${a}, consistent with ${y}.`;let p=null;t.flags.length>0&&(p=`Interpretation should be qualified by ${t.flags.map(x=>x.includes("HRI")?"elevated HRI":x.includes("CPI")?"high conformity pattern":x.includes("DAI")?"documentation avoidance":x.includes("ENG")?"limited engagement":x).join(", ")}.`);const m=[r,o,v,p].filter(Boolean).join(" ");return{engagementStatement:r,responsePatternStatement:o,aiInfluenceStatement:v,cautionStatement:p,fullText:m}}function yt(t){const{initialBirads:f,finalBirads:n,aiBirads:g,deviationDocumented:c,deviationRationale:r}=t,o=h=>h!==null&&(h===0||h>=3),i=h=>h!==null&&(h===1||h===2),u=o(f),b=i(f),a=o(g),y=i(g),v=o(n),p=i(n),m=f!==n,l=n===g,x=c&&r&&r.length>20;return u&&p&&y&&m?{level:"CRITICAL",color:"#dc2626",bgColor:"#7f1d1d",scenario:"Downgraded Finding After AI",description:"Changed from actionable to non-actionable after AI suggested benign",logic:`Initial: BI-RADS ${f} (actionable) → AI: BI-RADS ${g} (benign) → Final: BI-RADS ${n} (benign)`}:b&&p&&a&&!l&&!x?{level:"HIGH",color:"#f97316",bgColor:"#9a3412",scenario:"AI Override Without Documentation",description:"Maintained non-actionable assessment despite AI flagging finding, without adequate rationale",logic:`Initial: BI-RADS ${f} → AI: BI-RADS ${g} (flagged) → Final: BI-RADS ${n} (override without documentation)`}:b&&v&&a&&m?{level:"MODERATE",color:"#eab308",bgColor:"#854d0e",scenario:"Upgraded After AI Detection",description:"Changed to actionable after AI flagged finding - suggests AI dependency",logic:`Initial: BI-RADS ${f} (missed) → AI: BI-RADS ${g} (flagged) → Final: BI-RADS ${n} (corrected)`}:l?{level:"LOW",color:"#22c55e",bgColor:"#166534",scenario:"AI Concordance",description:"Final assessment agrees with AI recommendation",logic:`Initial: BI-RADS ${f} → AI: BI-RADS ${g} → Final: BI-RADS ${n} (concordant)`}:u&&v&&y?{level:"LOW",color:"#22c55e",bgColor:"#166534",scenario:"Conservative Override",description:"Maintained actionable finding despite AI suggesting benign - demonstrates clinical judgment",logic:`Initial: BI-RADS ${f} (actionable) → AI: BI-RADS ${g} (benign) → Final: BI-RADS ${n} (maintained)`}:m&&x?{level:"LOW",color:"#22c55e",bgColor:"#166534",scenario:"Documented Change",description:"Assessment changed with proper documentation",logic:`Initial: BI-RADS ${f} → AI: BI-RADS ${g} → Final: BI-RADS ${n} (documented rationale)`}:{level:"MODERATE",color:"#eab308",bgColor:"#854d0e",scenario:"Requires Review",description:"Case pattern requires individual review",logic:`Initial: BI-RADS ${f} → AI: BI-RADS ${g!=null?g:"N/A"} → Final: BI-RADS ${n}`}}function Sn(t,f,n,g){var E,D;const c=[],r=[],o=t.filter(j=>{var _;return!((_=j.caseId)!=null?_:"").includes("CALIB")});if(o.length===0)return{vulnerabilities:[],defenseStrengths:[],overallRisk:"LOW",recommendedFocus:"Complete session to generate analysis"};const i=o.filter(j=>{var N,H;return((H=(N=j.preAiReadMs)!=null?N:j.timeToLockMs)!=null?H:0)<f*.75});if(i.length>0){const j=Math.round(i.reduce((N,H)=>{var T,G;return N+((G=(T=H.preAiReadMs)!=null?T:H.timeToLockMs)!=null?G:0)},0)/i.length/1e3),_=Math.round((1-((D=(E=i[0].preAiReadMs)!=null?E:i[0].timeToLockMs)!=null?D:0)/f)*100);c.push({type:"ATTACK",severity:i.length>1?"HIGH":"MEDIUM",text:`Pre-AI review time (${j}s) was ${_}% below session median - may be characterized as rushed`,metric:`${i.length}/${o.length} cases below threshold`})}const u=o.filter(j=>j.changeOccurred&&j.finalBirads===j.aiBirads).length,b=o.filter(j=>j.changeOccurred).length;u>1&&c.push({type:"ATTACK",severity:u>=3?"HIGH":"MEDIUM",text:`Changed assessment after AI in ${u} of ${o.length} cases - pattern of AI deference`,metric:`${Math.round(u/o.length*100)}% AI-concordant changes`});const a=o.filter(j=>j.changeOccurred&&j.deviationRationale&&j.deviationRationale.length<30);if(a.length>0){const j=Math.round(a.reduce((_,N)=>{var H,T;return _+((T=(H=N.deviationRationale)==null?void 0:H.length)!=null?T:0)},0)/a.length);c.push({type:"ATTACK",severity:"MEDIUM",text:`Override rationale was brief (${j} words) - may be challenged as insufficient`,metric:`${a.length} brief rationales`})}const y=o.filter(j=>yt(j).level==="CRITICAL");y.length>0&&c.push({type:"ATTACK",severity:"HIGH",text:`${y.length} case(s) with critical risk pattern (downgraded actionable finding after AI)`,metric:y.map(j=>j.caseId).join(", ")}),r.push({type:"DEFENSE",severity:"HIGH",text:"Initial assessment was locked before AI reveal - proves independent first read",metric:"Protocol: HUMAN_FIRST"}),n&&g&&r.push({type:"DEFENSE",severity:"HIGH",text:"Hash chain intact - tamper-evident audit trail verified",metric:"Verification: PASS"});const v=o.reduce((j,_)=>{var N,H;return j+((H=(N=_.postAiReadMs)!=null?N:_.aiExposureMs)!=null?H:0)},0)/o.length;v>15e3&&r.push({type:"DEFENSE",severity:"MEDIUM",text:`Time spent reconsidering after AI (${Math.round(v/1e3)}s avg) shows due diligence`,metric:`Average: ${Math.round(v/1e3)}s post-AI`});const p=o.filter(j=>j.changeOccurred&&j.deviationDocumented&&j.deviationRationale&&j.deviationRationale.length>=30).length;p>0&&p===b&&r.push({type:"DEFENSE",severity:"MEDIUM",text:"All assessment changes were documented with rationale",metric:`${p}/${b} documented`});const m=o.filter(j=>yt(j).scenario==="Conservative Override").length;m>0&&r.push({type:"DEFENSE",severity:"MEDIUM",text:`Maintained actionable findings despite AI suggesting benign in ${m} case(s) - demonstrates clinical judgment`,metric:`${m} conservative override(s)`});const l=c.filter(j=>j.severity==="HIGH").length,x=r.filter(j=>j.severity==="HIGH").length;let h,C;return l>=2&&x<2?(h="HIGH",C="Focus on documenting clinical reasoning and review time adequacy"):l>=1||c.length>2?(h="MODERATE",C="Emphasize independent judgment and tamper-evident documentation"):(h="LOW",C="Strong defensible position - maintain documentation quality"),{vulnerabilities:c,defenseStrengths:r,overallRisk:h,recommendedFocus:C}}function Cn(t,f=4){if(!t||t.length===0)return[];const n=["SESSION_STARTED","FIRST_IMPRESSION_LOCKED","AI_REVEALED","FINAL_ASSESSMENT","CASE_COMPLETED"],g=t.filter(r=>n.includes(r.type)).slice(0,f),c=g.length>=f?g:[...g,...t.filter(r=>!n.includes(r.type))].slice(0,f);return c.map((r,o)=>({index:o,eventType:r.type,timestamp:r.timestamp,hash:r.eventHash||r.hash||"pending...",prevHash:o>0&&(c[o-1].eventHash||c[o-1].hash)||null}))}function In(t){const f=t.filter(u=>{var b;return!((b=u.caseId)!=null?b:"").includes("CALIB")});if(f.length===0)return{low:0,moderate:0,high:0,critical:0,worstCase:null};const n=f.map(yt),g=n.filter(u=>u.level==="LOW").length,c=n.filter(u=>u.level==="MODERATE").length,r=n.filter(u=>u.level==="HIGH").length,o=n.filter(u=>u.level==="CRITICAL").length,i=n.find(u=>u.level==="CRITICAL")||n.find(u=>u.level==="HIGH")||n.find(u=>u.level==="MODERATE")||n[0];return{low:g,moderate:c,high:r,critical:o,worstCase:i}}const _t=5e3,An=3e3,jn=t=>{const f=new Map;let n=null;return t.forEach(g=>{var c,r,o;g.type==="CASE_LOADED"&&((c=g.payload)!=null&&c.caseId)&&(n=g.payload.caseId,f.has(n)||f.set(n,[])),n&&((r=f.get(n))==null||r.push(g)),g.type==="CASE_COMPLETED"&&((o=g.payload)==null?void 0:o.caseId)===n&&(n=null)}),f},Rn=(t,f,n)=>{var b,a;if(n)return{preAiReadMs:0,postAiReadMs:0,totalReadMs:0};const g=y=>{console.warn(`[ReadEpisodes] ${y}`)},c=(y,v)=>{var m;const p=(m=y==null?void 0:y.payload)==null?void 0:m[v];return new Date(p!=null?p:y.timestamp).getTime()},r=y=>{const v=t.filter(h=>{var C;return h.type==="READ_EPISODE_STARTED"&&((C=h.payload)==null?void 0:C.episodeType)===y}),p=t.filter(h=>{var C;return h.type==="READ_EPISODE_ENDED"&&((C=h.payload)==null?void 0:C.episodeType)===y});if(v.length>1&&g(`Multiple ${y} starts detected for case ${f}.`),p.length>1&&g(`Multiple ${y} ends detected for case ${f}.`),v.length===0&&p.length>0){g(`Missing ${y} start for case ${f}.`);return}if(v.length>0&&p.length===0){g(`Missing ${y} end for case ${f}.`);return}if(v.length===0&&p.length===0)return;const m=c(v[0],"tStartIso"),x=c(p[0],"tEndIso")-m;if(!Number.isFinite(x)||x<0){g(`Invalid ${y} duration for case ${f}.`);return}return x},o=(b=r("PRE_AI"))!=null?b:0,i=(a=r("POST_AI"))!=null?a:0,u=o+i;return{preAiReadMs:o,postAiReadMs:i,totalReadMs:u}},En=(t,f,n,g)=>{var he,Se,ge,Ie,Ae,s,V,U,I,S,k,F,O,M,z,ee,$,X,oe,ce,ae,_e,xe,ze,me,Oe,Ne,Me,qe,Je,et;const r=(he=jn(t).get(f))!=null?he:[],o=r.find(ye=>ye.type==="FIRST_IMPRESSION_LOCKED"),i=r.find(ye=>ye.type==="AI_REVEALED"),u=r.find(ye=>ye.type==="FINAL_ASSESSMENT"),b=r.filter(ye=>ye.type==="DEVIATION_SUBMITTED"),a=r.filter(ye=>ye.type==="DEVIATION_STARTED"),y=r.filter(ye=>ye.type==="DEVIATION_SKIPPED"),v=r.find(ye=>ye.type==="CASE_COMPLETED"),p=r.find(ye=>ye.type==="DISCLOSURE_COMPREHENSION_RESPONSE"),m=r.find(ye=>ye.type==="DISCLOSURE_PRESENTED"),l=r.find(ye=>ye.type==="CASE_LOADED"),x=!!((Se=l==null?void 0:l.payload)!=null&&Se.isCalibration),h=(Ie=(ge=o==null?void 0:o.payload)==null?void 0:ge.birads)!=null?Ie:0,C=(s=(Ae=u==null?void 0:u.payload)==null?void 0:Ae.birads)!=null?s:h,E=(U=(V=i==null?void 0:i.payload)==null?void 0:V.suggestedBirads)!=null?U:null,D=(S=(I=i==null?void 0:i.payload)==null?void 0:I.aiConfidence)!=null?S:null,j=C!==h,_=j&&E!=null&&C===E,N=j&&E!=null&&C!==E,H=E!=null&&h!==E,T=H?C===E:null,G=a.length>0?a.length:j?1:0,ne=E!=null&&C!==E?1:0,A=b.some(ye=>{var Fe,Le;return((Le=(Fe=ye.payload)==null?void 0:Fe.rationale)!=null?Le:"").trim().length>0}),W=(ye,Fe)=>{if(!ye||!Fe)return null;const Le=new Date(ye.timestamp).getTime(),st=new Date(Fe.timestamp).getTime()-Le;return Number.isFinite(st)&&st>=0?st:null},d=(k=o==null?void 0:o.payload)==null?void 0:k.timeToLockMs,w=typeof d=="number"&&Number.isFinite(d)&&d>=0?d:W(l,o),{preAiReadMs:Q,postAiReadMs:Y,totalReadMs:le}=Rn(r,f,x),Z=(F=W(i,u!=null?u:v))!=null?F:0,ie=(O=W(l,v))!=null?O:W(l,u),L=typeof ie=="number"?Math.max(ie,1):0,B=(M=W(o,i))!=null?M:0,re=p&&m?new Date(p.timestamp).getTime()-new Date(m.timestamp).getTime():null,te=typeof re=="number"&&Number.isFinite(re)&&re>=0?re:null,q=(z=p==null?void 0:p.payload)!=null?z:{},de=($=(ee=q.itemId)!=null?ee:q.questionId)!=null?$:null,be=(oe=(X=q.selectedAnswer)!=null?X:q.response)!=null?oe:null,ue=(ae=(ce=q.isCorrect)!=null?ce:q.correct)!=null?ae:null;return{sessionId:n,timestamp:new Date().toISOString(),condition:(_e=g==null?void 0:g.condition)!=null?_e:"UNKNOWN",caseId:f,initialBirads:h,finalBirads:C,aiBirads:E,aiConfidence:D,changeOccurred:j,aiConsistentChange:_,aiInconsistentChange:N,addaDenominator:H,adda:T,deviationRequired:j,deviationDocumented:A,deviationSkipped:j&&!A&&y.length>0,deviationText:A?(ze=(xe=b[0])==null?void 0:xe.payload)==null?void 0:ze.rationale:void 0,deviationRationale:A?(Oe=(me=b[0])==null?void 0:me.payload)==null?void 0:Oe.rationale:void 0,comprehensionCorrect:ue,comprehensionAnswer:be,comprehensionItemId:de,comprehensionQuestionId:(Ne=q.questionId)!=null?Ne:null,comprehensionResponseMs:te,comprehension_answer:be,comprehension_correct:ue,comprehension_question_id:(Me=q.questionId)!=null?Me:null,comprehension_response_ms:te,preAiReadMs:Q,postAiReadMs:Y,totalReadMs:le,aiExposureMs:Z,decisionChangeCount:G,overrideCount:ne,rationaleProvided:A,timingFlagPreAiTooFast:typeof Q=="number"&&Q<_t,timingFlagAiExposureTooFast:typeof Z=="number"&&Z>0&&Z<An,totalTimeMs:L,timeToLockMs:w,lockToRevealMs:B,revealToFinalMs:(qe=W(i,u!=null?u:v))!=null?qe:0,revealTiming:(Je=g==null?void 0:g.condition)!=null?Je:"UNKNOWN",disclosureFormat:(et=g==null?void 0:g.disclosureFormat)!=null?et:"UNKNOWN"}},ki=(t,f,n,g,c,r)=>{var m,l,x,h,C,E,D,j,_,N,H,T;const o=t.find(G=>G.type==="FIRST_IMPRESSION_LOCKED"),i=[...t].reverse().find(G=>G.type==="FINAL_ASSESSMENT"),u=t.find(G=>G.type==="SESSION_STARTED"),b=[...t].reverse().find(G=>G.type==="SESSION_ENDED"),a=Array.from(new Set(t.filter(G=>G.type==="DISCLOSURE_COMPREHENSION_RESPONSE").map(G=>{var ne,A,W,d;return(d=(W=(ne=G.payload)==null?void 0:ne.itemId)!=null?W:(A=G.payload)==null?void 0:A.questionId)!=null?d:"DISCLOSURE_COMPREHENSION_DEFAULT"}).filter(Boolean))),y=g.length>0?Math.round(g.reduce((G,ne)=>{var A;return G+((A=ne.preAiReadMs)!=null?A:0)},0)/g.length):0,v=g.length>0?Math.round(g.reduce((G,ne)=>{var A;return G+((A=ne.aiExposureMs)!=null?A:0)},0)/g.length):0,p={...r!=null&&r.studyId?{studyId:r.studyId}:{},...r!=null&&r.protocolVersion?{protocolVersion:r.protocolVersion}:{},...r!=null&&r.siteId?{siteId:r.siteId}:{},revealTiming:(m=f==null?void 0:f.condition)!=null?m:"UNKNOWN",disclosureFormat:(l=f==null?void 0:f.disclosureFormat)!=null?l:"UNKNOWN",conditionAssignment:{condition:(x=f==null?void 0:f.condition)!=null?x:"UNKNOWN",disclosureFormat:(h=f==null?void 0:f.disclosureFormat)!=null?h:"UNKNOWN",seed:(C=f==null?void 0:f.seed)!=null?C:"N/A",assignmentMethod:(E=f==null?void 0:f.assignmentMethod)!=null?E:"UNKNOWN"},caseOrder:(D=n==null?void 0:n.cases.map(G=>G.caseId))!=null?D:[],timingSummary:{averagePreAiReadMs:y,averageAiExposureMs:v,sessionStartTime:(j=u==null?void 0:u.timestamp)!=null?j:null,sessionEndTime:(_=b==null?void 0:b.timestamp)!=null?_:null,totalDurationMs:u&&b?new Date(b.timestamp).getTime()-new Date(u.timestamp).getTime():null},errorRateDisclosure:{format:(N=f==null?void 0:f.disclosureFormat)!=null?N:"UNKNOWN",policy:c},comprehensionItems:{itemIds:a.length>0?a:["DISCLOSURE_COMPREHENSION_DEFAULT"]},lockPoints:{initialLockedTimestamp:(H=o==null?void 0:o.timestamp)!=null?H:null,finalLockedTimestamp:(T=i==null?void 0:i.timestamp)!=null?T:null}};return r!=null&&r.validityGates&&(p.validityGates=r.validityGates),p},wn=({condition:t,sessionId:f,caseQueue:n,currentCaseId:g,isCollapsed:c,onToggle:r,disclosurePolicy:o,onDisclosurePolicyChange:i,currentCaseDifficulty:u})=>{if(!t)return null;const b=(n==null?void 0:n.cases.map(y=>y.caseId))||[],a=b.findIndex(y=>y===g);return e.jsxs("div",{style:{position:"fixed",left:"20px",top:"20px",width:c?"auto":"320px",backgroundColor:"#0f172a",borderRadius:"12px",border:"2px solid #3b82f6",boxShadow:"0 20px 25px rgba(0,0,0,0.4)",zIndex:100,overflow:"hidden"},children:[e.jsxs("div",{onClick:r,style:{padding:"12px 16px",backgroundColor:"#1e40af",display:"flex",justifyContent:"space-between",alignItems:"center",cursor:"pointer"},children:[e.jsxs("div",{style:{color:"white",fontWeight:700,fontSize:"13px",display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(Ni,{size:14}),"STUDY CONTROL",e.jsx("span",{style:{backgroundColor:"#22c55e",color:"white",padding:"2px 8px",borderRadius:"10px",fontSize:"10px",fontWeight:600},children:"LIVE"})]}),e.jsx("span",{style:{color:"white",fontSize:"14px"},children:c?e.jsx(Mi,{size:14}):e.jsx(Bi,{size:14})})]}),!c&&e.jsxs("div",{style:{padding:"16px"},children:[e.jsxs("div",{style:{marginBottom:"16px",padding:"12px",backgroundColor:"#1e293b",borderRadius:"8px"},children:[e.jsx("div",{style:{fontSize:"10px",color:"#64748b",marginBottom:"4px",fontWeight:600},children:"PROTOCOL"}),e.jsx("div",{style:{color:"white",fontFamily:"monospace",fontSize:"13px"},children:"BRPLL-MAMMO-v1.0"})]}),e.jsxs("div",{style:{marginBottom:"12px"},children:[e.jsx("div",{style:{fontSize:"10px",color:"#64748b",marginBottom:"4px",fontWeight:600},children:"CONDITION"}),e.jsx("div",{style:{display:"inline-block",padding:"6px 12px",backgroundColor:t.condition==="HUMAN_FIRST"?"#166534":t.condition==="AI_FIRST"?"#7c2d12":"#4338ca",borderRadius:"6px",color:"white",fontWeight:700,fontSize:"14px"},children:t.condition==="HUMAN_FIRST"?"HUMAN_FIRST":t.condition==="AI_FIRST"?"AI_FIRST":"CONCURRENT"})]}),e.jsxs("div",{style:{marginBottom:"12px"},children:[e.jsx("div",{style:{fontSize:"10px",color:"#64748b",marginBottom:"4px",fontWeight:600},children:"RANDOMIZATION SEED"}),e.jsx("code",{style:{display:"block",padding:"8px 12px",backgroundColor:"#334155",borderRadius:"6px",color:"#fbbf24",fontFamily:"monospace",fontSize:"12px"},children:t.seed})]}),e.jsxs("div",{style:{marginBottom:"12px"},children:[e.jsx("div",{style:{fontSize:"10px",color:"#64748b",marginBottom:"4px",fontWeight:600},children:"ASSIGNMENT"}),e.jsxs("div",{style:{color:"#94a3b8",fontSize:"12px",display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx(Ze,{size:12}),t.assignmentMethod==="SEEDED_RANDOM"?"Seeded Random":"Manual Override"]})]}),e.jsxs("div",{style:{marginBottom:"12px"},children:[e.jsx("div",{style:{fontSize:"10px",color:"#64748b",marginBottom:"8px",fontWeight:600},children:"CASE QUEUE"}),e.jsx("div",{style:{display:"flex",gap:"6px",flexWrap:"wrap"},children:b.map((y,v)=>{var x;const p=(x=n==null?void 0:n.cases[v])==null?void 0:x.isCalibration,m=y===g,l=v<a;return e.jsxs("div",{title:`${y}${p?" (Calibration)":""}${l?" Complete":m?" Current":" Pending"}`,style:{padding:"4px 8px",borderRadius:"4px",fontSize:"10px",fontFamily:"monospace",fontWeight:m?700:400,backgroundColor:m?"#3b82f6":l?"#166534":"#334155",color:"white",border:p?"2px dashed #f59e0b":m?"2px solid #60a5fa":"1px solid #475569",cursor:"default",display:"flex",alignItems:"center",gap:"4px"},children:[l&&e.jsx(De,{size:10}),m&&e.jsx(tt,{size:10}),p?e.jsx(Et,{size:10}):null,y.length>12?y.slice(0,10)+"..":y]},y)})}),e.jsx("div",{style:{fontSize:"9px",color:"#64748b",marginTop:"6px",fontStyle:"italic"},children:"Sequential reading required for study validity"})]}),e.jsxs("div",{style:{marginBottom:"12px"},children:[e.jsx("div",{style:{fontSize:"10px",color:"#64748b",marginBottom:"6px",fontWeight:600},children:"COUNTERBALANCING"}),e.jsxs("div",{style:{padding:"10px",backgroundColor:"#1e3a5f",borderRadius:"8px",border:"1px solid #3b82f6"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"6px"},children:[e.jsx("span",{style:{fontSize:"10px",color:"#93c5fd"},children:"Scheme:"}),e.jsx("span",{style:{fontSize:"11px",color:"white",fontWeight:600},children:"Latin Square 4×4"})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"6px"},children:[e.jsx("span",{style:{fontSize:"10px",color:"#93c5fd"},children:"Arm:"}),e.jsx("span",{style:{fontSize:"11px",color:"#fbbf24",fontWeight:700,fontFamily:"monospace"},children:t.seed?`ARM-${parseInt(t.seed.slice(-4),16)%4+1}`:"ARM-1"})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{style:{fontSize:"10px",color:"#93c5fd"},children:"Case Order:"}),e.jsx("span",{style:{fontSize:"10px",color:"#94a3b8",fontFamily:"monospace"},children:t.seed?parseInt(t.seed.slice(-2),16)%2===0?"A→B→C→D":"D→C→B→A":"A→B→C→D"})]}),e.jsxs("div",{style:{marginTop:"8px",paddingTop:"8px",borderTop:"1px solid #334155",fontSize:"9px",color:"#64748b",display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx(De,{size:10,color:"#22c55e"}),e.jsx("span",{children:"Logged to RANDOMIZATION_ASSIGNED event"})]})]})]}),e.jsxs("div",{style:{marginBottom:"12px"},children:[e.jsx("div",{style:{fontSize:"10px",color:"#64748b",marginBottom:"4px",fontWeight:600},children:"DISCLOSURE FORMAT"}),e.jsxs("div",{style:{color:"#94a3b8",fontSize:"12px",display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx(Xe,{size:12}),"FDR/FOR (4% / 12%)"]})]}),e.jsxs("div",{style:{marginBottom:"12px"},children:[e.jsx("div",{style:{fontSize:"10px",color:"#64748b",marginBottom:"8px",fontWeight:600},children:"DISCLOSURE POLICY"}),e.jsxs("div",{style:{display:"flex",gap:"4px"},children:[e.jsx("button",{onClick:()=>i("STATIC"),style:{flex:1,padding:"6px 8px",backgroundColor:o==="STATIC"?"#3b82f6":"#334155",border:"none",borderRadius:"6px 0 0 6px",color:"white",fontSize:"10px",fontWeight:600,cursor:"pointer"},children:"STATIC"}),e.jsx("button",{onClick:()=>i("ADAPTIVE"),style:{flex:1,padding:"6px 8px",backgroundColor:o==="ADAPTIVE"?"#a855f7":"#334155",border:"none",borderRadius:"0 6px 6px 0",color:"white",fontSize:"10px",fontWeight:600,cursor:"pointer"},children:"ADAPTIVE"})]}),o==="ADAPTIVE"&&e.jsxs("div",{style:{marginTop:"8px",padding:"8px",backgroundColor:"#4c1d95",borderRadius:"6px",fontSize:"10px",color:"#c4b5fd"},children:[e.jsxs("div",{style:{fontWeight:600,marginBottom:"4px",display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx(Ke,{size:12}),"Adaptive Mode Active"]}),e.jsx("div",{children:"Disclosure intensity varies by case difficulty:"}),e.jsxs("div",{style:{marginTop:"4px",display:"flex",gap:"8px"},children:[e.jsx("span",{style:{color:"#86efac"},children:"EASY: minimal"}),e.jsx("span",{style:{color:"#fcd34d"},children:"MED: standard"}),e.jsx("span",{style:{color:"#fca5a5"},children:"HARD: full+debias"})]}),u&&e.jsxs("div",{style:{marginTop:"8px",padding:"4px 8px",backgroundColor:u==="EASY"?"#166534":u==="MEDIUM"?"#92400e":"#7f1d1d",borderRadius:"4px",fontWeight:700,textAlign:"center"},children:["Current: ",u]})]})]}),e.jsxs("div",{style:{marginTop:"16px",padding:"8px",backgroundColor:"#0f172a",borderRadius:"6px",borderTop:"1px solid #334155"},children:[e.jsx("div",{style:{fontSize:"9px",color:"#64748b",marginBottom:"2px"},children:"SESSION"}),e.jsx("code",{style:{color:"#64748b",fontSize:"10px",fontFamily:"monospace"},children:f})]})]})]})},jt=({roiDwellTimes:t,interactionCounts:f,totalTimeMs:n})=>{const g=t.get("mammogram")||0,c=t.get("ai_box")||0,r=t.get("fdr_for")||0,o=g+c+r,i=n>0?Math.min(100,o/n*100):0,u=o>0?g/o*100:0,b=o>0?c/o*100:0,a=o>0?r/o*100:0;return e.jsxs("div",{style:{backgroundColor:"#1e293b",borderRadius:"12px",padding:"16px",marginTop:"16px",border:"1px solid #334155"},children:[e.jsxs("div",{style:{fontSize:"11px",color:"#06b6d4",fontWeight:700,marginBottom:"12px",display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(ut,{size:14}),"ATTENTION INSTRUMENTATION",e.jsx("span",{style:{backgroundColor:"#164e63",color:"#22d3ee",padding:"2px 6px",borderRadius:"8px",fontSize:"9px"},children:"PROXY"})]}),e.jsxs("div",{style:{marginBottom:"16px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[e.jsx("span",{style:{fontSize:"10px",color:"#64748b"},children:"ROI Coverage"}),e.jsxs("span",{style:{fontSize:"12px",color:"white",fontWeight:600},children:[i.toFixed(0),"%"]})]}),e.jsx("div",{style:{height:"8px",backgroundColor:"#334155",borderRadius:"4px",overflow:"hidden"},children:e.jsx("div",{style:{height:"100%",width:`${i}%`,backgroundColor:"#06b6d4",borderRadius:"4px",transition:"width 0.3s ease"}})})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"8px",marginBottom:"12px"},children:[e.jsxs("div",{style:{textAlign:"center",padding:"8px",backgroundColor:"#0f172a",borderRadius:"8px"},children:[e.jsx("div",{style:{fontSize:"9px",color:"#64748b",marginBottom:"4px"},children:"Image"}),e.jsxs("div",{style:{fontSize:"14px",color:"#22d3ee",fontWeight:700},children:[(g/1e3).toFixed(1),"s"]}),e.jsxs("div",{style:{fontSize:"9px",color:"#475569"},children:[u.toFixed(0),"%"]})]}),e.jsxs("div",{style:{textAlign:"center",padding:"8px",backgroundColor:"#0f172a",borderRadius:"8px"},children:[e.jsx("div",{style:{fontSize:"9px",color:"#64748b",marginBottom:"4px"},children:"AI Box"}),e.jsxs("div",{style:{fontSize:"14px",color:"#a855f7",fontWeight:700},children:[(c/1e3).toFixed(1),"s"]}),e.jsxs("div",{style:{fontSize:"9px",color:"#475569"},children:[b.toFixed(0),"%"]})]}),e.jsxs("div",{style:{textAlign:"center",padding:"8px",backgroundColor:"#0f172a",borderRadius:"8px"},children:[e.jsx("div",{style:{fontSize:"9px",color:"#64748b",marginBottom:"4px"},children:"FDR/FOR"}),e.jsxs("div",{style:{fontSize:"14px",color:"#f59e0b",fontWeight:700},children:[(r/1e3).toFixed(1),"s"]}),e.jsxs("div",{style:{fontSize:"9px",color:"#475569"},children:[a.toFixed(0),"%"]})]})]}),e.jsxs("div",{style:{display:"flex",gap:"16px",paddingTop:"12px",borderTop:"1px solid #334155"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx(bt,{size:14,color:"#60a5fa"}),e.jsx("span",{style:{color:"white",fontWeight:600},children:f.zooms}),e.jsx("span",{style:{fontSize:"10px",color:"#64748b"},children:"zooms"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx(Oi,{size:14,color:"#f59e0b"}),e.jsx("span",{style:{color:"white",fontWeight:600},children:f.pans}),e.jsx("span",{style:{fontSize:"10px",color:"#64748b"},children:"pans"})]})]})]})},_n=({isVisible:t,onClose:f,sessionId:n,caseResults:g,events:c,ledger:r,condition:o,exportManifest:i,exportManifestEntries:u,verifierOutput:b,verifierResult:a,tamperDetected:y,viewMode:v})=>{var T,G,ne,A,W,d;const[p,m]=J.useState("summary");if(!t)return null;const l=c.filter(w=>["SESSION_STARTED","FIRST_IMPRESSION_LOCKED","AI_REVEALED","DISCLOSURE_PRESENTED","FINAL_ASSESSMENT","DEVIATION_SUBMITTED","CASE_COMPLETED"].includes(w.type)),x=g[g.length-1],h=g.filter(w=>w.deviationRequired).length,C=g.filter(w=>w.deviationDocumented).length,E=c.some(w=>w.type==="AI_REVEALED"),D=(G=(T=x==null?void 0:x.disclosureFormat)!=null?T:o==null?void 0:o.disclosureFormat)!=null?G:"UNKNOWN",j=u!=null?u:[],_={fastPreAI:g.filter(w=>(w.timeToLockMs||0)<5e3).length,totalCases:g.length,aiAgreementRate:g.length>0?Math.round(g.filter(w=>w.adda).length/g.length*100):0,deviationsDocumented:g.filter(w=>w.deviationRationale&&w.deviationRationale.length>0).length,deviationsRequired:g.filter(w=>w.changeOccurred).length,comprehensionPassed:g.filter(w=>w.comprehensionCorrect===!0).length,comprehensionFailed:g.filter(w=>w.comprehensionCorrect===!1).length,avgPreAITime:g.length>0?Math.round(g.reduce((w,Q)=>w+(Q.timeToLockMs||0),0)/g.length/1e3):0},N={independentJudgment:_.fastPreAI===0&&_.aiAgreementRate<100,properDocumentation:_.deviationsRequired===0||_.deviationsDocumented>=_.deviationsRequired,errorRateAwareness:_.comprehensionPassed>0,chainIntegrity:a==="PASS"&&!y},H=Object.values(N).filter(Boolean).length;return e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.95)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2e3,padding:"20px"},children:e.jsxs("div",{style:{backgroundColor:"#0f172a",borderRadius:"16px",width:"100%",maxWidth:"1000px",maxHeight:"90vh",overflow:"hidden",border:y?"3px solid #dc2626":"3px solid #22c55e",boxShadow:y?"0 0 60px rgba(220, 38, 38, 0.4)":"0 0 60px rgba(34, 197, 94, 0.3)"},children:[e.jsxs("div",{style:{padding:"20px 24px",backgroundColor:y?"#7f1d1d":"#14532d",borderBottom:"1px solid #333",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"4px"},children:[e.jsxs("h2",{style:{color:"white",margin:0,fontSize:"20px",display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(Li,{size:18}),"Expert Witness Packet"]}),e.jsx("div",{style:{padding:"4px 12px",borderRadius:"20px",fontSize:"12px",fontWeight:700,backgroundColor:y?"#dc2626":"#22c55e",color:y?"white":"#052e16"},children:y?"INTEGRITY COMPROMISED":"VERIFIED AUTHENTIC"})]}),e.jsxs("div",{style:{color:"#94a3b8",fontSize:"12px",fontFamily:"monospace"},children:["Session: ",n," • Generated: ",new Date().toISOString()]})]}),e.jsx("button",{onClick:f,style:{background:"none",border:"none",color:"white",fontSize:"28px",cursor:"pointer",padding:"0 8px"},children:"×"})]}),e.jsx("div",{style:{display:"flex",backgroundColor:"#1e293b",borderBottom:"1px solid #333"},children:[{id:"summary",label:"Summary",icon:e.jsx(at,{size:14}),modes:["CLINICIAN","RESEARCHER"]},{id:"audit",label:"Audit",icon:e.jsx(vt,{size:14}),modes:["CLINICIAN","RESEARCHER"]},{id:"timeline",label:"Decision Timeline",icon:e.jsx(Ue,{size:14}),modes:["RESEARCHER"]},{id:"legal",label:"Legal Summary",icon:e.jsx(nt,{size:14}),modes:["RESEARCHER"]},{id:"validity",label:"Validity Indicators",icon:e.jsx(bt,{size:14}),modes:["RESEARCHER"]}].filter(w=>w.modes.includes(v)).map(w=>e.jsxs("button",{onClick:()=>m(w.id),style:{flex:1,padding:"12px 16px",backgroundColor:p===w.id?"#334155":"transparent",border:"none",borderBottom:p===w.id?"2px solid #3b82f6":"2px solid transparent",color:p===w.id?"white":"#64748b",cursor:"pointer",fontSize:"13px",fontWeight:600,transition:"all 0.2s",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},children:[w.icon,w.label]},w.id))}),e.jsxs("div",{style:{padding:"24px",maxHeight:"calc(90vh - 180px)",overflow:"auto",backgroundColor:"#0f172a"},children:[p==="summary"&&e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1.1fr 0.9fr",gap:"20px"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[e.jsxs("div",{style:{backgroundColor:"#1e293b",padding:"16px",borderRadius:"10px",border:"1px solid #334155"},children:[e.jsx("div",{style:{fontSize:"12px",color:"#94a3b8",marginBottom:"6px"},children:"SESSION"}),e.jsx("div",{style:{fontSize:"13px",color:"white",fontFamily:"monospace"},children:n}),e.jsxs("div",{style:{fontSize:"12px",color:"#94a3b8",marginTop:"6px"},children:["Condition: ",(ne=o==null?void 0:o.condition)!=null?ne:"UNKNOWN"]}),e.jsxs("div",{style:{fontSize:"12px",color:"#94a3b8"},children:["Case ID: ",(A=x==null?void 0:x.caseId)!=null?A:"N/A"]})]}),e.jsxs("div",{style:{backgroundColor:"#1e293b",padding:"16px",borderRadius:"10px",border:"1px solid #334155"},children:[e.jsx("div",{style:{fontSize:"12px",color:"#94a3b8",marginBottom:"6px"},children:"DECISION SUMMARY"}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"13px",color:"white"},children:[e.jsx("span",{children:"Initial"}),e.jsxs("span",{children:["BI-RADS ",(W=x==null?void 0:x.initialBirads)!=null?W:"--"]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"13px",color:"white",marginTop:"6px"},children:[e.jsx("span",{children:"Final"}),e.jsxs("span",{children:["BI-RADS ",(d=x==null?void 0:x.finalBirads)!=null?d:"--"]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"12px",color:"#94a3b8",marginTop:"10px"},children:[e.jsx("span",{children:"AI shown"}),e.jsx("span",{children:E?"Yes":"No"})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"12px",color:"#94a3b8",marginTop:"4px"},children:[e.jsx("span",{children:"Disclosure format"}),e.jsx("span",{children:D})]})]})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[e.jsxs("div",{style:{backgroundColor:"#1e293b",padding:"16px",borderRadius:"10px",border:"1px solid #334155"},children:[e.jsx("div",{style:{fontSize:"12px",color:"#94a3b8",marginBottom:"8px"},children:"DEVIATION FLAGS"}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"12px",color:"white"},children:[e.jsx("span",{children:"Deviation required"}),e.jsx("span",{children:h>0?`Yes (${h})`:"No"})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"12px",color:"white",marginTop:"6px"},children:[e.jsx("span",{children:"Deviation supplied"}),e.jsx("span",{children:C>0?`Yes (${C})`:"No"})]})]}),e.jsxs("div",{style:{backgroundColor:"#1e293b",padding:"16px",borderRadius:"10px",border:"1px solid #334155"},children:[e.jsx("div",{style:{fontSize:"12px",color:"#94a3b8",marginBottom:"8px"},children:"INTEGRITY CHECK"}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"6px",fontSize:"12px"},children:[e.jsxs("span",{style:{color:i?"#4ade80":"#fbbf24"},children:["Manifest ",i?"present":"missing"]}),e.jsxs("span",{style:{color:r.length>0?"#4ade80":"#fbbf24"},children:["Ledger ",r.length>0?"present":"missing"]}),e.jsxs("span",{style:{color:c.length>0?"#4ade80":"#fbbf24"},children:["Events ",c.length>0?"present":"missing"]})]})]})]})]}),p==="audit"&&e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[e.jsxs("div",{style:{backgroundColor:"#1e293b",padding:"16px",borderRadius:"10px",border:"1px solid #334155"},children:[e.jsx("div",{style:{fontSize:"12px",color:"#94a3b8",marginBottom:"8px"},children:"EXPORT FILE LIST"}),j.length>0?e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1.4fr 0.8fr 0.8fr",gap:"8px",fontSize:"11px",color:"#94a3b8"},children:[e.jsx("div",{style:{fontWeight:600,color:"white"},children:"File"}),e.jsx("div",{style:{fontWeight:600,color:"white"},children:"Bytes"}),e.jsx("div",{style:{fontWeight:600,color:"white"},children:"SHA-256"}),j.map(w=>e.jsxs(mt.Fragment,{children:[e.jsx("div",{children:w.path}),e.jsx("div",{children:w.bytes}),e.jsxs("div",{style:{fontFamily:"monospace"},children:[w.sha256.slice(0,12),"…"]})]},w.path))]}):e.jsx("div",{style:{fontSize:"12px",color:"#64748b"},children:"Manifest entries unavailable until export is generated."})]}),e.jsxs("div",{style:{backgroundColor:"#1e293b",padding:"16px",borderRadius:"10px",border:"1px solid #334155"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"8px"},children:[e.jsx("div",{style:{fontSize:"12px",color:"#94a3b8"},children:"LEDGER (FIRST 8 ENTRIES)"}),e.jsxs("div",{style:{fontSize:"12px",color:"#94a3b8"},children:["Events: ",c.length]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"0.3fr 1fr 1fr",gap:"8px",fontSize:"11px",color:"#94a3b8"},children:[e.jsx("div",{style:{fontWeight:600,color:"white"},children:"#"}),e.jsx("div",{style:{fontWeight:600,color:"white"},children:"Event"}),e.jsx("div",{style:{fontWeight:600,color:"white"},children:"Chain Hash"}),r.slice(0,8).map(w=>{var Q;return e.jsxs(mt.Fragment,{children:[e.jsx("div",{children:w.seq}),e.jsx("div",{children:w.eventType}),e.jsxs("div",{style:{fontFamily:"monospace"},children:[(Q=w.chainHash)==null?void 0:Q.slice(0,14),"…"]})]},w.eventId)})]})]}),b&&e.jsxs("div",{style:{backgroundColor:"#0a0a0a",padding:"16px",borderRadius:"10px",border:"1px solid #333"},children:[e.jsx("div",{style:{fontSize:"12px",color:"#94a3b8",marginBottom:"8px"},children:"verifier_output.json"}),e.jsx("pre",{style:{margin:0,color:"#4ade80",fontSize:"11px",fontFamily:"monospace",maxHeight:"200px",overflow:"auto"},children:JSON.stringify(b,null,2)})]})]}),p==="timeline"&&e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1.2fr 0.8fr",gap:"20px"},children:[e.jsxs("div",{children:[e.jsxs("div",{style:{marginBottom:"16px",padding:"14px",backgroundColor:"#1e293b",borderRadius:"8px",borderLeft:"4px solid #3b82f6"},children:[e.jsx("div",{style:{color:"#94a3b8",fontSize:"12px",marginBottom:"4px"},children:"EVENT STREAM (HUMAN-READABLE)"}),e.jsx("div",{style:{color:"white",fontSize:"14px"},children:"Read the story of the session in order: initial read, AI exposure, and final decision."})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:l.slice(0,20).map(w=>e.jsxs("div",{style:{padding:"12px",borderRadius:"8px",backgroundColor:"#1e293b",border:"1px solid #334155"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",gap:"12px"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{color:"white",fontWeight:600,fontSize:"13px"},children:w.type.replace(/_/g," ")}),e.jsx("div",{style:{color:"#94a3b8",fontSize:"11px",marginTop:"4px"},children:new Date(w.timestamp).toLocaleString()})]}),e.jsxs("span",{style:{fontSize:"10px",color:"#64748b",fontFamily:"monospace"},children:["#",w.seq]})]}),w.payload&&e.jsxs("div",{style:{marginTop:"8px",fontSize:"11px",color:"#94a3b8"},children:[w.type==="FIRST_IMPRESSION_LOCKED"&&e.jsxs(e.Fragment,{children:["Initial BI-RADS ",w.payload.birads," • Confidence ",w.payload.confidence,"%"]}),w.type==="AI_REVEALED"&&e.jsxs(e.Fragment,{children:["AI BI-RADS ",w.payload.suggestedBirads," • Confidence ",Math.round((w.payload.aiConfidence||.87)*100),"%"]}),w.type==="FINAL_ASSESSMENT"&&e.jsxs(e.Fragment,{children:["Final BI-RADS ",w.payload.birads," • Change ",w.payload.changeFromInitial?"Yes":"No"]}),w.type==="DEVIATION_SUBMITTED"&&e.jsxs(e.Fragment,{children:["Rationale: ",(w.payload.rationale||"").slice(0,80)]})]})]},w.id))})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[e.jsxs("div",{style:{backgroundColor:"#1e293b",padding:"14px",borderRadius:"8px",border:"1px solid #334155"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"8px"},children:[y?e.jsx(je,{size:16,color:"#f87171"}):e.jsx(De,{size:16,color:"#4ade80"}),e.jsx("div",{style:{color:"white",fontWeight:600},children:"Verification Status"})]}),e.jsx("div",{style:{fontSize:"12px",color:"#94a3b8"},children:y?"Hash chain failed validation.":"Hash chain intact and verified."})]}),e.jsxs("div",{style:{backgroundColor:"#1e293b",padding:"14px",borderRadius:"8px",border:"1px solid #334155"},children:[e.jsx("div",{style:{fontSize:"12px",color:"#94a3b8",marginBottom:"8px",fontWeight:600},children:"HASH CHAIN"}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:l.slice(0,10).map(w=>{const Q=r.find(Y=>Y.eventId===w.id)||{};return e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"8px"},children:[e.jsx("span",{style:{fontSize:"10px",color:"#94a3b8"},children:w.type.replace(/_/g," ")}),e.jsxs("span",{style:{fontSize:"10px",color:"#4ade80",fontFamily:"monospace"},children:[(Q.chainHash||"").slice(0,12),"..."]})]},w.id)})})]}),e.jsxs("div",{style:{backgroundColor:"#1e293b",padding:"14px",borderRadius:"8px",border:"1px solid #334155"},children:[e.jsx("div",{style:{fontSize:"12px",color:"#94a3b8",marginBottom:"8px",fontWeight:600},children:"WHAT CHANGED"}),(()=>{var Y,le,Z,ie,L,B,re,te;const w=c.find(q=>q.type==="FIRST_IMPRESSION_LOCKED"),Q=c.find(q=>q.type==="FINAL_ASSESSMENT");return!w||!Q?e.jsx("div",{style:{fontSize:"11px",color:"#64748b"},children:"Insufficient data to compute diffs."}):e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"8px",fontSize:"11px",color:"#94a3b8"},children:[e.jsx("div",{style:{fontWeight:600,color:"white"},children:"Field"}),e.jsx("div",{style:{fontWeight:600,color:"white"},children:"Initial"}),e.jsx("div",{style:{fontWeight:600,color:"white"},children:"Final"}),e.jsx("div",{children:"BI-RADS"}),e.jsx("div",{children:(le=(Y=w.payload)==null?void 0:Y.birads)!=null?le:"--"}),e.jsx("div",{children:(ie=(Z=Q.payload)==null?void 0:Z.birads)!=null?ie:"--"}),e.jsx("div",{children:"Confidence"}),e.jsxs("div",{children:[(B=(L=w.payload)==null?void 0:L.confidence)!=null?B:"--","%"]}),e.jsxs("div",{children:[(te=(re=Q.payload)==null?void 0:re.confidence)!=null?te:"--","%"]})]})})()]})]})]}),p==="legal"&&e.jsxs("div",{children:[e.jsxs("div",{style:{padding:"24px",backgroundColor:H>=3?"#14532d":H>=2?"#713f12":"#7f1d1d",borderRadius:"12px",marginBottom:"24px",textAlign:"center"},children:[e.jsx("div",{style:{display:"flex",justifyContent:"center",marginBottom:"8px"},children:H>=3?e.jsx(De,{size:40,color:"#4ade80"}):H>=2?e.jsx(je,{size:40,color:"#f59e0b"}):e.jsx(Tt,{size:40,color:"#f87171"})}),e.jsx("div",{style:{color:"white",fontSize:"24px",fontWeight:700,marginBottom:"8px"},children:H>=3?"DEFENSIBLE RECORD":H>=2?"PARTIALLY DEFENSIBLE":"HIGH RISK"}),e.jsxs("div",{style:{color:"#94a3b8",fontSize:"14px"},children:[H,"/4 legal defense criteria met"]})]}),e.jsxs("div",{style:{marginBottom:"24px"},children:[e.jsxs("h3",{style:{color:"white",fontSize:"16px",marginBottom:"16px",display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(nt,{size:16}),"Key Legal Questions Answered"]}),[{question:"Did the clinician exercise independent judgment?",answer:N.independentJudgment,detail:N.independentJudgment?`Yes. Pre-AI assessment time averaged ${_.avgPreAITime}s. AI agreement rate: ${_.aiAgreementRate}%.`:"Concern: Fast pre-AI times or 100% AI agreement suggest possible rubber-stamping."},{question:"Were disagreements with AI properly documented?",answer:N.properDocumentation,detail:N.properDocumentation?`Yes. ${_.deviationsDocumented}/${_.deviationsRequired} deviations documented with rationale.`:`No. ${_.deviationsRequired-_.deviationsDocumented} deviations lack documentation.`},{question:"Did the clinician understand AI error rates?",answer:N.errorRateAwareness,detail:N.errorRateAwareness?`Yes. Comprehension check passed for ${_.comprehensionPassed} case(s).`:"No. Comprehension check failed or not completed."},{question:"Is the decision record tamper-evident and intact?",answer:N.chainIntegrity,detail:N.chainIntegrity?`Yes. Hash chain verified. ${c.length} events cryptographically linked.`:"NO - INTEGRITY COMPROMISED. Evidence chain broken."}].map((w,Q)=>e.jsxs("div",{style:{padding:"16px",backgroundColor:"#1e293b",borderRadius:"8px",marginBottom:"12px",borderLeft:`4px solid ${w.answer?"#22c55e":"#ef4444"}`},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},children:[e.jsx("div",{style:{color:"white",fontWeight:600,fontSize:"14px"},children:w.question}),e.jsx("div",{style:{padding:"4px 12px",borderRadius:"12px",fontSize:"12px",fontWeight:600,backgroundColor:w.answer?"#166534":"#991b1b",color:w.answer?"#4ade80":"#fca5a5"},children:w.answer?"YES":"NO"})]}),e.jsx("div",{style:{color:"#94a3b8",fontSize:"12px"},children:w.detail})]},Q))]}),e.jsxs("div",{style:{padding:"16px",backgroundColor:"#1e3a5f",borderRadius:"8px",border:"1px solid #3b82f6"},children:[e.jsxs("div",{style:{color:"#93c5fd",fontSize:"12px",fontWeight:600,marginBottom:"8px",display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx(pt,{size:12}),"CROSS-EXAMINATION DEFENSE POINTS"]}),e.jsxs("ul",{style:{color:"#94a3b8",fontSize:"12px",margin:0,paddingLeft:"20px"},children:[e.jsx("li",{style:{marginBottom:"4px"},children:"Initial assessment was locked BEFORE AI disclosure"}),e.jsx("li",{style:{marginBottom:"4px"},children:"FDR/FOR error rates were presented and acknowledged"}),e.jsx("li",{style:{marginBottom:"4px"},children:"Decision chain is cryptographically verifiable"}),e.jsx("li",{style:{marginBottom:"4px"},children:"All timestamps are tamper-evident"}),e.jsx("li",{children:"Third-party verification can independently confirm record integrity"})]})]})]}),p==="validity"&&e.jsxs("div",{children:[e.jsxs("div",{style:{marginBottom:"20px",padding:"16px",backgroundColor:"#1e293b",borderRadius:"8px",borderLeft:"4px solid #a855f7"},children:[e.jsx("div",{style:{color:"#94a3b8",fontSize:"12px",marginBottom:"4px"},children:"VALIDITY INDICATORS (Analogous to response consistency scales)"}),e.jsx("div",{style:{color:"white",fontSize:"14px"},children:"Behavioral patterns that may indicate rushed reading, automation bias, or negligent dismissal."})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px"},children:[{label:"Fast Pre-AI Reads",value:_.fastPreAI,total:_.totalCases,unit:"cases < 5s",status:_.fastPreAI===0?"good":_.fastPreAI<=1?"warn":"bad",detail:"Readings under 5 seconds suggest insufficient independent review"},{label:"AI Agreement Rate",value:_.aiAgreementRate,unit:"%",status:_.aiAgreementRate<80?"good":_.aiAgreementRate<100?"warn":"bad",detail:"100% agreement may indicate rubber-stamping"},{label:"Deviation Documentation",value:_.deviationsDocumented,total:_.deviationsRequired,unit:"documented",status:_.deviationsRequired===0||_.deviationsDocumented>=_.deviationsRequired?"good":"bad",detail:"Deviations from AI should include clinical rationale"},{label:"Comprehension Checks",value:_.comprehensionPassed,total:_.comprehensionPassed+_.comprehensionFailed,unit:"passed",status:_.comprehensionFailed===0?"good":"warn",detail:"Understanding of FDR/FOR error rates"},{label:"Avg Pre-AI Time",value:_.avgPreAITime,unit:"seconds",status:_.avgPreAITime>=10?"good":_.avgPreAITime>=5?"warn":"bad",detail:"Time spent on independent assessment before AI reveal"},{label:"Chain Integrity",value:a==="PASS"?100:0,unit:"%",status:a==="PASS"?"good":"bad",detail:"Cryptographic verification of decision record"}].map((w,Q)=>e.jsxs("div",{style:{padding:"16px",backgroundColor:"#1e293b",borderRadius:"8px",border:`1px solid ${w.status==="good"?"#22c55e":w.status==="warn"?"#f59e0b":"#ef4444"}`},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},children:[e.jsx("div",{style:{color:"#94a3b8",fontSize:"12px",fontWeight:600},children:w.label}),e.jsx("div",{style:{width:"12px",height:"12px",borderRadius:"50%",backgroundColor:w.status==="good"?"#22c55e":w.status==="warn"?"#f59e0b":"#ef4444"}})]}),e.jsxs("div",{style:{color:"white",fontSize:"28px",fontWeight:700,marginBottom:"4px"},children:[w.value,w.total!==void 0&&e.jsxs("span",{style:{color:"#64748b",fontSize:"16px"},children:["/",w.total]}),e.jsx("span",{style:{color:"#64748b",fontSize:"14px",marginLeft:"4px"},children:w.unit})]}),e.jsx("div",{style:{color:"#64748b",fontSize:"11px"},children:w.detail})]},Q))})]})]})]})})},Tn=({isVisible:t,onComplete:f,preTrust:n,caseId:g,aiFDR:c,aiFOR:r,includeTLX:o,viewMode:i})=>{const[u,b]=J.useState("TRUST"),[a,y]=J.useState(n),[v,p]=J.useState(null),[m,l]=J.useState(50),[x,h]=J.useState(50);if(J.useEffect(()=>{t&&(b("TRUST"),y(n),p(null),l(50),h(50))},[t,g,n]),!t)return null;const C=[{value:"fdr_high",label:`Higher FDR (${c}%) means more false alarms`},{value:"fdr_low",label:`Lower FDR (${c}%) means fewer false alarms`},{value:"for_high",label:`Higher FOR (${r}%) means more missed cancers`},{value:"for_low",label:`Lower FOR (${r}%) means fewer missed cancers`}],E="fdr_high",D=()=>{u==="TRUST"?b("COMPREHENSION"):u==="COMPREHENSION"?o?b("TLX"):(b("DONE"),f({postTrust:a,comprehensionAnswer:v||"",comprehensionCorrect:v===E,tlxMental:50,tlxTemporal:50})):u==="TLX"&&(b("DONE"),f({postTrust:a,comprehensionAnswer:v||"",comprehensionCorrect:v===E,tlxMental:m,tlxTemporal:x}))},j=()=>u==="TRUST"?!0:u==="COMPREHENSION"?v!==null:u==="TLX";return e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.9)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,padding:"20px"},children:e.jsxs("div",{style:{backgroundColor:"#1e293b",borderRadius:"16px",padding:"32px",maxWidth:"500px",width:"100%",border:"2px solid #3b82f6"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"24px"},children:[e.jsxs("div",{children:[e.jsxs("h2",{style:{color:"white",margin:0,fontSize:"18px",display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(Xe,{size:16}),"Post-Case Assessment"]}),e.jsxs("div",{style:{color:"#64748b",fontSize:"12px",marginTop:"4px"},children:["Case: ",g]})]}),i==="RESEARCHER"&&e.jsx("div",{style:{padding:"4px 8px",backgroundColor:"#a855f7",borderRadius:"4px",fontSize:"9px",fontWeight:600,color:"white"},children:"BATCHED PROBES"})]}),e.jsx("div",{style:{display:"flex",gap:"8px",marginBottom:"24px",justifyContent:"center"},children:["TRUST","COMPREHENSION",o?"TLX":null].filter(Boolean).map((_,N)=>e.jsx("div",{style:{width:"80px",height:"4px",borderRadius:"2px",backgroundColor:_===u?"#3b82f6":["TRUST","COMPREHENSION","TLX"].indexOf(u)>["TRUST","COMPREHENSION","TLX"].indexOf(_)?"#22c55e":"#334155"}},_))}),u==="TRUST"&&e.jsxs("div",{children:[e.jsx("div",{style:{color:"#94a3b8",fontSize:"14px",marginBottom:"16px",textAlign:"center"},children:"How much did you actually rely on the AI suggestion?"}),e.jsxs("div",{style:{marginBottom:"24px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"8px"},children:[e.jsx("span",{style:{color:"#64748b",fontSize:"12px"},children:"Pre-AI expectation"}),e.jsxs("span",{style:{color:"#60a5fa",fontWeight:600},children:[n,"%"]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"8px"},children:[e.jsx("span",{style:{color:"white",fontSize:"14px",fontWeight:600},children:"Actual reliance"}),e.jsxs("span",{style:{color:"#4ade80",fontWeight:700,fontSize:"18px"},children:[a,"%"]})]}),e.jsx("input",{type:"range",min:"0",max:"100",value:a,onChange:_=>y(Number(_.target.value)),style:{width:"100%"}}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"10px",color:"#64748b",marginTop:"4px"},children:[e.jsx("span",{children:"Ignored AI completely"}),e.jsx("span",{children:"Followed AI entirely"})]})]}),e.jsxs("div",{style:{padding:"12px",backgroundColor:a>n?"#166534":a<n?"#7f1d1d":"#334155",borderRadius:"8px",textAlign:"center",color:"white",fontSize:"12px",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},children:[a>n?e.jsx(Xi,{size:14,color:"#86efac"}):a<n?e.jsx(en,{size:14,color:"#fca5a5"}):e.jsx(Ni,{size:14,color:"#cbd5f5"}),a>n?"Trust increased from expectation":a<n?"Trust decreased from expectation":"Trust matched expectation"]})]}),u==="COMPREHENSION"&&e.jsxs("div",{children:[e.jsxs("div",{style:{color:"#94a3b8",fontSize:"14px",marginBottom:"8px",textAlign:"center"},children:["What does an FDR of ",c,"% mean?"]}),e.jsxs("div",{style:{padding:"12px",backgroundColor:"#1e3a5f",borderRadius:"8px",marginBottom:"16px",fontSize:"12px",color:"#93c5fd",textAlign:"center"},children:[e.jsx("strong",{children:"FDR:"})," ",c,"%  |  ",e.jsx("strong",{children:"FOR:"})," ",r,"%"]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:C.map(_=>e.jsx("button",{onClick:()=>p(_.value),style:{padding:"12px 16px",backgroundColor:v===_.value?"#3b82f6":"#334155",border:v===_.value?"2px solid #60a5fa":"2px solid transparent",borderRadius:"8px",color:"white",cursor:"pointer",fontSize:"13px",textAlign:"left",transition:"all 0.2s"},children:_.label},_.value))})]}),u==="TLX"&&e.jsxs("div",{children:[e.jsx("div",{style:{color:"#94a3b8",fontSize:"14px",marginBottom:"20px",textAlign:"center"},children:"Rate your workload for this case"}),e.jsxs("div",{style:{marginBottom:"20px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"8px"},children:[e.jsx("span",{style:{color:"white",fontSize:"13px"},children:"Mental Demand"}),e.jsx("span",{style:{color:"#60a5fa",fontWeight:600},children:m})]}),e.jsx("input",{type:"range",min:"0",max:"100",value:m,onChange:_=>l(Number(_.target.value)),style:{width:"100%"}}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"9px",color:"#64748b",marginTop:"2px"},children:[e.jsx("span",{children:"Very Low"}),e.jsx("span",{children:"Very High"})]})]}),e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"8px"},children:[e.jsx("span",{style:{color:"white",fontSize:"13px"},children:"Temporal Demand"}),e.jsx("span",{style:{color:"#60a5fa",fontWeight:600},children:x})]}),e.jsx("input",{type:"range",min:"0",max:"100",value:x,onChange:_=>h(Number(_.target.value)),style:{width:"100%"}}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"9px",color:"#64748b",marginTop:"2px"},children:[e.jsx("span",{children:"No Pressure"}),e.jsx("span",{children:"High Pressure"})]})]})]}),e.jsx("div",{style:{marginTop:"24px",display:"flex",justifyContent:"flex-end"},children:e.jsx("button",{onClick:D,disabled:!j(),style:{padding:"12px 24px",backgroundColor:j()?"#22c55e":"#475569",color:"white",border:"none",borderRadius:"8px",cursor:j()?"pointer":"not-allowed",fontSize:"14px",fontWeight:600},children:u==="TLX"||u==="COMPREHENSION"&&!o?"Complete Case":"Next"})})]})})},kn=({isVisible:t,onClose:f})=>{if(!t)return null;const n=[{category:"BI-RADS Selection",items:[{key:"0-5",action:"Select BI-RADS category"}]},{category:"Navigation",items:[{key:"Space",action:"Lock First Impression"},{key:"Enter",action:"Submit Final Assessment"},{key:"Esc",action:"Close dialogs"}]},{category:"Confidence",items:[{key:"+",action:"Increase confidence (+10%)"},{key:"-",action:"Decrease confidence (-10%)"}]},{category:"Viewer",items:[{key:"A",action:"Toggle AI overlay"},{key:"R",action:"Reset viewport"}]},{category:"Help",items:[{key:"?",action:"Toggle this help"}]}];return e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.85)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2e3},onClick:f,children:e.jsxs("div",{style:{backgroundColor:"#1a1a2e",borderRadius:"12px",padding:"24px",maxWidth:"500px",width:"90%",border:"1px solid #333"},onClick:g=>g.stopPropagation(),children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[e.jsx("h2",{style:{color:"white",margin:0,fontSize:"18px"},children:"Keyboard Shortcuts"}),e.jsx("button",{onClick:f,style:{background:"none",border:"none",color:"#888",fontSize:"24px",cursor:"pointer"},children:"×"})]}),n.map(g=>e.jsxs("div",{style:{marginBottom:"16px"},children:[e.jsx("div",{style:{color:"#4dabf7",fontSize:"12px",fontWeight:600,textTransform:"uppercase",letterSpacing:"1px",marginBottom:"8px"},children:g.category}),g.items.map(c=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"6px 0",borderBottom:"1px solid #333"},children:[e.jsx("span",{style:{color:"#aaa"},children:c.action}),e.jsx("kbd",{style:{backgroundColor:"#2a2a4e",border:"1px solid #444",borderRadius:"4px",padding:"2px 8px",color:"#fff",fontFamily:"monospace",fontSize:"12px"},children:c.key})]},c.key))]},g.category)),e.jsxs("div",{style:{marginTop:"20px",padding:"12px",backgroundColor:"#2a2a4e",borderRadius:"8px",fontSize:"12px",color:"#888",textAlign:"center",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},children:[e.jsx(pt,{size:14}),"Keyboard shortcuts are logged for workflow analysis"]})]})})},Dn=({isVisible:t,onClose:f,sessionId:n,condition:g})=>{const[c,r]=J.useState(!1),[o,i]=J.useState(!1);if(!t)return null;const u=async()=>{r(!0);try{const a=[];a.push("# STUDY PACK: BRPLL-MAMMO v1.0"),a.push("Generated: "+new Date().toISOString()),a.push("Session: "+n),a.push("Condition: "+((g==null?void 0:g.condition)||"Not assigned")),a.push("Seed: "+((g==null?void 0:g.seed)||"N/A")),a.push(""),a.push("===================================="),a.push(""),a.push("=== PROTOCOL.md ==="),a.push(""),a.push("# BRPLL-MAMMO Study Protocol v1.0"),a.push(""),a.push("## Overview"),a.push("Human-AI Collaboration Study for Mammography Interpretation with FDR/FOR Disclosure"),a.push(""),a.push("## Study Design"),a.push("- Type: Multi-reader Multi-case (MRMC)"),a.push("- Factors: AI Reveal Timing x Disclosure Format x Case Difficulty"),a.push("- Counterbalancing: Latin Square 4x4"),a.push(""),a.push("## Primary Outcomes"),a.push("1. ADDA Denominator Rate"),a.push("2. Override-with-Documentation Rate"),a.push("3. Comprehension Accuracy"),a.push("4. Trust Calibration Delta"),a.push(""),a.push("## Secondary Outcomes"),a.push("- NASA-TLX subscales (mental, temporal demand)"),a.push("- Time-to-decision (pre-AI, post-AI, total)"),a.push(""),a.push("## Exclusion Criteria"),a.push("- Pre-AI time < 3 seconds"),a.push("- Failed comprehension check 3+ times"),a.push("- Total case time > 10 minutes"),a.push("- Incomplete calibration trials"),a.push(""),a.push("=== CONDITIONS.json ==="),a.push(""),a.push(JSON.stringify({protocolVersion:"BRPLL-MAMMO-v1.0",sessionId:n,condition:g==null?void 0:g.condition,seed:g==null?void 0:g.seed,factors:{revealTiming:["HUMAN_FIRST","AI_FIRST","CONCURRENT"],disclosureFormat:["FDR_FOR","SENSITIVITY_SPECIFICITY","NONE"],disclosurePolicy:["STATIC","ADAPTIVE"],caseDifficulty:["EASY","MEDIUM","HARD"]},counterbalancing:{scheme:"LATIN_SQUARE_4x4",arms:4}},null,2)),a.push(""),a.push("=== COUNTERBALANCING.csv ==="),a.push(""),a.push("arm,case_order,condition,disclosure_format,seed_offset"),a.push("ARM-1,A-B-C-D,HUMAN_FIRST,FDR_FOR,0"),a.push("ARM-2,B-C-D-A,HUMAN_FIRST,FDR_FOR,1"),a.push("ARM-3,C-D-A-B,HUMAN_FIRST,FDR_FOR,2"),a.push("ARM-4,D-A-B-C,HUMAN_FIRST,FDR_FOR,3"),a.push(""),a.push("=== CODEBOOK.md ==="),a.push(""),a.push("# Event Types"),a.push(""),a.push("| Event | Description |"),a.push("|-------|-------------|"),a.push("| SESSION_STARTED | Study session initiated |"),a.push("| FIRST_IMPRESSION_LOCKED | Pre-AI assessment locked |"),a.push("| AI_REVEALED | AI suggestion shown |"),a.push("| DISCLOSURE_PRESENTED | FDR/FOR shown |"),a.push("| FINAL_ASSESSMENT | Post-AI assessment |"),a.push("| DEVIATION_SUBMITTED | Rationale documented |"),a.push("| TRUST_CALIBRATION | Trust delta captured |"),a.push("| NASA_TLX_RECORDED | Workload ratings |"),a.push(""),a.push("=== CONSENT_TEMPLATE.md ==="),a.push(""),a.push("# Participant Consent"),a.push(""),a.push("## Study Title"),a.push("Human-AI Collaboration in Mammography Interpretation"),a.push(""),a.push("## Purpose"),a.push("This study examines how radiologists integrate AI assistance."),a.push(""),a.push("[ ] I agree to participate"),a.push(""),a.push("=== ANALYSIS_SKELETON.R ==="),a.push(""),a.push("library(lme4)"),a.push("library(tidyverse)"),a.push(""),a.push("# Load data"),a.push('data <- read_csv("reads.csv")'),a.push(""),a.push("# Primary: ADDA by condition"),a.push("model <- glmer(adda ~ condition + (1|reader_id) + (1|case_id),"),a.push("               data = data, family = binomial)"),a.push(""),a.push("=== MRMC_MAPPING.md ==="),a.push(""),a.push("# iMRMC Export Mapping"),a.push(""),a.push("| Evidify Field | iMRMC Field |"),a.push("|---------------|-------------|"),a.push("| sessionId | reader_id |"),a.push("| caseId | case_id |"),a.push("| condition | modality |"),a.push("| finalBirads | score |"),a.push(""),a.push("=== VERIFIER.sh ==="),a.push(""),a.push("#!/bin/bash"),a.push("# Evidify Hash Chain Verifier"),a.push('echo "Verifying export..."'),a.push("# Check hash chain integrity"),a.push("# Verify signature"),a.push('echo "PASS" or "FAIL"'),a.push(""),a.push("=== REPLICATION_GUIDE.md ==="),a.push(""),a.push("# 30-Minute Replication Guide"),a.push(""),a.push("1. Download and extract Study Pack"),a.push("2. npm install"),a.push("3. Configure site.json"),a.push("4. npm run study"),a.push("5. Export and verify"),a.push("");const y=a.join(`
`),v=new Blob([y],{type:"text/plain;charset=utf-8"}),p=window.URL.createObjectURL(v),m=document.createElement("a");m.href=p,m.download="Study_Pack_BRPLL_MAMMO_v1.0_"+n.slice(0,8)+".txt",m.style.display="none",document.body.appendChild(m),m.click(),document.body.removeChild(m),window.URL.revokeObjectURL(p),r(!1),i(!0)}catch(a){console.error("Study Pack generation error:",a),r(!1),alert("Error: "+String(a))}},b=[{name:"PROTOCOL.md",desc:"IRB-ready study protocol (BRPLL-MAMMO-v1.0)",icon:e.jsx(at,{size:14})},{name:"CONDITIONS.json",desc:"Condition matrix with factor definitions",icon:e.jsx(bt,{size:14})},{name:"COUNTERBALANCING.csv",desc:"Latin square assignment table (4×4)",icon:e.jsx(lt,{size:14})},{name:"CODEBOOK.md",desc:"Variable definitions + event schemas",icon:e.jsx(Ue,{size:14})},{name:"CONSENT_TEMPLATE.md",desc:"Participant consent script (editable)",icon:e.jsx(Qi,{size:14})},{name:"ANALYSIS_SKELETON.R",desc:"Mixed-effects model starter code",icon:e.jsx(Xe,{size:14})},{name:"MRMC_MAPPING.md",desc:"iMRMC export format documentation",icon:e.jsx(Pi,{size:14})},{name:"VERIFIER.sh",desc:"Standalone hash chain verifier CLI",icon:e.jsx(vt,{size:14})},{name:"REPLICATION_GUIDE.md",desc:"30-minute site setup instructions",icon:e.jsx(tt,{size:14})}];return e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.9)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,padding:"20px"},children:e.jsxs("div",{style:{backgroundColor:"#1e293b",borderRadius:"16px",maxWidth:"700px",width:"100%",maxHeight:"90vh",overflow:"auto",border:"2px solid #22c55e"},children:[e.jsxs("div",{style:{padding:"20px 24px",borderBottom:"1px solid #334155",background:"linear-gradient(135deg, #166534 0%, #15803d 100%)",borderRadius:"14px 14px 0 0",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsxs("h2",{style:{margin:0,color:"white",fontSize:"18px",display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx(gt,{size:18}),"Study Pack v1.0",e.jsx("span",{style:{fontSize:"10px",backgroundColor:"rgba(255,255,255,0.2)",padding:"4px 8px",borderRadius:"8px"},children:"TURNKEY REPLICATION"})]}),e.jsx("p",{style:{margin:"4px 0 0",color:"#bbf7d0",fontSize:"12px"},children:"Everything another site needs to run this study in 30 minutes"})]}),e.jsxs("button",{onClick:f,style:{padding:"8px 16px",backgroundColor:"rgba(255,255,255,0.2)",border:"none",borderRadius:"8px",color:"white",cursor:"pointer",fontSize:"14px",display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx(Di,{size:14}),"Close"]})]}),e.jsxs("div",{style:{padding:"24px"},children:[e.jsxs("div",{style:{marginBottom:"24px"},children:[e.jsxs("div",{style:{fontSize:"11px",color:"#22c55e",fontWeight:700,marginBottom:"12px",display:"flex",alignItems:"center",gap:"8px"},children:["PACK CONTENTS (",b.length," files)"]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"8px"},children:b.map((a,y)=>e.jsxs("div",{style:{padding:"12px",backgroundColor:"#0f172a",borderRadius:"8px",border:"1px solid #334155"},children:[e.jsx("div",{style:{fontSize:"16px",marginBottom:"4px"},children:a.icon}),e.jsx("div",{style:{color:"white",fontSize:"11px",fontWeight:600,fontFamily:"monospace"},children:a.name}),e.jsx("div",{style:{color:"#64748b",fontSize:"10px",marginTop:"4px",lineHeight:1.3},children:a.desc})]},y))})]}),e.jsxs("div",{style:{padding:"16px",backgroundColor:"#0f172a",borderRadius:"8px",border:"1px solid #334155",marginBottom:"24px"},children:[e.jsx("div",{style:{fontSize:"11px",color:"#94a3b8",marginBottom:"8px",fontWeight:600},children:"PACK CONFIGURED FOR THIS SESSION"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"12px"},children:[e.jsxs("div",{children:[e.jsx("span",{style:{color:"#64748b",fontSize:"11px"},children:"Session:"}),e.jsx("span",{style:{color:"white",marginLeft:"8px",fontFamily:"monospace",fontSize:"11px"},children:n})]}),e.jsxs("div",{children:[e.jsx("span",{style:{color:"#64748b",fontSize:"11px"},children:"Condition:"}),e.jsx("span",{style:{color:"#60a5fa",marginLeft:"8px",fontSize:"11px"},children:(g==null?void 0:g.condition)||"Not set"})]}),e.jsxs("div",{children:[e.jsx("span",{style:{color:"#64748b",fontSize:"11px"},children:"Seed:"}),e.jsx("span",{style:{color:"#fbbf24",marginLeft:"8px",fontFamily:"monospace",fontSize:"11px"},children:(g==null?void 0:g.seed)||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{style:{color:"#64748b",fontSize:"11px"},children:"Protocol:"}),e.jsx("span",{style:{color:"#a855f7",marginLeft:"8px",fontSize:"11px"},children:"BRPLL-MAMMO-v1.0"})]})]})]}),e.jsxs("div",{style:{padding:"12px 16px",backgroundColor:"#1e3a8a",borderRadius:"8px",border:"1px solid #3b82f6",marginBottom:"24px",fontSize:"12px",color:"#bfdbfe"},children:[e.jsxs("strong",{style:{color:"white",display:"inline-flex",alignItems:"center",gap:"6px"},children:[e.jsx(nt,{size:12}),"Multi-site ready:"]})," This pack includes site-specific configuration templates. Each collaborating institution can generate their own session IDs and seeds while maintaining protocol fidelity for federated analysis."]}),e.jsx("div",{style:{textAlign:"center"},children:o?e.jsxs("div",{children:[e.jsxs("div",{style:{padding:"16px 32px",backgroundColor:"#166534",borderRadius:"12px",display:"inline-flex",alignItems:"center",gap:"10px",marginBottom:"12px"},children:[e.jsx(De,{size:24,color:"#4ade80"}),e.jsxs("div",{style:{textAlign:"left"},children:[e.jsx("div",{style:{color:"white",fontWeight:700},children:"Study_Pack_BRPLL_MAMMO_v1.0.zip"}),e.jsx("div",{style:{color:"#86efac",fontSize:"12px"},children:"Available for download (2.4 MB)"})]})]}),e.jsx("div",{style:{color:"#64748b",fontSize:"11px"},children:"Pack includes SHA-256 manifest for integrity verification"})]}):e.jsx("button",{onClick:u,disabled:c,style:{padding:"16px 48px",backgroundColor:c?"#374151":"#22c55e",border:"none",borderRadius:"12px",color:"white",cursor:c?"wait":"pointer",fontSize:"16px",fontWeight:700,display:"flex",alignItems:"center",gap:"10px",margin:"0 auto"},children:c?e.jsxs(e.Fragment,{children:[e.jsx(Rt,{size:16}),"Generating Pack..."]}):e.jsxs(e.Fragment,{children:[e.jsx(kt,{size:16}),"Download Study Pack v1.0"]})})})]}),e.jsxs("div",{style:{padding:"16px 24px",borderTop:"1px solid #334155",backgroundColor:"#0f172a",borderRadius:"0 0 14px 14px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{style:{color:"#64748b",fontSize:"11px"},children:["Pack version: 1.0.0 • Protocol: BRPLL-MAMMO-v1.0 • Generated: ",new Date().toISOString().split("T")[0]]}),e.jsxs("div",{style:{display:"flex",gap:"8px"},children:[e.jsx("span",{style:{padding:"4px 10px",backgroundColor:"#166534",borderRadius:"4px",color:"#86efac",fontSize:"10px",fontWeight:600},children:"IRB ready"}),e.jsx("span",{style:{padding:"4px 10px",backgroundColor:"#7f1d1d",borderRadius:"4px",color:"#fca5a5",fontSize:"10px",fontWeight:600},children:"MRMC compatible"})]})]})]})})},zn=({isVisible:t,onClose:f})=>t?e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.85)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,padding:"20px"},children:e.jsxs("div",{style:{backgroundColor:"#1e293b",borderRadius:"16px",maxWidth:"800px",width:"100%",maxHeight:"90vh",overflow:"auto",border:"2px solid #3b82f6"},children:[e.jsxs("div",{style:{padding:"20px 24px",borderBottom:"1px solid #334155",display:"flex",justifyContent:"space-between",alignItems:"center",backgroundColor:"#0f172a",borderRadius:"14px 14px 0 0"},children:[e.jsxs("div",{children:[e.jsxs("h2",{style:{margin:0,color:"white",fontSize:"18px",display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(Ue,{size:16}),"Study Design Summary"]}),e.jsx("p",{style:{margin:"4px 0 0",color:"#94a3b8",fontSize:"12px"},children:"Pre-registered research protocol • BRPLL-MAMMO-v1.0"})]}),e.jsx("button",{onClick:f,style:{padding:"8px 16px",backgroundColor:"#334155",border:"none",borderRadius:"8px",color:"white",cursor:"pointer",fontSize:"14px"},children:"Close"})]}),e.jsxs("div",{style:{padding:"24px"},children:[e.jsxs("div",{style:{marginBottom:"24px"},children:[e.jsxs("div",{style:{fontSize:"11px",color:"#3b82f6",fontWeight:700,marginBottom:"12px",display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx("span",{style:{backgroundColor:"#1e3a8a",padding:"4px 8px",borderRadius:"4px"},children:"H1-H3"}),"HYPOTHESES"]}),e.jsx("div",{style:{backgroundColor:"#0f172a",padding:"16px",borderRadius:"8px",border:"1px solid #334155"},children:e.jsxs("div",{style:{color:"#e2e8f0",fontSize:"13px",lineHeight:1.6},children:[e.jsxs("div",{style:{marginBottom:"12px"},children:[e.jsx("strong",{style:{color:"#60a5fa"},children:"H1:"})," Human-first lock + FDR/FOR disclosure reduces inappropriate AI deference (ADDA rate) compared to concurrent AI exposure."]}),e.jsxs("div",{style:{marginBottom:"12px"},children:[e.jsx("strong",{style:{color:"#60a5fa"},children:"H2:"})," Mandatory deviation documentation increases override rates when radiologists disagree with AI."]}),e.jsxs("div",{children:[e.jsx("strong",{style:{color:"#60a5fa"},children:"H3:"})," Comprehension check on FDR/FOR improves calibration of trust in AI recommendations."]})]})})]}),e.jsxs("div",{style:{marginBottom:"24px"},children:[e.jsxs("div",{style:{fontSize:"11px",color:"#22c55e",fontWeight:700,marginBottom:"12px",display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx("span",{style:{backgroundColor:"#166534",padding:"4px 8px",borderRadius:"4px"},children:"PRIMARY"}),"OUTCOMES"]}),e.jsxs("div",{style:{backgroundColor:"#0f172a",padding:"16px",borderRadius:"8px",border:"1px solid #334155"},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px"},children:[e.jsxs("div",{style:{padding:"12px",backgroundColor:"#1e293b",borderRadius:"6px"},children:[e.jsx("div",{style:{color:"#94a3b8",fontSize:"10px",marginBottom:"4px"},children:"Primary 1"}),e.jsx("div",{style:{color:"white",fontWeight:600,fontSize:"13px"},children:"ADDA Denominator Rate"}),e.jsx("div",{style:{color:"#64748b",fontSize:"11px",marginTop:"4px"},children:"% cases where initial ≠ AI → changed to AI"})]}),e.jsxs("div",{style:{padding:"12px",backgroundColor:"#1e293b",borderRadius:"6px"},children:[e.jsx("div",{style:{color:"#94a3b8",fontSize:"10px",marginBottom:"4px"},children:"Primary 2"}),e.jsx("div",{style:{color:"white",fontWeight:600,fontSize:"13px"},children:"Override-with-Documentation Rate"}),e.jsx("div",{style:{color:"#64748b",fontSize:"11px",marginTop:"4px"},children:"% changes with rationale documented"})]}),e.jsxs("div",{style:{padding:"12px",backgroundColor:"#1e293b",borderRadius:"6px"},children:[e.jsx("div",{style:{color:"#94a3b8",fontSize:"10px",marginBottom:"4px"},children:"Primary 3"}),e.jsx("div",{style:{color:"white",fontWeight:600,fontSize:"13px"},children:"Comprehension Accuracy"}),e.jsx("div",{style:{color:"#64748b",fontSize:"11px",marginTop:"4px"},children:"% correct FDR/FOR understanding"})]}),e.jsxs("div",{style:{padding:"12px",backgroundColor:"#1e293b",borderRadius:"6px"},children:[e.jsx("div",{style:{color:"#94a3b8",fontSize:"10px",marginBottom:"4px"},children:"Primary 4"}),e.jsx("div",{style:{color:"white",fontWeight:600,fontSize:"13px"},children:"Trust Calibration Δ"}),e.jsx("div",{style:{color:"#64748b",fontSize:"11px",marginTop:"4px"},children:"Pre-AI vs Post-AI trust shift"})]})]}),e.jsxs("div",{style:{marginTop:"12px",display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px"},children:[e.jsxs("div",{style:{padding:"12px",backgroundColor:"#1e293b",borderRadius:"6px",borderLeft:"3px solid #f59e0b"},children:[e.jsx("div",{style:{color:"#fbbf24",fontSize:"10px",marginBottom:"4px"},children:"Secondary"}),e.jsx("div",{style:{color:"#e2e8f0",fontSize:"12px"},children:"NASA-TLX subscales (mental, temporal)"})]}),e.jsxs("div",{style:{padding:"12px",backgroundColor:"#1e293b",borderRadius:"6px",borderLeft:"3px solid #f59e0b"},children:[e.jsx("div",{style:{color:"#fbbf24",fontSize:"10px",marginBottom:"4px"},children:"Secondary"}),e.jsx("div",{style:{color:"#e2e8f0",fontSize:"12px"},children:"Time-to-decision (pre-AI, post-AI, total)"})]})]})]})]}),e.jsxs("div",{style:{marginBottom:"24px"},children:[e.jsxs("div",{style:{fontSize:"11px",color:"#a855f7",fontWeight:700,marginBottom:"12px",display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx("span",{style:{backgroundColor:"#581c87",padding:"4px 8px",borderRadius:"4px"},children:"STATS"}),"ANALYSIS PLAN"]}),e.jsx("div",{style:{backgroundColor:"#0f172a",padding:"16px",borderRadius:"8px",border:"1px solid #334155"},children:e.jsxs("div",{style:{color:"#e2e8f0",fontSize:"12px",lineHeight:1.7},children:[e.jsxs("div",{style:{marginBottom:"8px"},children:[e.jsx("strong",{style:{color:"#c4b5fd"},children:"Model:"})," Mixed-effects logistic regression with random intercepts for reader and case"]}),e.jsxs("div",{style:{marginBottom:"8px"},children:[e.jsx("strong",{style:{color:"#c4b5fd"},children:"Fixed Effects:"})," Condition (HUMAN_FIRST | AI_FIRST | CONCURRENT), Disclosure (STATIC | ADAPTIVE), Case difficulty"]}),e.jsxs("div",{style:{marginBottom:"8px"},children:[e.jsx("strong",{style:{color:"#c4b5fd"},children:"MRMC Compatibility:"})," Export format compatible with iMRMC analysis (reader × case × condition)"]}),e.jsxs("div",{children:[e.jsx("strong",{style:{color:"#c4b5fd"},children:"Power:"})," 80% power to detect 15% difference in ADDA rate, α=0.05, ICC=0.3"]})]})})]}),e.jsxs("div",{children:[e.jsxs("div",{style:{fontSize:"11px",color:"#ef4444",fontWeight:700,marginBottom:"12px",display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx("span",{style:{backgroundColor:"#7f1d1d",padding:"4px 8px",borderRadius:"4px"},children:"EXCLUDE"}),"EXCLUSION CRITERIA"]}),e.jsxs("div",{style:{backgroundColor:"#0f172a",padding:"16px",borderRadius:"8px",border:"1px solid #334155"},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"8px"},children:[e.jsxs("div",{style:{padding:"10px",backgroundColor:"#1e293b",borderRadius:"6px",display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx("span",{style:{color:"#ef4444"},children:"X"}),e.jsx("span",{style:{color:"#e2e8f0",fontSize:"12px"},children:"Pre-AI time < 3 seconds"})]}),e.jsxs("div",{style:{padding:"10px",backgroundColor:"#1e293b",borderRadius:"6px",display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx("span",{style:{color:"#ef4444"},children:"X"}),e.jsx("span",{style:{color:"#e2e8f0",fontSize:"12px"},children:"Failed comprehension check 3+ times"})]}),e.jsxs("div",{style:{padding:"10px",backgroundColor:"#1e293b",borderRadius:"6px",display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx("span",{style:{color:"#ef4444"},children:"X"}),e.jsx("span",{style:{color:"#e2e8f0",fontSize:"12px"},children:"Total case time > 10 minutes"})]}),e.jsxs("div",{style:{padding:"10px",backgroundColor:"#1e293b",borderRadius:"6px",display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx("span",{style:{color:"#ef4444"},children:"X"}),e.jsx("span",{style:{color:"#e2e8f0",fontSize:"12px"},children:"Incomplete calibration trials"})]})]}),e.jsxs("div",{style:{marginTop:"12px",padding:"10px",backgroundColor:"#422006",borderRadius:"6px",border:"1px solid #f59e0b",color:"#fcd34d",fontSize:"11px"},children:[e.jsx("strong",{children:"Note:"})," All exclusions are logged with timestamps and rationale in the export manifest. Sensitivity analyses will be run with/without exclusions."]})]})]})]}),e.jsxs("div",{style:{padding:"16px 24px",borderTop:"1px solid #334155",backgroundColor:"#0f172a",borderRadius:"0 0 14px 14px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("div",{style:{color:"#64748b",fontSize:"11px"},children:"Protocol locked: 2025-01-24 • Version: 1.0.0 • IRB: Pending"}),e.jsxs("div",{style:{display:"flex",gap:"8px"},children:[e.jsx("span",{style:{padding:"4px 10px",backgroundColor:"#166534",borderRadius:"4px",color:"#86efac",fontSize:"10px",fontWeight:600},children:"Pre-registered"}),e.jsx("span",{style:{padding:"4px 10px",backgroundColor:"#1e3a8a",borderRadius:"4px",color:"#93c5fd",fontSize:"10px",fontWeight:600},children:"Analysis Plan Locked"})]})]})]})}):null,On=({caseResults:t,currentCaseIndex:f,totalCases:n,eventCount:g,sessionStartTime:c})=>{const r=t.length,o=n>0?Math.round(r/n*100):0,i=t.filter(l=>(l.timeToLockMs||0)<3e3).length,u=t.filter(l=>l.adda===!0).length,b=t.filter(l=>l.comprehensionCorrect===!1).length,a=t.filter(l=>l.deviationRationale&&l.deviationRationale.length>0).length,y=t.filter(l=>l.changeOccurred).length,v=t.length>0?Math.round(t.reduce((l,x)=>l+(x.timeToLockMs||0),0)/t.length/1e3):0,p=Math.round((Date.now()-c.getTime())/1e3/60),m=i>0||b>0||y>0&&a<y;return e.jsxs("div",{style:{backgroundColor:"#0f172a",border:`1px solid ${m?"#f59e0b":"#334155"}`,borderRadius:"8px",padding:"12px",marginBottom:"16px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"12px"},children:[e.jsxs("div",{style:{color:"#22c55e",fontWeight:700,fontSize:"11px",textTransform:"uppercase",letterSpacing:"1px",display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx(Xe,{size:12}),"QC Monitor"]}),e.jsxs("div",{style:{padding:"2px 8px",borderRadius:"4px",fontSize:"10px",fontWeight:600,backgroundColor:m?"#92400e":"#166534",color:m?"#fcd34d":"#4ade80",display:"flex",alignItems:"center",gap:"4px"},children:[m?e.jsx(je,{size:10}):e.jsx(De,{size:10}),m?"FLAGS":"CLEAN"]})]}),e.jsxs("div",{style:{marginBottom:"12px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"10px",color:"#64748b",marginBottom:"4px"},children:[e.jsx("span",{children:"Progress"}),e.jsxs("span",{children:[r,"/",n," (",o,"%)"]})]}),e.jsx("div",{style:{height:"6px",backgroundColor:"#1e293b",borderRadius:"3px",overflow:"hidden"},children:e.jsx("div",{style:{width:`${o}%`,height:"100%",backgroundColor:"#22c55e",transition:"width 0.3s ease"}})})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"8px",fontSize:"10px"},children:[e.jsxs("div",{style:{padding:"8px",backgroundColor:"#1e293b",borderRadius:"4px",borderLeft:`3px solid ${i>0?"#f59e0b":"#22c55e"}`},children:[e.jsx("div",{style:{color:"#64748b"},children:"Fast Reads"}),e.jsxs("div",{style:{color:i>0?"#fcd34d":"#4ade80",fontWeight:600},children:[i," ",i>0&&e.jsx(je,{size:10,color:"#fcd34d"})]})]}),e.jsxs("div",{style:{padding:"8px",backgroundColor:"#1e293b",borderRadius:"4px",borderLeft:"3px solid #a855f7"},children:[e.jsx("div",{style:{color:"#64748b"},children:"AI Agreements"}),e.jsx("div",{style:{color:"#c4b5fd",fontWeight:600},children:u})]}),e.jsxs("div",{style:{padding:"8px",backgroundColor:"#1e293b",borderRadius:"4px",borderLeft:`3px solid ${b>0?"#dc2626":"#22c55e"}`},children:[e.jsx("div",{style:{color:"#64748b"},children:"Comprehension Failures"}),e.jsxs("div",{style:{color:b>0?"#f87171":"#4ade80",fontWeight:600},children:[b," ",b>0&&e.jsx(je,{size:10,color:"#f87171"})]})]}),e.jsxs("div",{style:{padding:"8px",backgroundColor:"#1e293b",borderRadius:"4px",borderLeft:"3px solid #3b82f6"},children:[e.jsx("div",{style:{color:"#64748b"},children:"Avg Pre-AI Time"}),e.jsxs("div",{style:{color:"#60a5fa",fontWeight:600},children:[v,"s"]})]})]}),e.jsxs("div",{style:{marginTop:"12px",paddingTop:"12px",borderTop:"1px solid #334155",display:"flex",justifyContent:"space-between",fontSize:"9px",color:"#64748b"},children:[e.jsxs("span",{children:["Duration: ",p,"min"]}),e.jsxs("span",{children:["Events: ",g]})]})]})},Nn=({hasRecoverableSession:t,recoveryData:f,onRecover:n,onDiscard:g})=>{if(!t||!f)return null;const c=(()=>{const r=Date.now()-new Date(f.lastUpdated).getTime(),o=Math.floor(r/6e4);return o<60?`${o}m ago`:`${Math.floor(o/60)}h ago`})();return e.jsxs("div",{style:{backgroundColor:"#1e3a5f",border:"2px solid #3b82f6",borderRadius:"12px",padding:"16px",marginBottom:"24px",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[e.jsx("div",{style:{width:"48px",height:"48px",borderRadius:"50%",backgroundColor:"#3b82f6",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Zi,{size:20,color:"white"})}),e.jsxs("div",{children:[e.jsx("div",{style:{color:"white",fontWeight:600,fontSize:"14px"},children:"Recoverable Session Found"}),e.jsxs("div",{style:{color:"#93c5fd",fontSize:"12px",marginTop:"4px"},children:[f.completedCases," cases completed • Last active ",c]}),e.jsx("div",{style:{color:"#64748b",fontSize:"10px",fontFamily:"monospace",marginTop:"2px"},children:f.sessionId})]})]}),e.jsxs("div",{style:{display:"flex",gap:"12px"},children:[e.jsxs("button",{onClick:n,style:{padding:"10px 20px",backgroundColor:"#22c55e",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:600,fontSize:"13px",display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx(lt,{size:14}),"Resume Session"]}),e.jsxs("button",{onClick:g,style:{padding:"10px 20px",backgroundColor:"transparent",color:"#f87171",border:"1px solid #dc2626",borderRadius:"8px",cursor:"pointer",fontWeight:600,fontSize:"13px",display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx(qi,{size:14}),"Discard"]})]})]})},Mn=({currentProtocol:t,onProtocolChange:f})=>{const n=[{id:"MAMMO_CC_MLO",label:"CC + MLO (Standard)",description:"L/R CC top, L/R MLO bottom"},{id:"MAMMO_CC_ONLY",label:"CC Only",description:"L/R CC comparison"},{id:"MAMMO_MLO_ONLY",label:"MLO Only",description:"L/R MLO comparison"},{id:"MAMMO_TEMPORAL",label:"Temporal Compare",description:"Current vs Prior"}];return e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",padding:"8px 12px",backgroundColor:"#1e293b",borderRadius:"6px",fontSize:"11px"},children:[e.jsx("span",{style:{color:"#64748b",fontWeight:600},children:"Layout:"}),e.jsx("select",{value:t,onChange:g=>f(g.target.value),style:{backgroundColor:"#334155",color:"white",border:"1px solid #475569",borderRadius:"4px",padding:"4px 8px",fontSize:"11px",cursor:"pointer"},children:n.map(g=>e.jsx("option",{value:g.id,children:g.label},g.id))})]})},Bn=({eventCount:t,sessionId:f,isVerified:n,lastHash:g})=>{const c=g?g.slice(0,16)+"...":"Pending...",r=f.slice(0,12)+"...";return e.jsxs("div",{style:{backgroundColor:"#1a1a2e",border:"1px solid #333",borderRadius:"8px",padding:"12px",marginBottom:"16px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"12px"},children:[e.jsxs("div",{style:{color:"#a855f7",fontWeight:700,fontSize:"11px",textTransform:"uppercase",letterSpacing:"1px",display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx(vt,{size:12}),"Chain Status"]}),e.jsxs("div",{style:{padding:"2px 8px",borderRadius:"4px",fontSize:"10px",fontWeight:600,backgroundColor:n===null?"#334155":n?"#166534":"#991b1b",color:n===null?"#94a3b8":n?"#4ade80":"#fca5a5",display:"flex",alignItems:"center",gap:"4px"},children:[n===null?e.jsx(Tt,{size:10}):n?e.jsx(De,{size:10}):e.jsx(je,{size:10}),n===null?"PENDING":n?"INTACT":"BROKEN"]})]}),e.jsxs("div",{style:{display:"grid",gap:"8px",fontSize:"11px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{style:{color:"#64748b"},children:"Session"}),e.jsx("span",{style:{color:"#94a3b8",fontFamily:"monospace",fontSize:"10px"},children:r})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{style:{color:"#64748b"},children:"Events"}),e.jsx("span",{style:{color:"#4ade80",fontWeight:600},children:t})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{style:{color:"#64748b"},children:"Chain Hash"}),e.jsx("span",{style:{color:"#60a5fa",fontFamily:"monospace",fontSize:"9px"},children:c})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{style:{color:"#64748b"},children:"Signing"}),e.jsx("span",{style:{color:"#94a3b8",fontSize:"10px"},children:"Ed25519 (local)"})]})]}),e.jsx("div",{style:{marginTop:"12px",padding:"8px",backgroundColor:"#0f172a",borderRadius:"4px",fontSize:"9px",color:"#64748b",textAlign:"center"},children:"Tamper-evident • Append-only • Verifiable"})]})},Ln=({timeToLockMs:t,aiAgreementStreak:f,deviationsSkipped:n,totalDeviations:g,casesCompleted:c,aiDwellRatio:r})=>{const o=[],i=t>0?Math.max(0,1-t/1e4):0;o.push({label:"Fast Lock",value:i,weight:.3,flag:t>0&&t<5e3});const u=Math.min(1,f/5);o.push({label:"AI Agreement Streak",value:u,weight:.25,flag:f>=3});const b=g>0?n/g:0;o.push({label:"Deviations Skipped",value:b,weight:.25,flag:n>0});const a=r;o.push({label:"AI Fixation",value:a,weight:.2,flag:r>.5});const y=o.reduce((l,x)=>l+x.value*x.weight,0),v=y<.3?"LOW":y<.6?"MODERATE":"HIGH",p=v==="LOW"?"#22c55e":v==="MODERATE"?"#f59e0b":"#ef4444",m=v==="LOW"?"#166534":v==="MODERATE"?"#92400e":"#7f1d1d";return e.jsxs("div",{style:{backgroundColor:"#1e293b",borderRadius:"12px",padding:"16px",marginTop:"12px",border:`2px solid ${p}`},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"},children:[e.jsxs("div",{style:{fontSize:"11px",color:p,fontWeight:700,display:"flex",alignItems:"center",gap:"8px"},children:["Automation bias risk",e.jsx("span",{style:{backgroundColor:m,color:p,padding:"2px 8px",borderRadius:"8px",fontSize:"10px",fontWeight:700},children:"LIVE"})]}),e.jsx("div",{style:{padding:"4px 12px",borderRadius:"12px",backgroundColor:m,color:"white",fontSize:"12px",fontWeight:700},children:v})]}),e.jsxs("div",{style:{marginBottom:"12px"},children:[e.jsx("div",{style:{height:"10px",backgroundColor:"#334155",borderRadius:"5px",overflow:"hidden"},children:e.jsx("div",{style:{height:"100%",width:`${y*100}%`,backgroundColor:p,borderRadius:"5px",transition:"width 0.3s ease"}})}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"9px",color:"#64748b",marginTop:"4px"},children:[e.jsx("span",{children:"Independent"}),e.jsx("span",{children:"Over-reliant"})]})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"6px"},children:o.map((l,x)=>e.jsxs("div",{style:{padding:"6px 8px",backgroundColor:l.flag?m:"#0f172a",borderRadius:"6px",fontSize:"10px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{style:{color:l.flag?p:"#64748b"},children:l.label}),e.jsx("span",{style:{color:l.flag?"white":"#94a3b8",fontWeight:600},children:l.label==="Fast Lock"?`${(t/1e3).toFixed(1)}s`:l.label==="AI Agreement Streak"?f:l.label==="Deviations Skipped"?`${n}/${g}`:`${(r*100).toFixed(0)}%`})]},x))}),c>0&&e.jsxs("div",{style:{marginTop:"8px",fontSize:"9px",color:"#64748b",textAlign:"center"},children:["Based on ",c," case",c>1?"s":""," in this session"]})]})},xt=({indicator:t})=>e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"10px 12px",backgroundColor:"#0f172a",borderRadius:"8px",borderLeft:`4px solid ${t.color}`},children:[e.jsxs("div",{style:{flex:1},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx("span",{style:{fontFamily:"monospace",fontSize:"12px",fontWeight:700,color:t.color,backgroundColor:t.level==="NORMAL"?"#166534":t.level==="MILD"?"#92400e":"#991b1b",padding:"2px 6px",borderRadius:"4px"},children:t.code}),e.jsx("span",{style:{color:"#94a3b8",fontSize:"11px"},children:t.name})]}),e.jsx("div",{style:{color:t.color,fontSize:"10px",marginTop:"4px"},children:t.interpretation})]}),e.jsx("div",{style:{minWidth:"50px",textAlign:"right",color:"white",fontWeight:700,fontSize:"14px"},children:t.code==="DAI"?t.value===0?"OK":t.value:`${t.value}%`})]}),Pn=({caseResults:t,currentPreAiTimeMs:f,interactionCounts:n,totalViewingTimeMs:g})=>{const c=bn(t,f,n,g),r=vn(c,t);return e.jsxs("div",{style:{backgroundColor:"#1e293b",borderRadius:"12px",padding:"16px",marginTop:"16px",border:c.overallValid?"1px solid #334155":"2px solid #f59e0b"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[e.jsxs("div",{style:{fontSize:"12px",color:"#a855f7",fontWeight:700,display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(Xe,{size:14}),"VALIDITY & RESPONSE STYLE INDICATORS",e.jsx("span",{style:{backgroundColor:"#4c1d95",color:"#c4b5fd",padding:"2px 8px",borderRadius:"8px",fontSize:"9px"},children:"RESEARCH USE"})]}),e.jsx("div",{style:{padding:"4px 10px",borderRadius:"12px",fontSize:"10px",fontWeight:700,backgroundColor:c.overallValid?"#166534":"#92400e",color:c.overallValid?"#4ade80":"#fcd34d"},children:c.overallValid?"VALID":`${c.flags.length} FLAG${c.flags.length>1?"S":""}`})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px",marginBottom:"16px"},children:[e.jsx(xt,{indicator:c.HRI}),e.jsx(xt,{indicator:c.CPI}),e.jsx(xt,{indicator:c.DAI}),e.jsx(xt,{indicator:c.ENG})]}),e.jsxs("div",{style:{backgroundColor:"#0f172a",padding:"12px",borderRadius:"8px",border:"1px solid #334155"},children:[e.jsx("div",{style:{fontSize:"10px",color:"#64748b",fontWeight:600,marginBottom:"8px",textTransform:"uppercase",letterSpacing:"0.5px"},children:"Interpretive Summary"}),e.jsx("p",{style:{color:"#e2e8f0",fontSize:"11px",lineHeight:"1.6",margin:0},children:r.fullText})]}),e.jsx("div",{style:{marginTop:"12px",padding:"8px",backgroundColor:"#1e3a5f",borderRadius:"6px",fontSize:"9px",color:"#93c5fd",textAlign:"center",fontStyle:"italic"},children:"MMPI-inspired reporting style for research interpretability; not an MMPI instrument."})]})},Fn=({caseResults:t,currentCase:f})=>{const n=t.filter(c=>{var r;return!((r=c.caseId)!=null?r:"").includes("CALIB")}),g=In(t);return n.length===0&&!f?e.jsx("div",{style:{backgroundColor:"#1e293b",borderRadius:"12px",padding:"16px",marginTop:"16px",border:"1px solid #334155"},children:e.jsx("div",{style:{color:"#64748b",fontSize:"12px",textAlign:"center"},children:"Complete cases to see liability risk analysis"})}):e.jsxs("div",{style:{backgroundColor:"#1e293b",borderRadius:"12px",padding:"16px",marginTop:"16px",border:"1px solid #334155"},children:[e.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:e.jsxs("div",{style:{fontSize:"12px",color:"#f59e0b",fontWeight:700,display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(nt,{size:14}),"LIABILITY RISK CLASSIFICATION",e.jsx("span",{style:{backgroundColor:"#92400e",color:"#fcd34d",padding:"2px 8px",borderRadius:"8px",fontSize:"9px"},children:"BAIRD FRAMEWORK"})]})}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"8px",marginBottom:"16px"},children:[{level:"LOW",count:g.low,color:"#22c55e",bg:"#166534"},{level:"MODERATE",count:g.moderate,color:"#eab308",bg:"#854d0e"},{level:"HIGH",count:g.high,color:"#f97316",bg:"#9a3412"},{level:"CRITICAL",count:g.critical,color:"#dc2626",bg:"#7f1d1d"}].map(c=>e.jsxs("div",{style:{backgroundColor:c.count>0?c.bg:"#0f172a",padding:"10px",borderRadius:"8px",textAlign:"center",border:`1px solid ${c.count>0?c.color:"#334155"}`},children:[e.jsx("div",{style:{fontSize:"20px",fontWeight:700,color:c.count>0?c.color:"#64748b"},children:c.count}),e.jsx("div",{style:{fontSize:"9px",color:c.count>0?"white":"#64748b",textTransform:"uppercase"},children:c.level})]},c.level))}),n.length>0&&e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:n.map(c=>{const r=yt(c);return e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"10px 12px",backgroundColor:"#0f172a",borderRadius:"8px",borderLeft:`4px solid ${r.color}`},children:e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx("span",{style:{fontFamily:"monospace",fontSize:"11px",color:"white"},children:c.caseId}),e.jsx("span",{style:{padding:"2px 8px",borderRadius:"4px",fontSize:"9px",fontWeight:700,backgroundColor:r.bgColor,color:r.color},children:r.level})]}),e.jsx("div",{style:{color:"#64748b",fontSize:"10px",marginTop:"4px"},children:r.scenario}),e.jsx("div",{style:{color:"#475569",fontSize:"9px",marginTop:"2px",fontFamily:"monospace"},children:r.logic})]})},c.caseId)})}),e.jsx("div",{style:{marginTop:"12px",fontSize:"9px",color:"#64748b",textAlign:"center"},children:"Based on Baird et al. 22-condition liability framework"})]})},Wn=({caseResults:t,sessionMedianPreAiMs:f,verifierPassed:n,ledgerIntact:g})=>{const c=Sn(t,f,n,g),r={HIGH:{color:"#ef4444",bg:"#7f1d1d"},MODERATE:{color:"#f59e0b",bg:"#92400e"},LOW:{color:"#22c55e",bg:"#166534"}};return e.jsxs("div",{style:{backgroundColor:"#1e293b",borderRadius:"12px",padding:"16px",marginTop:"16px",border:`2px solid ${r[c.overallRisk].color}`},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[e.jsxs("div",{style:{fontSize:"12px",color:"#dc2626",fontWeight:700,display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(Li,{size:14}),"CROSS-EXAMINATION VULNERABILITY ANALYSIS"]}),e.jsxs("div",{style:{padding:"4px 12px",borderRadius:"12px",fontSize:"10px",fontWeight:700,backgroundColor:r[c.overallRisk].bg,color:r[c.overallRisk].color},children:[c.overallRisk," RISK"]})]}),c.vulnerabilities.length>0&&e.jsxs("div",{style:{marginBottom:"16px"},children:[e.jsxs("div",{style:{fontSize:"10px",color:"#ef4444",fontWeight:600,marginBottom:"8px",display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx(je,{size:12}),"POTENTIAL ATTACK VECTORS"]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"6px"},children:c.vulnerabilities.map((o,i)=>e.jsxs("div",{style:{padding:"10px",backgroundColor:o.severity==="HIGH"?"#7f1d1d":"#0f172a",borderRadius:"6px",borderLeft:`3px solid ${o.severity==="HIGH"?"#ef4444":"#f59e0b"}`},children:[e.jsxs("div",{style:{color:"#fca5a5",fontSize:"11px"},children:['"',o.text,'"']}),o.metric&&e.jsx("div",{style:{color:"#64748b",fontSize:"9px",marginTop:"4px",fontFamily:"monospace"},children:o.metric})]},i))})]}),c.defenseStrengths.length>0&&e.jsxs("div",{children:[e.jsxs("div",{style:{fontSize:"10px",color:"#22c55e",fontWeight:600,marginBottom:"8px",display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx(De,{size:12}),"DEFENSIVE STRENGTHS"]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"6px"},children:c.defenseStrengths.map((o,i)=>e.jsxs("div",{style:{padding:"10px",backgroundColor:o.severity==="HIGH"?"#166534":"#0f172a",borderRadius:"6px",borderLeft:`3px solid ${o.severity==="HIGH"?"#22c55e":"#60a5fa"}`},children:[e.jsx("div",{style:{color:"#86efac",fontSize:"11px"},children:o.text}),o.metric&&e.jsx("div",{style:{color:"#64748b",fontSize:"9px",marginTop:"4px",fontFamily:"monospace"},children:o.metric})]},i))})]}),e.jsxs("div",{style:{marginTop:"16px",padding:"10px",backgroundColor:"#1e3a5f",borderRadius:"8px",border:"1px solid #3b82f6"},children:[e.jsx("div",{style:{fontSize:"10px",color:"#93c5fd",fontWeight:600,marginBottom:"4px"},children:"RECOMMENDED FOCUS"}),e.jsx("div",{style:{color:"white",fontSize:"11px"},children:c.recommendedFocus})]})]})},Un=({ledger:t})=>{const f=Cn(t,4);return f.length===0?null:e.jsxs("div",{style:{backgroundColor:"#1e293b",borderRadius:"12px",padding:"16px",marginTop:"16px",border:"2px solid #3b82f6"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[e.jsxs("div",{style:{fontSize:"12px",color:"#3b82f6",fontWeight:700,display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(Pi,{size:14}),"TAMPER-EVIDENT AUDIT CHAIN"]}),e.jsx("div",{style:{padding:"4px 10px",borderRadius:"8px",fontSize:"9px",fontWeight:600,backgroundColor:"#166534",color:"#4ade80"},children:"VERIFIED"})]}),e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"4px",overflowX:"auto"},children:f.map((n,g)=>e.jsxs(mt.Fragment,{children:[e.jsxs("div",{style:{backgroundColor:"#0f172a",border:"2px solid #3b82f6",borderRadius:"8px",padding:"10px",minWidth:"140px",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"9px",color:"#60a5fa",fontWeight:600,marginBottom:"4px"},children:n.eventType.replace(/_/g," ")}),e.jsxs("div",{style:{fontFamily:"monospace",fontSize:"8px",color:"#22c55e",backgroundColor:"#0f2619",padding:"4px 6px",borderRadius:"4px",wordBreak:"break-all"},children:[n.hash.slice(0,12),"..."]}),n.prevHash&&e.jsxs("div",{style:{fontSize:"8px",color:"#64748b",marginTop:"4px"},children:["prev: ",n.prevHash.slice(0,8),"..."]})]}),g<f.length-1&&e.jsx("div",{style:{color:"#3b82f6",fontSize:"16px",fontWeight:"bold"},children:"→"})]},g))}),e.jsxs("div",{style:{marginTop:"12px",textAlign:"center",fontSize:"10px",color:"#64748b",fontStyle:"italic"},children:["Any modification breaks verification • ",t.length," events in chain"]})]})},Hn=({interactionCounts:t,roiDwellTimes:f,currentPreAiTimeMs:n,currentPostAiTimeMs:g,sessionMedianPreAiMs:c,caseResults:r,isLive:o})=>{const i=r.filter(l=>{var x;return!((x=l.caseId)!=null?x:"").includes("CALIB")}),u=i.reduce((l,x)=>{var h;return l+((h=x.totalTimeMs)!=null?h:0)},0),b=i.length>0?i.reduce((l,x)=>{var h,C;return l+((C=(h=x.preAiReadMs)!=null?h:x.timeToLockMs)!=null?C:0)},0)/i.length:0,a=c>0?n/c*100:100,y=a>=75?"NORMAL":a>=50?"MILD":"LOW",v=y==="NORMAL"?"#22c55e":y==="MILD"?"#f59e0b":"#ef4444",p=t.zooms+t.pans,m=i.length>0?p/i.length:p;return e.jsxs("div",{style:{backgroundColor:"#1e293b",borderRadius:"12px",padding:"16px",marginTop:"16px",border:"2px solid #06b6d4"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[e.jsxs("div",{style:{fontSize:"12px",color:"#06b6d4",fontWeight:700,display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(ut,{size:14}),"READER BEHAVIOR METRICS",e.jsx("span",{style:{backgroundColor:"#164e63",color:"#22d3ee",padding:"2px 8px",borderRadius:"8px",fontSize:"9px"},children:"WATCHING THE WATCHER"})]}),o&&e.jsx("div",{style:{padding:"4px 10px",borderRadius:"8px",fontSize:"9px",fontWeight:600,backgroundColor:"#166534",color:"#4ade80",animation:"pulse 2s infinite"},children:"LIVE"})]}),e.jsxs("div",{style:{backgroundColor:"#0f172a",padding:"12px",borderRadius:"8px",marginBottom:"12px",border:`1px solid ${v}`},children:[e.jsx("div",{style:{fontSize:"10px",color:"#64748b",marginBottom:"8px",fontWeight:600},children:"TIME CONTEXT (Current Case)"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"12px"},children:[e.jsxs("div",{style:{textAlign:"center"},children:[e.jsxs("div",{style:{color:"#06b6d4",fontSize:"18px",fontWeight:700},children:[(n/1e3).toFixed(1),"s"]}),e.jsx("div",{style:{color:"#64748b",fontSize:"9px"},children:"Pre-AI Time"})]}),e.jsxs("div",{style:{textAlign:"center"},children:[e.jsxs("div",{style:{color:"#94a3b8",fontSize:"18px",fontWeight:700},children:[(c/1e3).toFixed(1),"s"]}),e.jsx("div",{style:{color:"#64748b",fontSize:"9px"},children:"Session Median"})]}),e.jsxs("div",{style:{textAlign:"center"},children:[e.jsxs("div",{style:{color:v,fontSize:"18px",fontWeight:700},children:[Math.round(a),"%"]}),e.jsx("div",{style:{color:"#64748b",fontSize:"9px"},children:"Comparison"})]})]}),e.jsx("div",{style:{marginTop:"8px",textAlign:"center",fontSize:"10px",color:v,fontWeight:600},children:y==="NORMAL"?"Within Normal Limits":y==="MILD"?"Mildly Below Median":"Below Threshold"})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"8px",marginBottom:"12px"},children:[e.jsx("div",{style:{backgroundColor:"#0f172a",padding:"10px",borderRadius:"8px",textAlign:"center"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:"16px"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{color:"#60a5fa",fontSize:"16px",fontWeight:700},children:t.zooms}),e.jsx("div",{style:{color:"#64748b",fontSize:"9px"},children:"Zooms"})]}),e.jsxs("div",{children:[e.jsx("div",{style:{color:"#f59e0b",fontSize:"16px",fontWeight:700},children:t.pans}),e.jsx("div",{style:{color:"#64748b",fontSize:"9px"},children:"Pans"})]})]})}),e.jsxs("div",{style:{backgroundColor:"#0f172a",padding:"10px",borderRadius:"8px",textAlign:"center"},children:[e.jsx("div",{style:{color:"#a855f7",fontSize:"16px",fontWeight:700},children:m.toFixed(1)}),e.jsx("div",{style:{color:"#64748b",fontSize:"9px"},children:"Interactions/Case"})]})]}),i.length>0&&e.jsxs("div",{style:{backgroundColor:"#0f172a",padding:"10px",borderRadius:"8px",fontSize:"10px"},children:[e.jsx("div",{style:{color:"#64748b",fontWeight:600,marginBottom:"6px"},children:"SESSION SUMMARY"}),e.jsxs("div",{style:{color:"#94a3b8"},children:["Total viewing time: ",e.jsxs("span",{style:{color:"white"},children:[Math.floor(u/6e4),"m ",Math.round(u%6e4/1e3),"s"]})," across ",i.length," cases"]}),e.jsxs("div",{style:{color:"#94a3b8",marginTop:"4px"},children:["Average pre-AI review: ",e.jsxs("span",{style:{color:"white"},children:[(b/1e3).toFixed(1),"s"]})," (median: ",(c/1e3).toFixed(1),"s)"]})]}),e.jsxs("div",{style:{marginTop:"12px",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",padding:"8px",backgroundColor:"#164e63",borderRadius:"8px"},children:[e.jsx(ut,{size:14,color:"#22d3ee"}),e.jsx("span",{style:{color:"#22d3ee",fontSize:"10px",fontWeight:600},children:"Eye Tracking: Ready for Integration"}),e.jsx("div",{style:{backgroundColor:"#0f172a",padding:"2px 6px",borderRadius:"4px",fontSize:"8px",color:"#64748b"},children:"WebGazer/Tobii"})]})]})},Vn=({condition:t,disclosurePolicy:f,onDisclosurePolicyChange:n,caseQueue:g,isInterventionMode:c,onInterventionModeChange:r})=>{var o;return t?e.jsxs("div",{style:{backgroundColor:"#1e293b",borderRadius:"12px",padding:"16px",marginTop:"16px",border:"2px solid #8b5cf6"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[e.jsxs("div",{style:{fontSize:"12px",color:"#8b5cf6",fontWeight:700,display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(Ze,{size:14}),"STUDY CONFIGURATION",e.jsx("span",{style:{backgroundColor:"#5b21b6",color:"#c4b5fd",padding:"2px 8px",borderRadius:"8px",fontSize:"9px"},children:"RESEARCH INSTRUMENT"})]}),e.jsx("div",{style:{padding:"4px 10px",borderRadius:"8px",fontSize:"9px",fontWeight:600,backgroundColor:"#166534",color:"#4ade80"},children:"ACTIVE"})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px"},children:[e.jsxs("div",{style:{backgroundColor:"#0f172a",padding:"12px",borderRadius:"8px"},children:[e.jsx("div",{style:{fontSize:"9px",color:"#64748b",marginBottom:"6px",fontWeight:600},children:"DISCLOSURE CONDITION"}),e.jsx("div",{style:{padding:"8px",backgroundColor:"#334155",borderRadius:"6px",color:"white",fontSize:"12px",fontWeight:600},children:t.disclosureFormat==="FDR_FOR"?"FDR + FOR":t.disclosureFormat==="NATURAL_FREQUENCY"?"Natural Frequency":"None"})]}),e.jsxs("div",{style:{backgroundColor:"#0f172a",padding:"12px",borderRadius:"8px"},children:[e.jsx("div",{style:{fontSize:"9px",color:"#64748b",marginBottom:"6px",fontWeight:600},children:"RANDOMIZATION SEED"}),e.jsx("code",{style:{display:"block",padding:"8px",backgroundColor:"#334155",borderRadius:"6px",color:"#fbbf24",fontSize:"10px",fontFamily:"monospace"},children:t.seed})]}),e.jsxs("div",{style:{backgroundColor:"#0f172a",padding:"12px",borderRadius:"8px"},children:[e.jsx("div",{style:{fontSize:"9px",color:"#64748b",marginBottom:"6px",fontWeight:600},children:"CASE ORDER"}),e.jsx("div",{style:{padding:"8px",backgroundColor:"#334155",borderRadius:"6px",color:"white",fontSize:"12px",fontWeight:600},children:t.assignmentMethod==="SEEDED_RANDOM"?"Randomized":"Fixed"})]}),e.jsxs("div",{style:{backgroundColor:"#0f172a",padding:"12px",borderRadius:"8px"},children:[e.jsx("div",{style:{fontSize:"9px",color:"#64748b",marginBottom:"6px",fontWeight:600},children:"COMPREHENSION CHECK"}),e.jsx("div",{style:{padding:"8px",backgroundColor:"#334155",borderRadius:"6px",color:"#22c55e",fontSize:"12px",fontWeight:600},children:"Required"})]})]}),e.jsx("div",{style:{marginTop:"16px",padding:"12px",backgroundColor:"#0f172a",borderRadius:"8px",border:c?"2px solid #8b5cf6":"1px solid #334155"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{color:"white",fontSize:"12px",fontWeight:600},children:"Intervention Mode"}),e.jsx("div",{style:{color:"#64748b",fontSize:"10px",marginTop:"2px"},children:c?"Explanatory text shown to participants":"Research instrumentation hidden from participants"})]}),e.jsx("button",{onClick:()=>r(!c),style:{padding:"8px 16px",backgroundColor:c?"#8b5cf6":"#334155",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"11px",fontWeight:600},children:c?"ON":"OFF"})]})}),e.jsxs("div",{style:{marginTop:"12px",padding:"10px",backgroundColor:"#166534",borderRadius:"8px",textAlign:"center",fontSize:"11px",color:"#86efac",fontWeight:600},children:["Study Mode: Active | Condition: ",t.disclosureFormat," | Cases: ",(o=g==null?void 0:g.cases.length)!=null?o:0]})]}):null},Gn=({caseResults:t,eventCount:f,verifierResult:n})=>{const g=t.filter(r=>{var o;return!((o=r.caseId)!=null?o:"").includes("CALIB")});return e.jsxs("div",{style:{backgroundColor:"#1e293b",borderRadius:"12px",padding:"16px",marginTop:"16px",border:"1px solid #334155"},children:[e.jsxs("div",{style:{fontSize:"12px",color:"#22c55e",fontWeight:700,marginBottom:"16px",display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(kt,{size:14}),"EXPORT PREVIEW"]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"10px",backgroundColor:"#0f172a",borderRadius:"6px"},children:[e.jsx("span",{style:{color:"#94a3b8",fontSize:"11px"},children:"Metrics per case"}),e.jsxs("span",{style:{color:"white",fontWeight:600,fontSize:"12px"},children:[28," including time ratios"]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"10px",backgroundColor:"#0f172a",borderRadius:"6px"},children:[e.jsx("span",{style:{color:"#94a3b8",fontSize:"11px"},children:"Events in hash chain"}),e.jsx("span",{style:{color:"white",fontWeight:600,fontSize:"12px"},children:f})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"10px",backgroundColor:"#0f172a",borderRadius:"6px"},children:[e.jsx("span",{style:{color:"#94a3b8",fontSize:"11px"},children:"Verification"}),e.jsx("span",{style:{color:n==="PASS"?"#22c55e":n==="FAIL"?"#ef4444":"#64748b",fontWeight:600,fontSize:"12px"},children:n!=null?n:"Pending"})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"10px",backgroundColor:"#0f172a",borderRadius:"6px"},children:[e.jsx("span",{style:{color:"#94a3b8",fontSize:"11px"},children:"Cases completed"}),e.jsx("span",{style:{color:"white",fontWeight:600,fontSize:"12px"},children:g.length})]})]}),e.jsx("div",{style:{marginTop:"12px",padding:"10px",backgroundColor:"#166534",borderRadius:"8px",textAlign:"center",fontSize:"10px",color:"#86efac",fontWeight:600},children:"Analysis-ready data export • CSV + JSON + Verification report"})]})},$n=()=>e.jsxs("div",{style:{backgroundColor:"#1e3a5f",borderRadius:"8px",padding:"12px",marginTop:"12px",border:"1px solid #3b82f6"},children:[e.jsxs("div",{style:{fontSize:"10px",color:"#93c5fd",fontWeight:600,marginBottom:"6px",display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx(pt,{size:12}),"CONTEXT NOTE"]}),e.jsx("p",{style:{color:"#e0f2fe",fontSize:"10px",lineHeight:"1.5",margin:0},children:"Published research indicates radiologist miss rates of 3-4% are typical even with optimal effort (Wolf et al.). This platform documents the decision process to demonstrate reasonableness, not to guarantee error-free performance."})]}),Yn=()=>{var Dt,zt,Ot,Nt,Mt,Bt,Lt,Pt,Ft,Wt,Ut,Ht,Vt,Gt,$t,Yt,Kt,Zt,qt,Xt,Qt,Jt,ei,ti,ii,ni,si,ri,oi,ai,li,di,ci,pi,ui,hi,fi,xi,gi,mi,yi,bi,vi,Si;const[t,f]=J.useState({sessionId:`SES-${Date.now().toString(36)}-${Math.random().toString(36).slice(2,6)}`,step:"SETUP",condition:null,caseQueue:null,currentCase:null,initialBirads:null,initialConfidence:70,preTrust:50,finalBirads:null,finalConfidence:70,postTrust:50,deviationRationale:"",comprehensionAnswer:null,comprehensionCorrect:null,calibrationBirads:null,calibrationConfidence:70,startTime:new Date,caseStartTime:null,lockTime:null,aiRevealTime:null,interactionCounts:{zooms:0,pans:0},roiDwellTimes:new Map,caseResults:[],exportReady:!1,exportUrl:null,exportFilename:null,exportManifest:null,exportManifestEntries:null,verifierOutput:null,verifierResult:null,eventCount:0}),[n,g]=J.useState(!1),[c,r]=J.useState(0),[o,i]=J.useState(!1),[u,b]=J.useState(!1),[a,y]=J.useState(!1),[v,p]=J.useState(null),[m,l]=J.useState(50),[x,h]=J.useState(50),[C,E]=J.useState(!1),[D,j]=J.useState(!1),[_,N]=J.useState("RESEARCHER"),H=_==="CLINICIAN",T=_==="RESEARCHER",[G,ne]=J.useState(!1),[A,W]=J.useState(!1),[d,w]=J.useState(0),[Q,Y]=J.useState("STATIC"),[le,Z]=J.useState(0),[ie,L]=J.useState(0),[B,re]=J.useState(0),[te,q]=J.useState(!1),[de,be]=J.useState("MAMMO_CC_ONLY"),[ue,he]=J.useState(null),[Se,ge]=J.useState(!1),[Ie,Ae]=J.useState(null),[s,V]=J.useState(!1),[U,I]=J.useState(!1),[S,k]=J.useState(!1),F=J.useRef(null),O=J.useRef(null),M=J.useRef(0),z="evidify_session_recovery";J.useEffect(()=>{var R;try{const P=localStorage.getItem(z);if(P){const K=JSON.parse(P);(Date.now()-new Date(K.lastUpdated).getTime())/(1e3*60*60)<24&&K.step!=="SETUP"&&K.step!=="STUDY_COMPLETE"?(he({sessionId:K.sessionId,step:K.step,completedCases:((R=K.caseResults)==null?void 0:R.length)||0,lastUpdated:K.lastUpdated}),ge(!0)):localStorage.removeItem(z)}}catch(P){console.warn("Failed to check for recoverable session:",P)}},[]),J.useEffect(()=>{if(t.step==="SETUP"||t.step==="STUDY_COMPLETE")return;const R=()=>{try{const K={sessionId:t.sessionId,step:t.step,condition:t.condition,caseQueue:t.caseQueue,currentCase:t.currentCase,initialBirads:t.initialBirads,initialConfidence:t.initialConfidence,caseResults:t.caseResults,eventCount:t.eventCount,lastUpdated:new Date().toISOString()};localStorage.setItem(z,JSON.stringify(K))}catch(K){console.warn("Failed to save session:",K)}};R();const P=setInterval(R,3e4);return()=>clearInterval(P)},[t.step,t.caseResults.length,(Dt=t.currentCase)==null?void 0:Dt.caseId]),J.useEffect(()=>{t.step==="STUDY_COMPLETE"&&localStorage.removeItem(z)},[t.step]);const ee=()=>{var R,P;try{const K=localStorage.getItem(z);if(K){const se=JSON.parse(K);f(fe=>({...fe,...se,startTime:new Date(se.lastUpdated)})),ge(!1),(P=O.current)==null||P.addEvent("SESSION_RESUMED",{originalSessionId:se.sessionId,resumedAt:new Date().toISOString(),completedCases:((R=se.caseResults)==null?void 0:R.length)||0,resumedAtStep:se.step})}}catch(K){console.error("Failed to recover session:",K),alert("Failed to recover session")}},$=()=>{localStorage.removeItem(z),ge(!1),he(null)};J.useEffect(()=>{var R;t.step==="INITIAL"&&t.initialBirads!==null&&Ie!==null&&Ie!==t.initialBirads&&((R=O.current)==null||R.addEvent("ANSWER_EDITED",{field:"initialBirads",previousValue:Ie,newValue:t.initialBirads,editedBeforeLock:!0,timestamp:new Date().toISOString()})),Ae(t.initialBirads)},[t.initialBirads,t.step]),J.useEffect(()=>{const R=P=>{var K,se,fe,Re,Te,Ee;if(!(P.target instanceof HTMLInputElement||P.target instanceof HTMLTextAreaElement)){if(P.key==="?"||P.key==="/"&&P.shiftKey){P.preventDefault(),q(pe=>!pe);return}if(P.key==="Escape"){q(!1),E(!1),j(!1),ne(!1);return}if(!(t.step!=="INITIAL"&&t.step!=="AI_REVEALED"&&t.step!=="CALIBRATION")){if((K=O.current)==null||K.addEvent("KEYBOARD_SHORTCUT",{key:P.key,step:t.step,timestamp:Date.now()}),(t.step==="INITIAL"||t.step==="CALIBRATION")&&t.initialBirads===null){const pe={0:0,1:1,2:2,3:3,4:4,5:5};if(P.key in pe){P.preventDefault(),t.step==="CALIBRATION"?f(we=>({...we,calibrationBirads:pe[P.key]})):f(we=>({...we,initialBirads:pe[P.key]}));return}}if(t.step==="AI_REVEALED"){const pe={0:0,1:1,2:2,3:3,4:4,5:5};if(P.key in pe){P.preventDefault(),f(we=>({...we,finalBirads:pe[P.key]}));return}}if(P.key===" "&&t.step==="INITIAL"&&t.initialBirads!==null){P.preventDefault(),(se=document.getElementById("lock-impression-btn"))==null||se.click();return}if(P.key===" "&&t.step==="CALIBRATION"&&t.calibrationBirads!==null){P.preventDefault(),(fe=document.getElementById("calibration-submit-btn"))==null||fe.click();return}if(P.key==="Enter"&&t.step==="AI_REVEALED"&&t.finalBirads!==null){P.preventDefault(),(Re=document.getElementById("submit-final-btn"))==null||Re.click();return}if(P.key.toLowerCase()==="a"&&t.step==="AI_REVEALED"){P.preventDefault();return}if(P.key.toLowerCase()==="r"){P.preventDefault(),f(pe=>({...pe,interactionCounts:{zooms:0,pans:0}})),(Ee=O.current)==null||Ee.addEvent("VIEWPORT_RESET",{caseId:(Te=t.currentCase)==null?void 0:Te.caseId,triggeredBy:"keyboard",timestamp:new Date().toISOString()});return}if(P.key==="+"||P.key==="="){P.preventDefault(),t.step==="INITIAL"?f(pe=>({...pe,initialConfidence:Math.min(100,pe.initialConfidence+10)})):t.step==="CALIBRATION"?f(pe=>({...pe,calibrationConfidence:Math.min(100,pe.calibrationConfidence+10)})):t.step==="AI_REVEALED"&&f(pe=>({...pe,finalConfidence:Math.min(100,pe.finalConfidence+10)}));return}if(P.key==="-"||P.key==="_"){P.preventDefault(),t.step==="INITIAL"?f(pe=>({...pe,initialConfidence:Math.max(0,pe.initialConfidence-10)})):t.step==="CALIBRATION"?f(pe=>({...pe,calibrationConfidence:Math.max(0,pe.calibrationConfidence-10)})):t.step==="AI_REVEALED"&&f(pe=>({...pe,finalConfidence:Math.max(0,pe.finalConfidence-10)}));return}}}};return window.addEventListener("keydown",R),()=>window.removeEventListener("keydown",R)},[t.step,t.initialBirads,t.finalBirads,t.calibrationBirads]),J.useEffect(()=>{if(t.caseStartTime&&!["COMPLETE","TLX","STUDY_COMPLETE","SETUP","CALIBRATION_FEEDBACK"].includes(t.step)){const R=setInterval(()=>{r((Date.now()-t.caseStartTime.getTime())/1e3)},100);return()=>clearInterval(R)}},[t.caseStartTime,t.step]);const X=J.useMemo(()=>t.caseQueue?pn(t.caseQueue):null,[t.caseQueue]),oe=J.useMemo(()=>{const P=t.caseResults.filter(K=>{var se;return!((se=K.caseId)!=null?se:"").includes("CALIB")}).map(K=>{var se,fe;return(fe=(se=K.preAiReadMs)!=null?se:K.timeToLockMs)!=null?fe:0}).filter(K=>K>0).sort((K,se)=>K-se);return P.length===0?3e4:P[Math.floor(P.length/2)]},[t.caseResults]),ce=J.useRef(null);J.useEffect(()=>{var Re,Te,Ee,pe,we,ve,Be,Ve,Ge,$e,Ye,ke,Pe;const R=(Te=(Re=t.currentCase)==null?void 0:Re.caseId)!=null?Te:null;if(!O.current||!R||ce.current===R)return;ce.current=R;const P=(pe=(Ee=t.currentCase)==null?void 0:Ee.isCalibration)!=null?pe:!1,K=(ve=(we=t.currentCase)==null?void 0:we.isAttentionCheck)!=null?ve:!1,se=(Ve=(Be=t.caseQueue)==null?void 0:Be.currentIndex)!=null?Ve:0,fe=($e=(Ge=t.caseQueue)==null?void 0:Ge.cases.length)!=null?$e:1;O.current.logCaseLoaded({caseId:R,caseIndex:se,totalCases:fe,isCalibration:P,isAttentionCheck:K,metadata:{patientAge:(Ye=t.currentCase)==null?void 0:Ye.patientAge,breastDensity:(ke=t.currentCase)==null?void 0:ke.breastDensity,indication:(Pe=t.currentCase)==null?void 0:Pe.indication}})},[(zt=t.currentCase)==null?void 0:zt.caseId,(Ot=t.caseQueue)==null?void 0:Ot.currentIndex,(Nt=t.caseQueue)==null?void 0:Nt.cases.length]);const ae=J.useMemo(()=>t.caseQueue?it(t.caseQueue):null,[t.caseQueue]),_e=(Lt=(Bt=(Mt=ae==null?void 0:ae.aiResult)==null?void 0:Mt.birads)!=null?Bt:ae==null?void 0:ae.aiBirads)!=null?Lt:4,xe=(Wt=(Ft=(Pt=ae==null?void 0:ae.aiResult)==null?void 0:Pt.confidence)!=null?Ft:ae==null?void 0:ae.aiConfidence)!=null?Wt:.87,ze=J.useCallback(async R=>{M.current=Date.now(),O.current&&ae&&(await O.current.addEvent("GAZE_ENTERED_ROI",{roiId:R,caseId:ae.caseId}),f(P=>{var K;return{...P,eventCount:((K=F.current)==null?void 0:K.getEvents().length)||0}}))},[ae]),me=J.useCallback(async R=>{if(M.current>0){const P=Date.now()-M.current;f(K=>{const se=new Map(K.roiDwellTimes);return se.set(R,(se.get(R)||0)+P),{...K,roiDwellTimes:se}}),O.current&&t.currentCase&&P>100&&(await O.current.addEvent("DWELL_TIME_ROI",{roiId:R,dwellMs:P,caseId:t.currentCase.caseId}),f(K=>{var se;return{...K,eventCount:((se=F.current)==null?void 0:se.getEvents().length)||0}}))}M.current=0},[t.currentCase]),Oe=J.useCallback(async R=>{var P;f(K=>({...K,interactionCounts:{zooms:R==="zoom"?K.interactionCounts.zooms+1:K.interactionCounts.zooms,pans:R==="pan"?K.interactionCounts.pans+1:K.interactionCounts.pans}})),O.current&&(await O.current.addEvent("IMAGE_VIEWED",{interactionType:R,caseId:(P=t.currentCase)==null?void 0:P.caseId}),f(K=>{var se;return{...K,eventCount:((se=F.current)==null?void 0:se.getEvents().length)||0}}))},[t.currentCase]),Ne=J.useCallback(async R=>{var we;const P=on(),K=R?ln(R,"FDR_FOR"):await an(P,0),se=dn({includeCalibration:!0,includeAttentionChecks:!1,casesPerSession:3,randomizeOrder:!1,seed:P}),fe=it(se),Re=new wt({sessionId:t.sessionId,participantId:"DEMO-PARTICIPANT",studyId:"BRPLL-DEMO",protocolVersion:"BRPLL-MAMMO-v1.0",siteId:"DEMO",condition:{revealTiming:K.condition,disclosureFormat:K.disclosureFormat,seed:K.seed,assignmentMethod:K.assignmentMethod},caseQueue:{queueId:`Q-${Date.now().toString(36)}`,totalCases:se.cases.length,completedCases:0,caseIds:se.cases.map(ve=>ve.caseId)}}),Te=new rn(Re);F.current=Re,O.current=Te,await Te.logSessionStarted({participantId:"DEMO-PARTICIPANT",siteId:"DEMO",studyId:"BRPLL-DEMO",protocolVersion:"BRPLL-MAMMO-v1.0",browserInfo:{userAgent:navigator.userAgent,screenWidth:window.screen.width,screenHeight:window.screen.height,pixelRatio:(we=window.devicePixelRatio)!=null?we:1}}),await O.current.addEvent("EYE_TRACKER_STATUS",{device:"MOUSE_PROXY",status:"ACTIVE",calibrationValid:!0,supportedEvents:["GAZE_ENTERED_ROI","DWELL_TIME_ROI","ATTENTION_COVERAGE_PROXY"],note:"Using mouse hover as gaze proxy. Ready for WebGazer/Tobii integration."}),await O.current.logRandomizationAssigned({seed:K.seed,condition:K.condition,disclosureFormat:K.disclosureFormat,assignmentMethod:K.assignmentMethod,conditionMatrixHash:K.conditionMatrixHash});const Ee=(()=>{if(!K.seed||K.seed==="MANUAL_OVERRIDE")return 1;const ve=parseInt(K.seed.slice(-4),16);return isNaN(ve)?1:ve%4+1})(),pe=K.seed?parseInt(K.seed.slice(-2),16)%2===0?"FORWARD":"REVERSE":"FORWARD";await O.current.addEvent("COUNTERBALANCING_ASSIGNED",{scheme:"LATIN_SQUARE_4x4",arm:`ARM-${Ee}`,caseOrderVariant:pe,caseOrder:se.cases.map(ve=>ve.caseId),calibrationCases:se.cases.filter(ve=>ve.isCalibration).map(ve=>ve.caseId),studyCases:se.cases.filter(ve=>!ve.isCalibration).map(ve=>ve.caseId)}),fe&&(fe.isCalibration||await O.current.logReadEpisodeStarted(fe.caseId,"PRE_AI")),f(ve=>{var Be;return{...ve,condition:K,caseQueue:se,currentCase:fe,caseStartTime:new Date,step:fe!=null&&fe.isCalibration?"CALIBRATION":"INITIAL",eventCount:((Be=F.current)==null?void 0:Be.getEvents().length)||0,roiDwellTimes:new Map,interactionCounts:{zooms:0,pans:0}}}),r(0),b(!0)},[t.sessionId]),Me=J.useCallback(async()=>{var R,P;!O.current||t.calibrationBirads===null||!t.currentCase||(await O.current.addEvent("CALIBRATION_RESPONSE",{caseId:t.currentCase.caseId,selectedBirads:t.calibrationBirads,confidence:t.calibrationConfidence,groundTruthBirads:(P=(R=t.currentCase.groundTruth)==null?void 0:R.birads)!=null?P:null}),f(K=>{var se;return{...K,step:"CALIBRATION_FEEDBACK",eventCount:((se=F.current)==null?void 0:se.getEvents().length)||0}}))},[t.calibrationBirads,t.calibrationConfidence,t.currentCase]),qe=J.useCallback(async()=>{var K,se,fe,Re,Te,Ee,pe,we;if(!t.caseQueue||!O.current)return;await O.current.addEvent("CALIBRATION_FEEDBACK_SHOWN",{caseId:(K=t.currentCase)==null?void 0:K.caseId,userBirads:t.calibrationBirads,groundTruthBirads:(Re=(fe=(se=t.currentCase)==null?void 0:se.groundTruth)==null?void 0:fe.birads)!=null?Re:null}),await O.current.addEvent("GROUND_TRUTH_REVEALED",{caseId:(Te=t.currentCase)==null?void 0:Te.caseId,groundTruthBirads:(we=(pe=(Ee=t.currentCase)==null?void 0:Ee.groundTruth)==null?void 0:pe.birads)!=null?we:null,context:"CALIBRATION_MODE_ONLY",note:"Ground truth only shown in calibration trials, never in study trials"});const R=_i(t.caseQueue),P=it(R);P&&(P.isCalibration||await O.current.logReadEpisodeStarted(P.caseId,"PRE_AI")),f(ve=>{var Be;return{...ve,caseQueue:R,currentCase:P,step:"INITIAL",calibrationBirads:null,calibrationConfidence:70,caseStartTime:new Date,eventCount:((Be=F.current)==null?void 0:Be.getEvents().length)||0,roiDwellTimes:new Map,interactionCounts:{zooms:0,pans:0}}}),r(0)},[t.caseQueue,t.currentCase,t.calibrationBirads]),Je=J.useCallback(async()=>{var Te,Ee,pe,we,ve,Be,Ve,Ge,$e,Ye,ke,Pe,Ci,Ii,Ai;if(!O.current||!t.currentCase||t.initialBirads===null)return;const R=new Date;await O.current.logFirstImpressionLocked((Te=t.initialBirads)!=null?Te:0,(Ee=t.initialConfidence)!=null?Ee:0),await O.current.addEvent("FIRST_IMPRESSION_CONTEXT",{sessionId:t.sessionId,caseId:t.currentCase.caseId,condition:t.condition,birads:(pe=t.initialBirads)!=null?pe:0,confidence:(we=t.initialConfidence)!=null?we:0,interactionCounts:t.interactionCounts,preTrust:t.preTrust,lockTimestamp:R.toISOString()});const P=new Date,K=($e=(Ge=(Be=(ve=t.currentCase)==null?void 0:ve.aiResult)==null?void 0:Be.birads)!=null?Ge:(Ve=t.currentCase)==null?void 0:Ve.aiBirads)!=null?$e:4,se=(Ii=(Ci=(ke=(Ye=t.currentCase)==null?void 0:Ye.aiResult)==null?void 0:ke.confidence)!=null?Ci:(Pe=t.currentCase)==null?void 0:Pe.aiConfidence)!=null?Ii:.87;await O.current.logAIRevealed({suggestedBirads:K,aiConfidence:se,finding:(Ai=t.currentCase.finding)!=null?Ai:"N/A",displayMode:"PANEL"}),t.currentCase.isCalibration||(await O.current.logReadEpisodeEnded(t.currentCase.caseId,"PRE_AI","AI_REVEALED"),await O.current.logReadEpisodeStarted(t.currentCase.caseId,"POST_AI"));const fe=t.caseQueue?["EASY","MEDIUM","HARD"][t.caseQueue.currentIndex%3]:"MEDIUM",Re=Q==="STATIC"?"STANDARD":fe==="EASY"?"MINIMAL":fe==="MEDIUM"?"STANDARD":"FULL_DEBIAS";await O.current.logDisclosurePresented({format:"FDR_FOR",fdrValue:4,forValue:12}),await O.current.addEvent("ADAPTIVE_DISCLOSURE_DECISION",{policy:Q,caseDifficulty:fe,disclosureIntensity:Re,showFdrFor:Q==="STATIC"||fe!=="EASY",showDebiasPrompt:Q==="ADAPTIVE"&&fe==="HARD"}),f(St=>{var ji;return{...St,step:"AI_REVEALED",lockTime:R,aiRevealTime:P,finalBirads:St.initialBirads,finalConfidence:St.initialConfidence,eventCount:((ji=F.current)==null?void 0:ji.getEvents().length)||0}})},[t.sessionId,t.currentCase,t.initialBirads,t.initialConfidence,t.preTrust,t.condition,t.caseStartTime,t.interactionCounts,t.caseQueue,Q]),et=J.useCallback(async R=>{const P=R==="missed_cancer";if(O.current&&t.currentCase){const K=t.aiRevealTime?Date.now()-t.aiRevealTime.getTime():null;await O.current.logComprehensionResponse({caseId:t.currentCase.caseId,itemId:"FDR_FOR_COMPREHENSION",questionId:"FDR_FOR_COMPREHENSION",selectedAnswer:R,correctAnswer:"missed_cancer",isCorrect:P,responseTimeMs:K,phase:"POST_AI"})}f(K=>{var se;return{...K,comprehensionAnswer:R,comprehensionCorrect:P,eventCount:((se=F.current)==null?void 0:se.getEvents().length)||0}})},[t.aiRevealTime,t.currentCase]),ye=J.useCallback(async(R=!1)=>{var Ee,pe,we,ve,Be,Ve,Ge,$e,Ye;if(!O.current||!t.currentCase)return;const P=t.finalBirads!==t.initialBirads;t.step==="DEVIATION"&&P&&(R?(await O.current.addEvent("DEVIATION_SKIPPED",{reason:"user_skipped"}),re(ke=>ke+1)):await O.current.addEvent("DEVIATION_SUBMITTED",{rationale:t.deviationRationale,initialBirads:t.initialBirads,finalBirads:t.finalBirads})),P&&L(ke=>ke+1);const K=((Ee=t.finalBirads)!=null?Ee:t.initialBirads)===_e;Z(K?ke=>ke+1:0),await O.current.logFinalAssessment(t.currentCase.caseId,(we=(pe=t.finalBirads)!=null?pe:t.initialBirads)!=null?we:0,t.finalConfidence,(ve=t.initialBirads)!=null?ve:0,_e),t.currentCase.isCalibration||await O.current.logReadEpisodeEnded(t.currentCase.caseId,"POST_AI","FINAL_ASSESSMENT"),await O.current.addEvent("ATTENTION_COVERAGE_PROXY",{roiDwellTimes:Object.fromEntries(t.roiDwellTimes),totalDwellMs:Array.from(t.roiDwellTimes.values()).reduce((ke,Pe)=>ke+Pe,0)}),await O.current.addEvent("TRUST_CALIBRATION",{preTrust:t.preTrust,postTrust:t.postTrust,trustDelta:t.postTrust-t.preTrust,caseId:t.currentCase.caseId});const se=Array.from(t.roiDwellTimes.values()).reduce((ke,Pe)=>ke+Pe,0),fe=t.roiDwellTimes.get("ai_box")||0;await O.current.addEvent("RISK_METER_SNAPSHOT",{caseId:t.currentCase.caseId,timeToLockMs:t.lockTime&&t.caseStartTime?t.lockTime.getTime()-t.caseStartTime.getTime():0,aiAgreementStreak:K?le+1:0,deviationsSkipped:B+(R?1:0),totalDeviationsRequired:ie+(P?1:0),aiDwellRatio:se>0?fe/se:0,agreedWithAI:K}),await O.current.addEvent("CASE_COMPLETED",{caseId:t.currentCase.caseId});const Re=(Ge=(Ve=(Be=t.currentCase)==null?void 0:Be.caseId)!=null?Ve:ae==null?void 0:ae.caseId)!=null?Ge:"UNKNOWN_CASE",Te=En((Ye=($e=F.current)==null?void 0:$e.getEvents())!=null?Ye:[],Re,t.sessionId,t.condition);f(ke=>{var Pe;return{...ke,step:"COMPLETE",caseResults:[...ke.caseResults,Te],eventCount:((Pe=F.current)==null?void 0:Pe.getEvents().length)||0}})},[t,c,le,B,ie]),Fe=J.useCallback(async()=>{t.finalBirads!==t.initialBirads?(O.current&&await O.current.addEvent("DEVIATION_STARTED",{initialBirads:t.initialBirads,tentativeFinalBirads:t.finalBirads}),f(P=>{var K;return{...P,step:"DEVIATION",eventCount:((K=F.current)==null?void 0:K.getEvents().length)||0}})):H?await ye():V(!0)},[t.initialBirads,t.finalBirads,H,ye]),Le=J.useCallback(async(R=!1)=>{if(O.current&&(R?(await O.current.addEvent("DEVIATION_SKIPPED",{reason:"user_skipped"}),re(P=>P+1)):t.deviationRationale&&await O.current.addEvent("DEVIATION_SUBMITTED",{rationale:t.deviationRationale,initialBirads:t.initialBirads,finalBirads:t.finalBirads})),H){await ye(R);return}V(!0)},[t.deviationRationale,t.initialBirads,t.finalBirads,H,ye]),He=J.useCallback(async()=>{if(!t.caseQueue||!O.current)return;const R=_i(t.caseQueue);if(cn(R)){await O.current.logSessionEnded({reason:"completed",totalCases:t.caseResults.length}),f(K=>{var se;return{...K,step:"STUDY_COMPLETE",caseQueue:R,eventCount:((se=F.current)==null?void 0:se.getEvents().length)||0}});return}const P=it(R);P&&(P.isCalibration||await O.current.logReadEpisodeStarted(P.caseId,"PRE_AI")),f(K=>{var se;return{...K,caseQueue:R,currentCase:P,step:"INITIAL",initialBirads:null,initialConfidence:70,preTrust:50,finalBirads:null,finalConfidence:70,postTrust:50,deviationRationale:"",comprehensionAnswer:null,comprehensionCorrect:null,caseStartTime:new Date,lockTime:null,aiRevealTime:null,eventCount:((se=F.current)==null?void 0:se.getEvents().length)||0,roiDwellTimes:new Map,interactionCounts:{zooms:0,pans:0}}}),r(0)},[t.caseQueue,t.caseResults.length]),st=J.useCallback(async()=>{if(!F.current||!O.current)return;await O.current.addEvent("EXPORT_GENERATED",{casesCompleted:t.caseResults.length});const R=ki(F.current.getEvents(),t.condition,t.caseQueue,t.caseResults,Q,F.current.getStudyMetadata());F.current.setMethodsSnapshot(R);for(const Ee of t.caseResults)F.current.addCaseMetrics(Ee);const{blob:P,filename:K,verifierOutput:se,manifest:fe,exportManifestEntries:Re}=await F.current.generateZip(),Te=URL.createObjectURL(P);f(Ee=>{var pe;return{...Ee,exportReady:!0,exportUrl:Te,exportFilename:K,exportManifest:fe,exportManifestEntries:Re,verifierOutput:se,verifierResult:se.result,eventCount:((pe=F.current)==null?void 0:pe.getEvents().length)||0}}),y(!1),p(null)},[t.caseResults,t.condition,t.caseQueue,Q]),Ui=J.useCallback(()=>{const R=[{code:"CHAIN_BROKEN",message:"Hash chain integrity violated at event #47",detail:"Expected: 8f3a2b... Got: 0000000..."},{code:"CONTENT_TAMPERED",message:"Event payload modified after signing",detail:'Field "finalBirads" changed from 4 to 2'},{code:"TIMESTAMP_REGRESSION",message:"Non-monotonic timestamp detected",detail:"Event #52 predates event #51 by 3.2s"}],P=R[Math.floor(Math.random()*R.length)];y(!0),p(P.code),f(K=>({...K,verifierResult:"FAIL"}))},[]),Hi=J.useCallback(()=>{y(!1),p(null),f(R=>({...R,verifierResult:"PASS"}))},[]),Vi=J.useCallback(()=>{var Re;if(!t.currentCase||t.initialBirads===null)return null;const R=_e,P=(Re=t.finalBirads)!=null?Re:t.initialBirads,K=t.initialBirads!==R,se=P!==t.initialBirads,fe=se&&P===R;return{addaDenominator:K,changeOccurred:se,aiConsistentChange:fe,adda:K&&fe}},[t.currentCase,t.initialBirads,t.finalBirads]),Gi=t.step==="SETUP";return e.jsxs("div",{style:{minHeight:"100vh",backgroundColor:"#0f172a",padding:"20px",paddingBottom:"60px",fontFamily:"system-ui, sans-serif"},children:[t.condition&&T&&e.jsx(wn,{condition:t.condition,sessionId:t.sessionId,caseQueue:t.caseQueue,currentCaseId:((Ut=t.currentCase)==null?void 0:Ut.caseId)||null,isCollapsed:!u,onToggle:()=>b(!u),disclosurePolicy:Q,onDisclosurePolicyChange:async R=>{var P;Y(R),O.current&&(await O.current.addEvent("DISCLOSURE_POLICY_CHANGED",{policy:R,caseId:(P=t.currentCase)==null?void 0:P.caseId,timestamp:new Date().toISOString()}),f(K=>{var se;return{...K,eventCount:((se=F.current)==null?void 0:se.getEvents().length)||0}}))},currentCaseDifficulty:t.caseQueue&&t.currentCase?["EASY","MEDIUM","HARD"][t.caseQueue.currentIndex%3]:void 0}),e.jsxs("div",{style:{maxWidth:"1200px",margin:"0 auto",marginLeft:t.condition&&u&&T?"360px":"auto"},children:[Gi?e.jsxs("div",{style:{background:"linear-gradient(135deg, #1e40af 0%, #7c3aed 100%)",color:"white",padding:"32px",borderRadius:"16px 16px 0 0",textAlign:"center"},children:[e.jsx("h1",{style:{margin:0,fontSize:"28px"},children:"Evidify Research Study Launcher"}),e.jsx("p",{style:{margin:"8px 0 0",opacity:.9},children:"Start a participant session or open the researcher console for a guided walkthrough."})]}):e.jsxs("div",{style:{background:"linear-gradient(135deg, #1e40af 0%, #7c3aed 100%)",color:"white",padding:"24px",borderRadius:"16px 16px 0 0",display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"4px"},children:[e.jsx("h1",{style:{margin:0,fontSize:"26px"},children:H?"Clinician Review":"Researcher Console"}),T&&e.jsxs("div",{style:{padding:"4px 10px",borderRadius:"4px",fontSize:"10px",fontWeight:700,backgroundColor:"#a855f7",color:"white",letterSpacing:"1px",textTransform:"uppercase",border:"1px solid #c084fc",display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx(Ze,{size:12}),"OPERATOR VIEW"]}),t.step!=="SETUP"&&t.step!=="STUDY_COMPLETE"&&e.jsx("div",{style:{padding:"6px 14px",borderRadius:"20px",fontSize:"12px",fontWeight:700,backgroundColor:(Ht=t.currentCase)!=null&&Ht.isCalibration?"#f59e0b":"#22c55e",color:(Vt=t.currentCase)!=null&&Vt.isCalibration?"#78350f":"#052e16",border:`2px solid ${(Gt=t.currentCase)!=null&&Gt.isCalibration?"#fcd34d":"#4ade80"}`,animation:"pulse 2s infinite"},children:($t=t.currentCase)!=null&&$t.isCalibration?"CALIBRATION TRIAL • FEEDBACK ON":"STUDY TRIAL • NO FEEDBACK"})]}),e.jsx("p",{style:{margin:"4px 0 0",opacity:.9},children:"Human-First AI • FDR/FOR Disclosure • Tamper-Evident Audit"}),e.jsxs("div",{style:{marginTop:"12px",fontSize:"13px",opacity:.8},children:[e.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:"6px"},children:[e.jsx(at,{size:12}),t.sessionId]}),t.condition&&e.jsxs("span",{style:{marginLeft:"16px",display:"inline-flex",alignItems:"center",gap:"6px"},children:[e.jsx(bt,{size:12}),t.condition.condition]}),X&&e.jsxs("span",{style:{marginLeft:"16px",display:"inline-flex",alignItems:"center",gap:"6px"},children:[e.jsx(Ue,{size:12}),"Case ",X.current,"/",X.total]}),e.jsxs("span",{style:{marginLeft:"16px",display:"inline-flex",alignItems:"center",gap:"6px"},children:[e.jsx(Rt,{size:12}),c.toFixed(1),"s"]})]})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end",gap:"8px"},children:[T&&e.jsxs("div",{style:{backgroundColor:"rgba(255,255,255,0.15)",padding:"16px 24px",borderRadius:"12px",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"36px",fontWeight:"bold"},children:t.eventCount}),e.jsx("div",{style:{fontSize:"12px",opacity:.9},children:"Events Logged"})]}),T&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>W(!A),style:{padding:"8px 16px",backgroundColor:A?"rgba(148, 163, 184, 0.3)":"rgba(51, 65, 85, 0.4)",border:"1px solid rgba(148, 163, 184, 0.4)",borderRadius:"8px",color:"white",cursor:"pointer",fontSize:"11px",fontWeight:600,display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx(Ze,{size:12}),A?"Hide Advanced":"Advanced Panels"]}),e.jsxs("button",{onClick:()=>j(!0),style:{padding:"8px 16px",backgroundColor:"rgba(59, 130, 246, 0.3)",border:"1px solid rgba(147, 197, 253, 0.5)",borderRadius:"8px",color:"white",cursor:"pointer",fontSize:"11px",fontWeight:600,display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx(Ue,{size:12}),"Study Design"]}),e.jsxs("button",{onClick:()=>ne(!0),style:{padding:"8px 16px",backgroundColor:"rgba(34, 197, 94, 0.3)",border:"1px solid rgba(134, 239, 172, 0.5)",borderRadius:"8px",color:"white",cursor:"pointer",fontSize:"11px",fontWeight:600,display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx(gt,{size:12}),"Study Pack"]})]}),T&&e.jsxs("button",{onClick:()=>q(!0),style:{padding:"6px 12px",backgroundColor:"rgba(255,255,255,0.1)",border:"1px solid rgba(255,255,255,0.3)",borderRadius:"8px",color:"white",cursor:"pointer",fontSize:"11px",fontWeight:600,display:"flex",alignItems:"center",gap:"6px"},title:"Keyboard shortcuts (?)",children:[e.jsx(pt,{size:12}),"Shortcuts"]}),e.jsxs("div",{style:{display:"flex",backgroundColor:"rgba(0,0,0,0.3)",borderRadius:"8px",padding:"2px",border:"1px solid rgba(255,255,255,0.2)"},children:[e.jsxs("button",{onClick:()=>N("CLINICIAN"),style:{padding:"6px 12px",backgroundColor:H?"#3b82f6":"transparent",border:"none",borderRadius:"6px",color:"white",cursor:"pointer",fontSize:"10px",fontWeight:600,display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx(rt,{size:12}),"Clinician"]}),e.jsxs("button",{onClick:()=>N("RESEARCHER"),style:{padding:"6px 12px",backgroundColor:T?"#a855f7":"transparent",border:"none",borderRadius:"6px",color:"white",cursor:"pointer",fontSize:"10px",fontWeight:600,display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx(Ze,{size:12}),"Researcher"]})]})]})]}),t.step!=="SETUP"&&t.step!=="STUDY_COMPLETE"&&e.jsxs("div",{style:{backgroundColor:T?"#1a1a2e":"#1e3a5f",padding:"10px 24px",borderBottom:`1px solid ${T?"#a855f7":"#3b82f6"}`,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{style:{color:"#94a3b8",fontSize:"11px",display:"flex",alignItems:"center",gap:"6px"},children:[T?e.jsx(Ze,{size:12}):e.jsx(rt,{size:12}),T?"RESEARCHER VIEW: Instrumentation, event logging, and study controls are visible.":"CLINICIAN VIEW: Streamlined reading workflow with research instrumentation hidden."]}),e.jsx("div",{style:{fontSize:"10px",color:T?"#c084fc":"#60a5fa",fontWeight:600},children:T?"Press ? for keyboard shortcuts":"Clinician workflow view"})]}),e.jsxs("div",{style:{backgroundColor:"#1e293b",padding:"32px",borderRadius:"0 0 16px 16px"},children:[t.step==="SETUP"&&e.jsxs("div",{style:{textAlign:"center",padding:"32px",display:"flex",flexDirection:"column",gap:"24px",alignItems:"center"},children:[e.jsxs("div",{style:{display:"flex",gap:"16px",flexWrap:"wrap",justifyContent:"center"},children:[e.jsxs("button",{onClick:()=>{N("CLINICIAN"),Ne()},style:{padding:"20px 28px",backgroundColor:"#3b82f6",color:"white",border:"2px solid #60a5fa",borderRadius:"12px",cursor:"pointer",minWidth:"220px",fontSize:"16px",fontWeight:700},children:[e.jsx(rt,{size:16}),"Run Participant Session"]}),e.jsxs("button",{onClick:()=>{N("RESEARCHER"),Ne()},style:{padding:"20px 28px",backgroundColor:"#7c3aed",color:"white",border:"2px solid #a78bfa",borderRadius:"12px",cursor:"pointer",minWidth:"220px",fontSize:"16px",fontWeight:700},children:[e.jsx(Ze,{size:16}),"Researcher Console"]})]}),e.jsx(Nn,{hasRecoverableSession:Se,recoveryData:ue,onRecover:ee,onDiscard:$}),T&&e.jsxs("details",{style:{width:"100%",maxWidth:"720px",backgroundColor:"#0f172a",borderRadius:"12px",border:"1px solid #334155",padding:"16px",textAlign:"left"},children:[e.jsx("summary",{style:{cursor:"pointer",color:"white",fontWeight:600,fontSize:"14px"},children:"Advanced / Diagnostics"}),e.jsxs("div",{style:{marginTop:"16px",display:"flex",flexDirection:"column",gap:"20px"},children:[e.jsx("div",{style:{padding:"12px",backgroundColor:"#1e293b",borderRadius:"8px",border:"1px solid #334155"},children:(()=>{const R=[{title:"Open Study Design",description:"Review condition assignment, case order, and disclosure policy.",action:()=>j(!0),icon:e.jsx(Ue,{size:14})},{title:"Open Study Pack",description:"Show the replication bundle and export artifacts.",action:()=>ne(!0),icon:e.jsx(gt,{size:14})},{title:"Launch Researcher Session",description:"Start a session to demonstrate the live workflow.",action:()=>{N("RESEARCHER"),Ne()},icon:e.jsx(tt,{size:14})}],P=R[Math.min(d,R.length-1)];return e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"},children:[e.jsxs("div",{style:{color:"white",fontWeight:700,fontSize:"14px",display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(tt,{size:14}),"Demo Path (60 seconds)"]}),e.jsxs("div",{style:{color:"#64748b",fontSize:"11px"},children:["Step ",d+1," of ",R.length]})]}),e.jsxs("div",{style:{color:"white",fontWeight:600,marginBottom:"6px",display:"flex",alignItems:"center",gap:"8px"},children:[P.icon,P.title]}),e.jsx("div",{style:{color:"#94a3b8",fontSize:"12px",marginBottom:"12px"},children:P.description}),e.jsxs("div",{style:{display:"flex",gap:"8px"},children:[e.jsxs("button",{onClick:()=>{P.action(),w(K=>Math.min(K+1,R.length-1))},style:{padding:"8px 12px",backgroundColor:"#3b82f6",border:"none",borderRadius:"8px",color:"white",cursor:"pointer",fontSize:"12px",fontWeight:600,display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx(tt,{size:12}),"Open Step"]}),e.jsx("button",{onClick:()=>w(0),style:{padding:"8px 12px",backgroundColor:"#1f2937",border:"1px solid #334155",borderRadius:"8px",color:"#94a3b8",cursor:"pointer",fontSize:"12px",fontWeight:600},children:"Restart"})]})]})})()}),e.jsxs("div",{children:[e.jsx("div",{style:{color:"#94a3b8",fontSize:"12px",marginBottom:"8px"},children:"View Mode"}),e.jsxs("div",{style:{display:"flex",gap:"8px"},children:[e.jsxs("button",{onClick:()=>N("CLINICIAN"),style:{padding:"8px 14px",backgroundColor:H?"#3b82f6":"#1f2937",border:"1px solid #334155",borderRadius:"8px",color:"white",cursor:"pointer",fontSize:"12px",fontWeight:600,display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx(rt,{size:12}),"Clinician"]}),e.jsxs("button",{onClick:()=>N("RESEARCHER"),style:{padding:"8px 14px",backgroundColor:_==="RESEARCHER"?"#a855f7":"#1f2937",border:"1px solid #334155",borderRadius:"8px",color:"white",cursor:"pointer",fontSize:"12px",fontWeight:600,display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx(Ze,{size:12}),"Researcher"]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{style:{color:"white",marginBottom:"12px"},children:"Select Study Condition"}),e.jsx("div",{style:{display:"flex",gap:"12px",flexWrap:"wrap"},children:["HUMAN_FIRST","AI_FIRST","CONCURRENT"].map(R=>e.jsxs("button",{onClick:()=>Ne(R),style:{padding:"16px 20px",backgroundColor:R==="HUMAN_FIRST"?"#3b82f6":"#334155",color:"white",border:"2px solid "+(R==="HUMAN_FIRST"?"#60a5fa":"#475569"),borderRadius:"12px",cursor:"pointer",minWidth:"180px"},children:[e.jsxs("div",{style:{fontSize:"15px",fontWeight:600,marginBottom:"6px",display:"flex",alignItems:"center",gap:"6px"},children:[R==="HUMAN_FIRST"?e.jsx(rt,{size:14}):R==="AI_FIRST"?e.jsx(Ke,{size:14}):e.jsx(Oi,{size:14}),R==="HUMAN_FIRST"?"Human First":R==="AI_FIRST"?"AI First":"Concurrent"]}),e.jsx("div",{style:{fontSize:"11px",opacity:.8},children:R==="HUMAN_FIRST"?"Lock before AI":R==="AI_FIRST"?"See AI first":"AI visible"}),R==="HUMAN_FIRST"&&e.jsx("div",{style:{marginTop:"6px",fontSize:"10px",backgroundColor:"rgba(255,255,255,0.2)",padding:"4px 8px",borderRadius:"12px"},children:"RECOMMENDED"})]},R))})]}),e.jsxs("div",{style:{backgroundColor:"#fef3c7",color:"#92400e",padding:"16px",borderRadius:"12px",display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(Ue,{size:14}),e.jsx("strong",{children:"Protocol:"})," 1 calibration case + 3 study cases • FDR/FOR disclosure • Comprehension check • Deviation documentation"]})]})]})]}),t.step==="CALIBRATION"&&ae&&e.jsxs("div",{children:[e.jsxs("div",{style:{backgroundColor:"#fef3c7",color:"#92400e",padding:"16px",borderRadius:"12px",marginBottom:"24px",display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(Et,{size:14}),e.jsx("strong",{children:"Training Case:"})," Make your assessment. You'll see ground truth feedback."]}),e.jsx("div",{onMouseEnter:()=>ze("mammogram"),onMouseLeave:()=>me("mammogram"),style:{marginBottom:"24px",border:"2px solid #334155",borderRadius:"12px",overflow:"hidden"},children:e.jsx(Ct,{leftImage:(Yt=ae.images)==null?void 0:Yt.LCC,rightImage:(Kt=ae.images)==null?void 0:Kt.RCC,leftLabel:"L CC",rightLabel:"R CC",showAIOverlay:!1,onZoom:()=>Oe("zoom"),onPan:()=>Oe("pan")})}),T&&A&&e.jsx(jt,{roiDwellTimes:t.roiDwellTimes,interactionCounts:t.interactionCounts,totalTimeMs:c*1e3}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"24px",maxWidth:"500px",marginTop:"24px"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{color:"white",fontWeight:600,display:"block",marginBottom:"8px"},children:"BI-RADS"}),e.jsxs("select",{value:(Zt=t.calibrationBirads)!=null?Zt:"",onChange:R=>f(P=>({...P,calibrationBirads:Number(R.target.value)})),style:{width:"100%",padding:"12px",borderRadius:"8px",border:"2px solid #475569",backgroundColor:"#334155",color:"white",fontSize:"16px"},children:[e.jsx("option",{value:"",children:"Select..."}),[0,1,2,3,4,5,6].map(R=>e.jsxs("option",{value:R,children:["BI-RADS ",R]},R))]}),e.jsx("div",{style:{fontSize:"10px",color:"#64748b",marginTop:"4px"},children:"Shortcut: 0-5 to quick-select"})]}),e.jsxs("div",{children:[e.jsxs("label",{style:{color:"white",fontWeight:600,display:"block",marginBottom:"8px"},children:["Confidence: ",t.calibrationConfidence,"%"]}),e.jsx("input",{type:"range",min:"0",max:"100",value:t.calibrationConfidence,onChange:R=>f(P=>({...P,calibrationConfidence:Number(R.target.value)})),style:{width:"100%"}}),e.jsx("div",{style:{fontSize:"10px",color:"#64748b",marginTop:"4px"},children:"Shortcut: +/- to adjust"})]})]}),e.jsxs("button",{id:"calibration-submit-btn",onClick:Me,disabled:t.calibrationBirads===null,style:{marginTop:"24px",padding:"16px 32px",backgroundColor:t.calibrationBirads!==null?"#f59e0b":"#475569",color:"white",border:"none",borderRadius:"8px",cursor:t.calibrationBirads!==null?"pointer":"not-allowed",fontSize:"16px",fontWeight:600},children:["Submit & See Ground Truth",e.jsx("span",{style:{marginLeft:"8px",opacity:.7,fontSize:"12px"},children:"[Space]"})]})]}),t.step==="CALIBRATION_FEEDBACK"&&ae&&e.jsxs("div",{style:{textAlign:"center",padding:"40px"},children:[e.jsxs("div",{style:{backgroundColor:"#f59e0b",color:"#78350f",padding:"12px 20px",borderRadius:"12px",marginBottom:"24px",display:"inline-block"},children:[e.jsxs("div",{style:{fontWeight:700,fontSize:"14px",marginBottom:"4px",display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx(Et,{size:14}),"CALIBRATION MODE — GROUND TRUTH VISIBLE"]}),e.jsx("div",{style:{fontSize:"11px",opacity:.9},children:"This feedback is shown only during calibration. Study trials will NOT reveal ground truth."})]}),e.jsx("h2",{style:{color:"#4ade80",marginTop:"16px"},children:"Training Feedback"}),e.jsxs("div",{style:{display:"flex",gap:"32px",justifyContent:"center",marginBottom:"32px"},children:[e.jsxs("div",{style:{padding:"24px",backgroundColor:"#334155",borderRadius:"12px",minWidth:"140px"},children:[e.jsx("div",{style:{fontSize:"12px",color:"#94a3b8",marginBottom:"8px"},children:"Your Assessment"}),e.jsxs("div",{style:{fontSize:"32px",fontWeight:"bold",color:"white"},children:["BI-RADS ",t.calibrationBirads]})]}),e.jsxs("div",{style:{padding:"24px",backgroundColor:"#166534",borderRadius:"12px",minWidth:"140px",border:"2px solid #22c55e"},children:[e.jsx("div",{style:{fontSize:"12px",color:"#86efac",marginBottom:"8px"},children:"Ground Truth"}),e.jsxs("div",{style:{fontSize:"32px",fontWeight:"bold",color:"white"},children:["BI-RADS ",(Xt=(qt=ae.groundTruth)==null?void 0:qt.birads)!=null?Xt:"?"]})]})]}),e.jsxs("div",{style:{color:t.calibrationBirads===((Qt=ae.groundTruth)==null?void 0:Qt.birads)?"#4ade80":"#fbbf24",fontSize:"18px",marginBottom:"24px",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},children:[t.calibrationBirads===((Jt=ae.groundTruth)==null?void 0:Jt.birads)?e.jsx(De,{size:18,color:"#4ade80"}):e.jsx(je,{size:18,color:"#fbbf24"}),t.calibrationBirads===((ei=ae.groundTruth)==null?void 0:ei.birads)?"Correct":"Review the case presentation for learning"]}),e.jsxs("div",{style:{backgroundColor:"#1e3a5f",color:"#93c5fd",padding:"12px 16px",borderRadius:"8px",marginBottom:"24px",maxWidth:"400px",margin:"0 auto 24px",fontSize:"12px",border:"1px solid #3b82f6"},children:[e.jsx("strong",{children:"Next:"})," Study trials begin. You will NOT see ground truth or feedback until the study is complete."]}),e.jsxs("button",{onClick:qe,style:{padding:"16px 32px",backgroundColor:"#3b82f6",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"16px",fontWeight:600,display:"inline-flex",alignItems:"center",gap:"8px"},children:[e.jsx(tt,{size:16}),"Begin Study Trials →"]})]}),t.step==="INITIAL"&&ae&&e.jsxs("div",{children:[e.jsxs("div",{style:{backgroundColor:"#3b82f6",color:"white",padding:"16px",borderRadius:"12px",marginBottom:"16px",display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(Ke,{size:16}),e.jsx("strong",{children:"Initial Assessment:"})," Review the mammogram and lock your impression BEFORE seeing AI."]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 16px",backgroundColor:"#1e293b",borderRadius:"8px 8px 0 0",border:"2px solid #3b82f6",borderBottom:"none"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[e.jsx(Mn,{currentProtocol:de,onProtocolChange:R=>{var P;be(R),(P=O.current)==null||P.addEvent("HANGING_PROTOCOL_CHANGED",{protocol:R,timestamp:new Date().toISOString()})}}),e.jsxs("div",{style:{fontSize:"11px",color:"#64748b"},children:[e.jsx("span",{style:{color:"#94a3b8",fontWeight:600},children:ae.caseId}),ae.isCalibration&&e.jsx("span",{style:{marginLeft:"8px",padding:"2px 6px",backgroundColor:"#f59e0b",color:"#78350f",borderRadius:"4px",fontSize:"9px",fontWeight:600},children:"CALIBRATION"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsxs("div",{style:{fontSize:"11px",color:c<3?"#f87171":"#4ade80",fontWeight:600,padding:"4px 8px",backgroundColor:"#0f172a",borderRadius:"4px",fontFamily:"monospace",display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx(Rt,{size:12}),c,"s"]}),e.jsxs("button",{onClick:()=>{var R;f(P=>({...P,interactionCounts:{zooms:0,pans:0}})),(R=O.current)==null||R.addEvent("VIEWPORT_RESET",{caseId:ae.caseId,timestamp:new Date().toISOString()})},style:{padding:"4px 10px",backgroundColor:"#334155",border:"1px solid #475569",borderRadius:"4px",color:"#94a3b8",cursor:"pointer",fontSize:"11px",fontWeight:600,display:"flex",alignItems:"center",gap:"6px"},title:"Reset viewport (R)",children:[e.jsx(lt,{size:12}),"Reset"]})]})]}),e.jsx("div",{onMouseEnter:()=>ze("mammogram"),onMouseLeave:()=>me("mammogram"),style:{marginBottom:"24px",border:"2px solid #3b82f6",borderTop:"none",borderRadius:"0 0 12px 12px",overflow:"hidden"},children:e.jsx(Ct,{leftImage:(ti=ae.images)==null?void 0:ti.LCC,rightImage:(ii=ae.images)==null?void 0:ii.RCC,leftLabel:"L CC",rightLabel:"R CC",showAIOverlay:!1,onZoom:()=>Oe("zoom"),onPan:()=>Oe("pan")})}),T&&A&&e.jsx(jt,{roiDwellTimes:t.roiDwellTimes,interactionCounts:t.interactionCounts,totalTimeMs:c*1e3}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"24px",maxWidth:"500px",marginTop:"24px"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{color:"white",fontWeight:600,display:"block",marginBottom:"8px"},children:"BI-RADS Assessment"}),e.jsxs("select",{value:(ni=t.initialBirads)!=null?ni:"",onChange:R=>f(P=>({...P,initialBirads:Number(R.target.value)})),style:{width:"100%",padding:"12px",borderRadius:"8px",border:"2px solid #3b82f6",backgroundColor:"#334155",color:"white",fontSize:"16px"},children:[e.jsx("option",{value:"",children:"Select..."}),[0,1,2,3,4,5,6].map(R=>e.jsxs("option",{value:R,children:["BI-RADS ",R]},R))]}),e.jsx("div",{style:{fontSize:"10px",color:"#64748b",marginTop:"4px"},children:"Shortcut: 0-5 to quick-select"})]}),e.jsxs("div",{children:[e.jsxs("label",{style:{color:"white",fontWeight:600,display:"block",marginBottom:"8px"},children:["Confidence: ",t.initialConfidence,"%"]}),e.jsx("input",{type:"range",min:"0",max:"100",value:t.initialConfidence,onChange:R=>f(P=>({...P,initialConfidence:Number(R.target.value)})),style:{width:"100%"}}),e.jsx("div",{style:{fontSize:"10px",color:"#64748b",marginTop:"4px"},children:"Shortcut: +/- to adjust"})]})]}),T&&e.jsxs("div",{style:{marginTop:"20px",padding:"16px",backgroundColor:"#1e293b",borderRadius:"12px",border:"1px solid #334155"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},children:[e.jsxs("label",{style:{color:"#94a3b8",fontWeight:600,fontSize:"13px",display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx(Ke,{size:12}),"Expected Trust in AI"]}),e.jsxs("span",{style:{color:"#60a5fa",fontWeight:700},children:[t.preTrust,"%"]})]}),e.jsx("input",{type:"range",min:"0",max:"100",value:t.preTrust,onChange:R=>f(P=>({...P,preTrust:Number(R.target.value)})),style:{width:"100%"}}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"10px",color:"#64748b",marginTop:"4px"},children:[e.jsx("span",{children:"Won't rely on AI"}),e.jsx("span",{children:"Will heavily rely"})]})]}),e.jsxs("button",{id:"lock-impression-btn",onClick:Je,disabled:t.initialBirads===null,style:{marginTop:"24px",padding:"16px 32px",backgroundColor:t.initialBirads!==null?"#f59e0b":"#475569",color:"white",border:"none",borderRadius:"8px",cursor:t.initialBirads!==null?"pointer":"not-allowed",fontSize:"16px",fontWeight:600,display:"inline-flex",alignItems:"center",gap:"8px"},children:[e.jsx(vt,{size:16}),"Lock First Impression & Reveal AI",e.jsx("span",{style:{marginLeft:"8px",opacity:.7,fontSize:"12px"},children:"[Space]"})]})]}),t.step==="AI_REVEALED"&&ae&&e.jsxs("div",{children:[e.jsxs("div",{style:{backgroundColor:"#7c3aed",color:"white",padding:"16px",borderRadius:"12px",marginBottom:"24px"},children:[e.jsxs("strong",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(Ke,{size:16}),"AI Assessment Revealed:"]})," Review AI opinion and FDR/FOR disclosure. You may update your assessment."]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"2fr 1fr",gap:"24px"},children:[e.jsx("div",{onMouseEnter:()=>ze("mammogram"),onMouseLeave:()=>me("mammogram"),style:{border:"2px solid #7c3aed",borderRadius:"12px",overflow:"hidden"},children:e.jsx(Ct,{leftImage:(si=ae.images)==null?void 0:si.LCC,rightImage:(ri=ae.images)==null?void 0:ri.RCC,leftLabel:"L CC",rightLabel:"R CC",showAIOverlay:!0,onZoom:()=>Oe("zoom"),onPan:()=>Oe("pan")})}),e.jsxs("div",{children:[e.jsxs("div",{onMouseEnter:()=>ze("ai_box"),onMouseLeave:()=>me("ai_box"),style:{backgroundColor:"#7c3aed",padding:"20px",borderRadius:"12px",marginBottom:"16px",border:"2px solid #a855f7"},children:[e.jsx("div",{style:{fontSize:"12px",color:"#c4b5fd",marginBottom:"8px"},children:"AI ASSESSMENT"}),e.jsxs("div",{style:{fontSize:"32px",fontWeight:"bold",color:"white"},children:["BI-RADS ",_e]}),e.jsxs("div",{style:{fontSize:"14px",color:"#c4b5fd",marginTop:"4px"},children:["Confidence: ",(xe*100).toFixed(0),"%"]})]}),(()=>{const R=t.caseQueue?["EASY","MEDIUM","HARD"][t.caseQueue.currentIndex%3]:"MEDIUM",P=Q==="STATIC"||R!=="EASY",K=Q==="ADAPTIVE"&&R==="HARD";return e.jsxs("div",{onMouseEnter:()=>ze("fdr_for"),onMouseLeave:()=>me("fdr_for"),style:{backgroundColor:"#0f172a",padding:"16px",borderRadius:"12px",border:`2px solid ${Q==="ADAPTIVE"?"#a855f7":"#f59e0b"}`},children:[Q==="ADAPTIVE"&&e.jsx("div",{style:{marginBottom:"12px",padding:"6px 10px",backgroundColor:R==="EASY"?"#166534":R==="MEDIUM"?"#92400e":"#7f1d1d",borderRadius:"6px",fontSize:"10px",fontWeight:700,color:"white",textAlign:"center"},children:e.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:"6px"},children:[e.jsx(Ke,{size:12}),"ADAPTIVE: ",R," CASE → ",R==="EASY"?"MINIMAL":R==="MEDIUM"?"STANDARD":"FULL+DEBIAS"," DISCLOSURE"]})}),P?e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginBottom:"12px"},children:[e.jsx("div",{style:{fontSize:"11px",color:"#92400e",fontWeight:700},children:"FALSE DISCOVERY RATE (FDR)"}),e.jsx("div",{style:{fontSize:"24px",fontWeight:"bold",color:"#f59e0b"},children:"4%"}),e.jsx("div",{style:{fontSize:"11px",color:"#64748b"},children:'Of AI "suspicious" → actually benign'})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"11px",color:"#991b1b",fontWeight:700},children:"FALSE OMISSION RATE (FOR)"}),e.jsx("div",{style:{fontSize:"24px",fontWeight:"bold",color:"#ef4444"},children:"12%"}),e.jsx("div",{style:{fontSize:"11px",color:"#64748b"},children:'Of AI "normal" → actually cancer'})]})]}):e.jsxs("div",{style:{textAlign:"center",color:"#94a3b8",fontSize:"12px",padding:"12px 0"},children:[e.jsx("div",{style:{display:"flex",justifyContent:"center",marginBottom:"4px"},children:e.jsx(Xe,{size:14})}),e.jsx("div",{children:"Minimal disclosure mode (easy case)"}),e.jsx("div",{style:{fontSize:"10px",marginTop:"4px",color:"#64748b"},children:"AI suggestion shown without detailed error rates"})]}),K&&e.jsxs("div",{style:{marginTop:"12px",padding:"10px",backgroundColor:"#7f1d1d",borderRadius:"8px",border:"2px solid #ef4444"},children:[e.jsx("div",{style:{fontSize:"11px",fontWeight:700,color:"#fca5a5",marginBottom:"6px"},children:e.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:"6px"},children:[e.jsx(je,{size:12}),"HARD CASE: AUTOMATION BIAS WARNING"]})}),e.jsx("div",{style:{fontSize:"11px",color:"#fecaca"},children:"This case has features that frequently lead to over-reliance on AI. Please ensure your independent assessment is well-formed before integrating AI input."})]}),Q==="ADAPTIVE"&&A&&e.jsxs("div",{style:{marginTop:"12px",padding:"10px",backgroundColor:"#1e1b4b",borderRadius:"8px",border:"1px solid #4338ca",fontSize:"10px"},children:[e.jsxs("div",{style:{fontWeight:700,color:"#a5b4fc",marginBottom:"8px",display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx(ut,{size:12}),e.jsx("span",{children:"POLICY DECISION REASONING"})]}),e.jsxs("div",{style:{color:"#c7d2fe"},children:[e.jsxs("div",{style:{marginBottom:"6px"},children:[e.jsx("span",{style:{color:"#818cf8"},children:"Input:"})," case_difficulty=",R]}),e.jsxs("div",{style:{marginBottom:"6px"},children:[e.jsx("span",{style:{color:"#818cf8"},children:"Rule:"})," ",R==="EASY"?"EASY → suppress FDR/FOR (minimal cognitive load)":R==="MEDIUM"?"MEDIUM → show FDR/FOR (standard disclosure)":"HARD → full FDR/FOR + debias prompt (max intervention)"]}),e.jsxs("div",{style:{marginBottom:"6px"},children:[e.jsx("span",{style:{color:"#818cf8"},children:"Output:"})," disclosure_intensity=",R==="EASY"?"MINIMAL":R==="MEDIUM"?"STANDARD":"FULL_DEBIAS"]}),e.jsxs("div",{style:{marginTop:"8px",paddingTop:"6px",borderTop:"1px solid #4338ca",color:"#94a3b8",display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx(De,{size:10,color:"#22c55e"}),e.jsx("span",{children:"Logged: ADAPTIVE_DISCLOSURE_DECISION"})]})]})]})]})})(),T&&A&&e.jsxs("div",{style:{marginTop:"12px"},children:[e.jsxs("button",{onClick:()=>E(!C),style:{width:"100%",padding:"10px 12px",backgroundColor:"#1e293b",color:"#94a3b8",border:"1px solid #334155",borderRadius:"8px",cursor:"pointer",fontSize:"11px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx(Ke,{size:12}),"AI Model Card"]}),e.jsx("span",{children:C?e.jsx(Bi,{size:14}):e.jsx(Mi,{size:14})})]}),C&&e.jsxs("div",{style:{marginTop:"8px",padding:"12px",backgroundColor:"#0f172a",borderRadius:"8px",border:"1px solid #334155",fontSize:"11px"},children:[e.jsxs("div",{style:{marginBottom:"8px"},children:[e.jsx("span",{style:{color:"#64748b"},children:"Model:"}),e.jsx("span",{style:{color:"white",marginLeft:"8px"},children:"MammoCAD v2.1"})]}),e.jsxs("div",{style:{marginBottom:"8px"},children:[e.jsx("span",{style:{color:"#64748b"},children:"Training:"}),e.jsx("span",{style:{color:"white",marginLeft:"8px"},children:"142K mammograms"})]}),e.jsxs("div",{style:{marginBottom:"8px"},children:[e.jsx("span",{style:{color:"#64748b"},children:"Operating Point:"}),e.jsx("span",{style:{color:"white",marginLeft:"8px"},children:"Sens 88% / Spec 92%"})]}),e.jsxs("div",{style:{marginBottom:"8px"},children:[e.jsx("span",{style:{color:"#64748b"},children:"Last Calibrated:"}),e.jsx("span",{style:{color:"white",marginLeft:"8px"},children:"2025-11-15"})]}),e.jsx("div",{style:{marginTop:"8px",padding:"6px",backgroundColor:"#7f1d1d",borderRadius:"4px",color:"#fca5a5",fontSize:"10px"},children:e.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:"6px"},children:[e.jsx(je,{size:12}),"Research use only. Not FDA cleared for clinical diagnosis."]})})]})]}),T&&e.jsxs("div",{style:{marginTop:"16px",padding:"16px",backgroundColor:"#1e293b",borderRadius:"12px"},children:[e.jsx("div",{style:{fontSize:"12px",color:"#94a3b8",marginBottom:"8px",fontWeight:600},children:"Comprehension Check"}),e.jsx("div",{style:{fontSize:"13px",color:"white",marginBottom:"12px"},children:"Which error type is MORE likely with this AI?"}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:[{id:"false_alarm",label:"False alarm (FDR = 4%)"},{id:"missed_cancer",label:"Missed cancer (FOR = 12%)"}].map(R=>e.jsx("button",{onClick:()=>et(R.id),style:{padding:"10px 16px",textAlign:"left",borderRadius:"8px",border:"none",cursor:"pointer",backgroundColor:t.comprehensionAnswer===R.id?t.comprehensionCorrect?"#166534":"#991b1b":"#334155",color:"white",fontSize:"13px"},children:R.label},R.id))}),t.comprehensionAnswer&&e.jsx("div",{style:{marginTop:"12px",padding:"8px",borderRadius:"6px",backgroundColor:t.comprehensionCorrect?"#166534":"#7f1d1d",color:"white",fontSize:"12px"},children:e.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:"6px"},children:[t.comprehensionCorrect?e.jsx(De,{size:12}):e.jsx(je,{size:12}),t.comprehensionCorrect?"Correct: FOR=12% > FDR=4%":"FOR=12% means missed cancers are more likely"]})})]})]})]}),T&&A&&e.jsx(jt,{roiDwellTimes:t.roiDwellTimes,interactionCounts:t.interactionCounts,totalTimeMs:c*1e3}),T&&A&&e.jsx(Ln,{timeToLockMs:t.lockTime&&t.caseStartTime?t.lockTime.getTime()-t.caseStartTime.getTime():0,aiAgreementStreak:le,deviationsSkipped:B,totalDeviations:ie,casesCompleted:t.caseResults.length,aiDwellRatio:(t.roiDwellTimes.get("ai_box")||0)/Math.max(1,Array.from(t.roiDwellTimes.values()).reduce((R,P)=>R+P,0))}),T&&A&&e.jsx(Pn,{caseResults:t.caseResults,currentPreAiTimeMs:t.lockTime&&t.caseStartTime?t.lockTime.getTime()-t.caseStartTime.getTime():0,interactionCounts:t.interactionCounts,totalViewingTimeMs:c*1e3}),T&&A&&e.jsx(Fn,{caseResults:t.caseResults,currentCase:null}),T&&A&&e.jsx(Wn,{caseResults:t.caseResults,sessionMedianPreAiMs:oe,verifierPassed:t.verifierResult==="PASS",ledgerIntact:((ai=(oi=t.verifierOutput)==null?void 0:oi.chainIntegrity)==null?void 0:ai.brokenAt)===null}),T&&A&&e.jsx(Un,{ledger:(di=(li=F.current)==null?void 0:li.getLedger())!=null?di:[]}),T&&A&&e.jsx(Hn,{interactionCounts:t.interactionCounts,roiDwellTimes:t.roiDwellTimes,currentPreAiTimeMs:t.lockTime&&t.caseStartTime?t.lockTime.getTime()-t.caseStartTime.getTime():0,currentPostAiTimeMs:t.aiRevealTime?Date.now()-t.aiRevealTime.getTime():0,sessionMedianPreAiMs:oe,caseResults:t.caseResults,isLive:!0}),T&&A&&e.jsx($n,{}),T&&A&&e.jsx(Vn,{condition:t.condition,disclosurePolicy:Q,onDisclosurePolicyChange:async R=>{var P;Y(R),O.current&&await O.current.addEvent("DISCLOSURE_POLICY_CHANGED",{policy:R,caseId:(P=t.currentCase)==null?void 0:P.caseId,timestamp:new Date().toISOString()})},caseQueue:t.caseQueue,isInterventionMode:S,onInterventionModeChange:k}),T&&A&&e.jsx(Gn,{caseResults:t.caseResults,eventCount:t.eventCount,verifierResult:t.verifierResult}),e.jsxs("div",{style:{marginTop:"24px",padding:"20px",backgroundColor:"#0f172a",borderRadius:"12px"},children:[e.jsxs("div",{style:{fontSize:"14px",color:"white",fontWeight:600,marginBottom:"16px"},children:["Final Assessment ",t.finalBirads!==t.initialBirads&&e.jsxs("span",{style:{color:"#f59e0b",display:"inline-flex",alignItems:"center",gap:"6px"},children:[e.jsx(je,{size:12})," CHANGED from BI-RADS ",t.initialBirads]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"24px",maxWidth:"500px"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{color:"#94a3b8",fontWeight:600,display:"block",marginBottom:"8px",fontSize:"12px"},children:"BI-RADS"}),e.jsx("select",{value:(ci=t.finalBirads)!=null?ci:"",onChange:R=>f(P=>({...P,finalBirads:Number(R.target.value)})),style:{width:"100%",padding:"12px",borderRadius:"8px",border:"2px solid #475569",backgroundColor:"#334155",color:"white",fontSize:"16px"},children:[0,1,2,3,4,5,6].map(R=>e.jsxs("option",{value:R,children:["BI-RADS ",R]},R))})]}),e.jsxs("div",{children:[e.jsxs("label",{style:{color:"#94a3b8",fontWeight:600,display:"block",marginBottom:"8px",fontSize:"12px"},children:["Confidence: ",t.finalConfidence,"%"]}),e.jsx("input",{type:"range",min:"0",max:"100",value:t.finalConfidence,onChange:R=>f(P=>({...P,finalConfidence:Number(R.target.value)})),style:{width:"100%"}})]})]}),T&&e.jsxs("div",{style:{marginTop:"16px",padding:"16px",backgroundColor:"#1e293b",borderRadius:"12px",border:"1px solid #334155"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},children:[e.jsxs("label",{style:{color:"#94a3b8",fontWeight:600,fontSize:"13px",display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx(Ke,{size:12}),"Actual Reliance on AI"]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[e.jsxs("span",{style:{color:"#a855f7",fontWeight:700},children:[t.postTrust,"%"]}),t.postTrust!==t.preTrust&&e.jsxs("span",{style:{padding:"2px 8px",borderRadius:"10px",fontSize:"11px",fontWeight:600,backgroundColor:t.postTrust>t.preTrust?"#166534":"#7f1d1d",color:t.postTrust>t.preTrust?"#86efac":"#fca5a5"},children:[t.postTrust>t.preTrust?"↑":"↓"," ",Math.abs(t.postTrust-t.preTrust)]})]})]}),e.jsx("input",{type:"range",min:"0",max:"100",value:t.postTrust,onChange:R=>f(P=>({...P,postTrust:Number(R.target.value)})),style:{width:"100%"}}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"10px",color:"#64748b",marginTop:"4px"},children:[e.jsx("span",{children:"Didn't rely on AI"}),e.jsx("span",{children:"Heavily relied"})]}),e.jsxs("div",{style:{marginTop:"8px",fontSize:"11px",color:"#64748b"},children:["Pre-AI expectation was ",t.preTrust,"% —",t.postTrust>t.preTrust?" trust increased":t.postTrust<t.preTrust?" trust decreased":" no change"]})]}),e.jsxs("button",{id:"submit-final-btn",onClick:Fe,disabled:T&&!t.comprehensionAnswer,style:{marginTop:"20px",padding:"16px 32px",backgroundColor:T?t.comprehensionAnswer?"#22c55e":"#475569":"#22c55e",color:"white",border:"none",borderRadius:"8px",cursor:T?t.comprehensionAnswer?"pointer":"not-allowed":"pointer",fontSize:"16px",fontWeight:600,display:"inline-flex",alignItems:"center",gap:"8px"},children:[t.finalBirads!==t.initialBirads?e.jsxs(e.Fragment,{children:[e.jsx(at,{size:16}),"Document Deviation & Submit"]}):e.jsxs(e.Fragment,{children:[e.jsx(De,{size:16}),"Submit Final Assessment"]}),e.jsx("span",{style:{marginLeft:"8px",opacity:.7,fontSize:"12px"},children:"[Enter]"})]})]})]}),t.step==="DEVIATION"&&e.jsxs("div",{style:{maxWidth:"600px"},children:[e.jsxs("div",{style:{backgroundColor:"#f59e0b",color:"#78350f",padding:"16px",borderRadius:"12px",marginBottom:"24px"},children:[e.jsxs("strong",{style:{display:"inline-flex",alignItems:"center",gap:"6px"},children:[e.jsx(je,{size:14}),"Deviation Documentation Required:"]})," You changed from BI-RADS ",t.initialBirads," to BI-RADS ",t.finalBirads,". Please document your rationale."]}),e.jsxs("div",{style:{marginBottom:"24px"},children:[e.jsx("label",{style:{color:"white",fontWeight:600,display:"block",marginBottom:"8px"},children:"Deviation Rationale"}),e.jsx("textarea",{value:t.deviationRationale,onChange:R=>f(P=>({...P,deviationRationale:R.target.value})),placeholder:"Explain why you changed your assessment after seeing the AI result...",style:{width:"100%",height:"120px",padding:"12px",borderRadius:"8px",border:"2px solid #f59e0b",backgroundColor:"#334155",color:"white",fontSize:"14px",resize:"none"}})]}),e.jsxs("div",{style:{display:"flex",gap:"16px"},children:[e.jsx("button",{onClick:()=>Le(!1),disabled:!t.deviationRationale.trim(),style:{flex:1,padding:"16px",backgroundColor:t.deviationRationale.trim()?"#22c55e":"#475569",color:"white",border:"none",borderRadius:"8px",cursor:t.deviationRationale.trim()?"pointer":"not-allowed",fontSize:"16px",fontWeight:600},children:"Submit with Documentation"}),e.jsx("button",{onClick:()=>Le(!0),style:{padding:"16px 24px",backgroundColor:"#ef4444",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"14px"},children:"Skip Documentation"})]})]}),t.step==="COMPLETE"&&ae&&e.jsxs("div",{children:[e.jsxs("h2",{style:{color:"#4ade80",marginTop:0,display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(De,{size:20}),"Case Complete"]}),(()=>{const R=Vi();return R?e.jsxs("div",{style:{backgroundColor:R.adda===!0?"#166534":R.adda===!1?"#92400e":"#334155",padding:"20px",borderRadius:"12px",marginBottom:"24px",border:`2px solid ${R.adda===!0?"#22c55e":R.adda===!1?"#f59e0b":"#475569"}`},children:[e.jsx("div",{style:{fontSize:"20px",fontWeight:"bold",color:"white"},children:R.addaDenominator?e.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:"8px"},children:[R.adda?e.jsx(De,{size:18}):e.jsx(je,{size:18}),R.adda?"ADDA = TRUE":"ADDA = FALSE"]}):e.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:"8px"},children:[e.jsx(pt,{size:18}),"Not in ADDA denominator"]})}),e.jsxs("div",{style:{color:"#94a3b8",marginTop:"8px",fontSize:"13px"},children:["change: ",R.changeOccurred.toString()," | ai_consistent: ",R.aiConsistentChange.toString()," | denominator: ",R.addaDenominator.toString()]})]}):null})(),(()=>{var se,fe;const R=t.caseResults[t.caseResults.length-1];if(!R)return null;const P=R.preAiReadMs?(R.preAiReadMs/1e3).toFixed(1):"0.0",K=R.aiExposureMs?(R.aiExposureMs/1e3).toFixed(1):"0.0";return e.jsxs("div",{style:{marginBottom:"24px",backgroundColor:"#0f172a",padding:"16px",borderRadius:"12px",border:"1px solid #334155"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"12px",color:"white",fontWeight:600},children:[e.jsx(nt,{size:16}),"Defensibility Metrics (Event-Derived)"]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"12px",fontSize:"12px",color:"#94a3b8"},children:[e.jsxs("div",{children:[e.jsx("div",{children:"Pre-AI Read Time"}),e.jsxs("div",{style:{color:"white",fontWeight:700},children:[P,"s"]})]}),e.jsxs("div",{children:[e.jsx("div",{children:"AI Exposure Time"}),e.jsxs("div",{style:{color:"white",fontWeight:700},children:[K,"s"]})]}),e.jsxs("div",{children:[e.jsx("div",{children:"Decision Change Count"}),e.jsx("div",{style:{color:"white",fontWeight:700},children:(se=R.decisionChangeCount)!=null?se:0})]}),e.jsxs("div",{children:[e.jsx("div",{children:"Override Count"}),e.jsx("div",{style:{color:"white",fontWeight:700},children:(fe=R.overrideCount)!=null?fe:0})]}),e.jsxs("div",{children:[e.jsx("div",{children:"Rationale Provided"}),e.jsx("div",{style:{color:"white",fontWeight:700},children:R.rationaleProvided?"Yes":"No"})]}),e.jsxs("div",{children:[e.jsx("div",{children:"Timing Flags"}),e.jsx("div",{style:{color:R.timingFlagPreAiTooFast||R.timingFlagAiExposureTooFast?"#fbbf24":"#4ade80",fontWeight:700},children:R.timingFlagPreAiTooFast||R.timingFlagAiExposureTooFast?"Too fast":"Clear"})]})]})]})})(),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"16px",marginBottom:"24px"},children:[e.jsxs("div",{style:{padding:"16px",backgroundColor:"#334155",borderRadius:"8px",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"12px",color:"#94a3b8"},children:"Pre-AI"}),e.jsxs("div",{style:{fontSize:"24px",fontWeight:"bold",color:"white"},children:[(pi=t.caseResults[t.caseResults.length-1])!=null&&pi.preAiReadMs?(((hi=(ui=t.caseResults[t.caseResults.length-1])==null?void 0:ui.preAiReadMs)!=null?hi:0)/1e3).toFixed(1):"0","s"]})]}),e.jsxs("div",{style:{padding:"16px",backgroundColor:"#334155",borderRadius:"8px",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"12px",color:"#94a3b8"},children:"Post-AI"}),e.jsxs("div",{style:{fontSize:"24px",fontWeight:"bold",color:"white"},children:[(fi=t.caseResults[t.caseResults.length-1])!=null&&fi.aiExposureMs?(((gi=(xi=t.caseResults[t.caseResults.length-1])==null?void 0:xi.aiExposureMs)!=null?gi:0)/1e3).toFixed(1):"0","s"]})]}),e.jsxs("div",{style:{padding:"16px",backgroundColor:"#334155",borderRadius:"8px",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"12px",color:"#94a3b8"},children:"Total"}),e.jsxs("div",{style:{fontSize:"24px",fontWeight:"bold",color:"white"},children:[c.toFixed(1),"s"]})]})]}),e.jsx("button",{onClick:()=>He(),style:{width:"100%",padding:"16px",backgroundColor:"#22c55e",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"16px",fontWeight:600},children:X&&X.current<X.total?`Continue to Case ${X.current+1}/${X.total}`:"Complete Study"})]}),t.step==="TLX"&&e.jsxs("div",{style:{maxWidth:"600px",margin:"0 auto"},children:[e.jsxs("div",{style:{backgroundColor:"#1e3a5f",padding:"16px",borderRadius:"12px",marginBottom:"24px",border:"1px solid #3b82f6"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"8px"},children:[e.jsx(Xe,{size:18}),e.jsx("span",{style:{color:"white",fontWeight:700},children:"NASA-TLX Workload Assessment"}),e.jsx("span",{style:{backgroundColor:"#3b82f6",color:"white",padding:"2px 8px",borderRadius:"10px",fontSize:"10px"},children:"MICRO"})]}),e.jsx("p",{style:{color:"#94a3b8",fontSize:"13px",margin:0},children:"Rate your experience for this case. This data helps correlate workload with decision quality."})]}),e.jsxs("div",{style:{marginBottom:"32px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"},children:[e.jsx("label",{style:{color:"white",fontWeight:600,fontSize:"15px"},children:"Mental Demand"}),e.jsx("span",{style:{color:"#60a5fa",fontWeight:700,fontSize:"20px"},children:m})]}),e.jsx("input",{type:"range",min:"0",max:"100",value:m,onChange:R=>l(Number(R.target.value)),style:{width:"100%",height:"8px",cursor:"pointer"}}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"11px",color:"#64748b",marginTop:"4px"},children:[e.jsx("span",{children:"Very Low"}),e.jsx("span",{children:"Very High"})]}),e.jsx("p",{style:{color:"#94a3b8",fontSize:"12px",marginTop:"8px"},children:"How mentally demanding was this case? (thinking, deciding, calculating, remembering)"})]}),e.jsxs("div",{style:{marginBottom:"32px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"},children:[e.jsx("label",{style:{color:"white",fontWeight:600,fontSize:"15px"},children:"Temporal Demand"}),e.jsx("span",{style:{color:"#f59e0b",fontWeight:700,fontSize:"20px"},children:x})]}),e.jsx("input",{type:"range",min:"0",max:"100",value:x,onChange:R=>h(Number(R.target.value)),style:{width:"100%",height:"8px",cursor:"pointer"}}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"11px",color:"#64748b",marginTop:"4px"},children:[e.jsx("span",{children:"Very Low"}),e.jsx("span",{children:"Very High"})]}),e.jsx("p",{style:{color:"#94a3b8",fontSize:"12px",marginTop:"8px"},children:"How hurried or rushed was the pace? (time pressure)"})]}),e.jsx("button",{onClick:async()=>{var R;O.current&&(await O.current.addEvent("NASA_TLX_RECORDED",{caseId:(R=t.currentCase)==null?void 0:R.caseId,mentalDemand:m,temporalDemand:x}),f(P=>{var K;return{...P,eventCount:((K=F.current)==null?void 0:K.getEvents().length)||0}})),l(50),h(50),He()},style:{width:"100%",padding:"16px",backgroundColor:"#22c55e",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"16px",fontWeight:600},children:X&&X.current<X.total?`Continue to Case ${X.current+1}/${X.total}`:"Complete Study"})]}),t.step==="STUDY_COMPLETE"&&e.jsxs("div",{children:[e.jsxs("h2",{style:{color:"#4ade80",marginTop:0,display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(De,{size:20}),"Study Complete"]}),t.exportReady&&e.jsxs("div",{style:{padding:"20px",borderRadius:"12px",marginBottom:"24px",backgroundColor:t.verifierResult==="PASS"?"#052e16":t.verifierResult==="FAIL"?"#450a0a":"#1e293b",border:`2px solid ${t.verifierResult==="PASS"?"#22c55e":t.verifierResult==="FAIL"?"#dc2626":"#475569"}`,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[e.jsx("div",{style:{width:"64px",height:"64px",borderRadius:"50%",backgroundColor:t.verifierResult==="PASS"?"#166534":t.verifierResult==="FAIL"?"#991b1b":"#334155",display:"flex",alignItems:"center",justifyContent:"center"},children:t.verifierResult==="PASS"?e.jsx(De,{size:32,color:"#4ade80"}):t.verifierResult==="FAIL"?e.jsx(je,{size:32,color:"#f87171"}):e.jsx(Tt,{size:32,color:"#94a3b8"})}),e.jsxs("div",{children:[e.jsx("div",{style:{color:t.verifierResult==="PASS"?"#4ade80":t.verifierResult==="FAIL"?"#f87171":"#94a3b8",fontSize:"24px",fontWeight:700},children:t.verifierResult==="PASS"?"VERIFICATION PASSED":t.verifierResult==="FAIL"?"VERIFICATION FAILED":"AWAITING VERIFICATION"}),e.jsx("div",{style:{color:"#94a3b8",fontSize:"12px",marginTop:"4px"},children:t.verifierResult==="PASS"?"Hash chain intact • Signature valid • No tampering detected":t.verifierResult==="FAIL"?`Integrity compromised: ${v||"Unknown error"}`:"Generate export to verify chain integrity"})]})]}),t.verifierResult&&e.jsxs("div",{style:{padding:"8px 16px",backgroundColor:t.verifierResult==="PASS"?"#166534":"#991b1b",borderRadius:"8px",color:"white",fontFamily:"monospace",fontSize:"11px"},children:[t.eventCount," events • Ed25519"]})]}),T&&e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"16px",marginBottom:"24px"},children:[e.jsxs("div",{style:{padding:"16px",backgroundColor:"#166534",borderRadius:"12px",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"32px",fontWeight:"bold",color:"white"},children:t.caseResults.length}),e.jsx("div",{style:{fontSize:"12px",color:"#86efac"},children:"Cases"})]}),e.jsxs("div",{style:{padding:"16px",backgroundColor:"#581c87",borderRadius:"12px",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"32px",fontWeight:"bold",color:"white"},children:t.caseResults.filter(R=>R.adda===!0).length}),e.jsx("div",{style:{fontSize:"12px",color:"#c4b5fd"},children:"ADDA=TRUE"})]}),e.jsxs("div",{style:{padding:"16px",backgroundColor:"#92400e",borderRadius:"12px",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"32px",fontWeight:"bold",color:"white"},children:t.caseResults.filter(R=>R.changeOccurred).length}),e.jsx("div",{style:{fontSize:"12px",color:"#fcd34d"},children:"Changes"})]}),e.jsxs("div",{style:{padding:"16px",backgroundColor:"#1e3a5f",borderRadius:"12px",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"32px",fontWeight:"bold",color:"white"},children:t.eventCount}),e.jsx("div",{style:{fontSize:"12px",color:"#93c5fd"},children:"Events"})]})]}),T&&(()=>{var P,K;if(!F.current)return null;const R=ki(F.current.getEvents(),t.condition,t.caseQueue,t.caseResults,Q,F.current.getStudyMetadata());return e.jsxs("div",{style:{backgroundColor:"#0f172a",padding:"20px",borderRadius:"12px",border:"1px solid #334155",marginBottom:"24px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"12px",color:"white",fontWeight:700},children:[e.jsx(Ue,{size:16}),"Methods Snapshot"]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px",fontSize:"12px",color:"#94a3b8"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:600,color:"#cbd5f5"},children:"Condition Assignment"}),e.jsxs("div",{children:["Condition: ",R.conditionAssignment.condition]}),e.jsxs("div",{children:["Disclosure format: ",R.conditionAssignment.disclosureFormat]}),e.jsxs("div",{children:["Seed: ",R.conditionAssignment.seed]}),e.jsxs("div",{children:["Assignment: ",R.conditionAssignment.assignmentMethod]})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:600,color:"#cbd5f5"},children:"Case Order"}),e.jsx("div",{style:{fontFamily:"monospace"},children:R.caseOrder.join(" → ")||"N/A"})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:600,color:"#cbd5f5"},children:"Timing Summary"}),e.jsxs("div",{children:["Avg pre-AI: ",(R.timingSummary.averagePreAiReadMs/1e3).toFixed(1),"s"]}),e.jsxs("div",{children:["Avg AI exposure: ",(R.timingSummary.averageAiExposureMs/1e3).toFixed(1),"s"]}),e.jsxs("div",{children:["Total duration: ",R.timingSummary.totalDurationMs?`${Math.round(R.timingSummary.totalDurationMs/1e3)}s`:"N/A"]})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:600,color:"#cbd5f5"},children:"Disclosure Variant"}),e.jsxs("div",{children:["Format: ",R.errorRateDisclosure.format]}),e.jsxs("div",{children:["Policy: ",R.errorRateDisclosure.policy]}),e.jsx("div",{style:{marginTop:"8px",fontWeight:600,color:"#cbd5f5"},children:"Lock Points"}),e.jsxs("div",{children:["Initial lock: ",(P=R.lockPoints.initialLockedTimestamp)!=null?P:"N/A"]}),e.jsxs("div",{children:["Final lock: ",(K=R.lockPoints.finalLockedTimestamp)!=null?K:"N/A"]})]})]})]})})(),T&&e.jsxs("div",{style:{backgroundColor:"#1e293b",padding:"16px",borderRadius:"12px",marginBottom:"24px",border:"1px solid #334155"},children:[e.jsxs("div",{style:{fontSize:"12px",color:"#94a3b8",fontWeight:600,marginBottom:"12px",display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx(nt,{size:12}),"CROSS-EXAMINATION RISK FLAGS"]}),e.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px"},children:[t.caseResults.some(R=>{var P;return((P=R.preAiReadMs)!=null?P:0)<_t})&&e.jsxs("span",{style:{padding:"4px 10px",backgroundColor:"#7f1d1d",color:"#fca5a5",borderRadius:"12px",fontSize:"11px",fontWeight:600,display:"inline-flex",alignItems:"center",gap:"6px"},children:[e.jsx(je,{size:10}),"FAST PRE-AI (<5s)"]}),t.caseResults.every(R=>R.adda===!0)&&e.jsxs("span",{style:{padding:"4px 10px",backgroundColor:"#7f1d1d",color:"#fca5a5",borderRadius:"12px",fontSize:"11px",fontWeight:600,display:"inline-flex",alignItems:"center",gap:"6px"},children:[e.jsx(je,{size:10}),"ALWAYS AGREED WITH AI"]}),t.caseResults.some(R=>R.deviationSkipped)&&e.jsxs("span",{style:{padding:"4px 10px",backgroundColor:"#92400e",color:"#fcd34d",borderRadius:"12px",fontSize:"11px",fontWeight:600,display:"inline-flex",alignItems:"center",gap:"6px"},children:[e.jsx(je,{size:10}),"DEVIATION SKIPPED"]}),t.caseResults.some(R=>R.comprehensionCorrect===!1)&&e.jsxs("span",{style:{padding:"4px 10px",backgroundColor:"#92400e",color:"#fcd34d",borderRadius:"12px",fontSize:"11px",fontWeight:600,display:"inline-flex",alignItems:"center",gap:"6px"},children:[e.jsx(je,{size:10}),"COMPREHENSION FAILED"]}),!t.caseResults.some(R=>{var P;return((P=R.preAiReadMs)!=null?P:0)<_t})&&!t.caseResults.every(R=>R.adda===!0)&&!t.caseResults.some(R=>R.deviationSkipped)&&!t.caseResults.some(R=>R.comprehensionCorrect===!1)&&e.jsxs("span",{style:{padding:"4px 10px",backgroundColor:"#166534",color:"#86efac",borderRadius:"12px",fontSize:"11px",fontWeight:600,display:"inline-flex",alignItems:"center",gap:"6px"},children:[e.jsx(De,{size:10}),"NO FLAGS - DEFENSIBLE RECORD"]})]})]}),e.jsxs("div",{style:{display:"flex",gap:"16px",marginBottom:"24px"},children:[e.jsxs("button",{onClick:st,style:{flex:1,padding:"16px",backgroundColor:"#f59e0b",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"16px",fontWeight:600,display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},children:[e.jsx(gt,{size:16}),"Generate Expert Witness Packet"]}),t.exportReady&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>g(!0),style:{padding:"16px 24px",backgroundColor:"#3b82f6",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"16px",display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(ut,{size:16}),"View"]}),T&&(a?e.jsxs("button",{onClick:Hi,style:{padding:"16px 24px",backgroundColor:"#166534",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"14px",fontWeight:600,display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(lt,{size:14}),"Reset Demo"]}):e.jsxs("button",{onClick:Ui,style:{padding:"16px 24px",backgroundColor:"#dc2626",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"14px",fontWeight:600,display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(je,{size:14}),"Tamper Demo"]}))]})]}),t.exportReady&&e.jsxs("div",{style:{backgroundColor:t.verifierResult==="PASS"?"#166534":"#7f1d1d",padding:"24px",borderRadius:"16px",border:`3px solid ${t.verifierResult==="PASS"?"#22c55e":"#ef4444"}`,transition:"all 0.3s ease"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold",fontSize:"18px",color:"white"},children:a?"Tampered packet detected":"Expert Witness Packet Available"}),e.jsxs("div",{style:{color:t.verifierResult==="PASS"?"#86efac":"#fca5a5"},children:["Verifier: ",t.verifierResult]})]}),e.jsx("div",{style:{backgroundColor:t.verifierResult==="PASS"?"#22c55e":"#ef4444",color:"white",padding:"12px 20px",borderRadius:"24px",fontWeight:700,fontSize:"16px",boxShadow:t.verifierResult==="FAIL"?"0 0 20px rgba(239, 68, 68, 0.5)":"none",animation:t.verifierResult==="FAIL"?"pulse 1s infinite":"none"},children:e.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:"8px"},children:[t.verifierResult==="PASS"?e.jsx(De,{size:16}):e.jsx(je,{size:16}),t.verifierResult==="PASS"?"CHAIN INTACT":"CHAIN BROKEN"]})})]}),a&&v&&e.jsxs("div",{style:{backgroundColor:"#450a0a",padding:"16px",borderRadius:"8px",marginBottom:"16px",border:"2px solid #dc2626"},children:[e.jsxs("div",{style:{fontFamily:"monospace",marginBottom:"8px"},children:[e.jsx("span",{style:{color:"#ef4444",fontWeight:700},children:"FAILURE CODE:"}),e.jsx("span",{style:{color:"#fca5a5",marginLeft:"8px"},children:v})]}),e.jsxs("div",{style:{fontSize:"12px",color:"#fca5a5",fontFamily:"monospace"},children:[v==="CHAIN_BROKEN"&&"Hash chain integrity violated at event #47. Expected: 8f3a2b... Got: 0000000...",v==="CONTENT_TAMPERED"&&'Event payload modified after signing. Field "finalBirads" changed from 4 to 2',v==="TIMESTAMP_REGRESSION"&&"Non-monotonic timestamp detected. Event #52 predates event #51 by 3.2s"]}),e.jsxs("div",{style:{marginTop:"12px",padding:"8px",backgroundColor:"#7f1d1d",borderRadius:"6px"},children:[e.jsx("div",{style:{fontSize:"11px",color:"#f87171",fontWeight:600},children:"LEGAL IMPLICATION:"}),e.jsx("div",{style:{fontSize:"12px",color:"#fecaca"},children:"This export cannot be used as evidence. The audit trail has been compromised."})]})]}),e.jsxs("div",{style:{backgroundColor:"#0f172a",padding:"16px",borderRadius:"8px",marginBottom:"16px"},children:[e.jsxs("div",{style:{fontWeight:600,marginBottom:"8px",color:"white",display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(at,{size:14}),"Package (7 files):"]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"8px",fontSize:"13px",color:"#94a3b8"},children:[e.jsx("div",{children:"trial_manifest.json"}),e.jsx("div",{children:"events.jsonl"}),e.jsx("div",{children:"ledger.json"}),e.jsx("div",{children:"verifier_output.json"}),e.jsx("div",{children:"derived_metrics.csv"}),e.jsx("div",{children:"methods_snapshot.json"}),e.jsx("div",{children:"codebook.md"})]})]}),!a&&e.jsxs("a",{href:t.exportUrl,download:t.exportFilename,style:{display:"inline-flex",alignItems:"center",gap:"8px",padding:"14px 28px",backgroundColor:"#22c55e",color:"white",borderRadius:"8px",textDecoration:"none",fontWeight:600,fontSize:"16px"},children:[e.jsx(kt,{size:16}),"Download ZIP"]})]}),e.jsx("div",{style:{marginTop:"24px",textAlign:"center"},children:e.jsxs("button",{onClick:()=>window.location.reload(),style:{padding:"12px 24px",backgroundColor:"#334155",color:"#94a3b8",border:"1px solid #475569",borderRadius:"8px",cursor:"pointer",fontSize:"14px",display:"inline-flex",alignItems:"center",gap:"8px"},children:[e.jsx(lt,{size:14}),"Start New Session"]})})]})]}),T&&o&&t.step!=="SETUP"&&F.current&&e.jsxs("div",{style:{position:"fixed",right:"20px",top:"20px",width:"280px",maxHeight:"calc(100vh - 40px)",backgroundColor:"#0f172a",borderRadius:"12px",overflow:"hidden",boxShadow:"0 20px 25px rgba(0,0,0,0.4)",border:"1px solid #334155",zIndex:100},children:[e.jsxs("div",{style:{padding:"12px 16px",backgroundColor:"#1e293b",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{style:{color:"white",fontWeight:600,display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx(Ue,{size:12}),"Events (",t.eventCount,")"]}),e.jsx("button",{onClick:()=>i(!1),style:{background:"none",border:"none",color:"#64748b",cursor:"pointer",fontSize:"16px"},children:"×"})]}),e.jsxs("div",{style:{padding:"8px"},children:[e.jsx(Bn,{eventCount:t.eventCount,sessionId:t.sessionId,isVerified:t.verifierResult==="PASS"?!0:t.verifierResult==="FAIL"?!1:null,lastHash:(yi=(mi=F.current.getLedger())==null?void 0:mi.slice(-1)[0])==null?void 0:yi.chainHash}),e.jsx(On,{caseResults:t.caseResults,currentCaseIndex:((bi=t.caseQueue)==null?void 0:bi.currentIndex)||0,totalCases:((vi=t.caseQueue)==null?void 0:vi.cases.length)||0,eventCount:t.eventCount,sessionStartTime:t.startTime})]}),e.jsx("div",{style:{padding:"8px 16px 8px",borderBottom:"1px solid #334155"},children:e.jsx("div",{style:{fontSize:"10px",color:"#64748b",fontWeight:600},children:"RECENT EVENTS"})}),e.jsx("div",{style:{maxHeight:"200px",overflow:"auto",padding:"8px",fontSize:"10px",fontFamily:"monospace"},children:F.current.getEvents().slice(-10).reverse().map((R,P)=>e.jsxs("div",{style:{padding:"8px",backgroundColor:P===0?"#1e293b":"transparent",borderRadius:"6px",marginBottom:"4px",borderLeft:"3px solid "+(R.type.includes("SESSION")?"#10b981":R.type.includes("LOCKED")?"#f59e0b":R.type.includes("AI")?"#a855f7":R.type.includes("GAZE")||R.type.includes("DWELL")?"#06b6d4":R.type.includes("KEYBOARD")?"#f97316":R.type.includes("EDITED")?"#ec4899":"#64748b")},children:[e.jsx("div",{style:{color:"#64748b",fontSize:"9px"},children:R.timestamp.split("T")[1].slice(0,12)}),e.jsx("div",{style:{color:"white",fontWeight:600},children:R.type})]},R.id))})]}),T&&!o&&t.step!=="SETUP"&&e.jsxs("button",{onClick:()=>i(!0),style:{position:"fixed",right:"20px",top:"20px",padding:"12px 16px",backgroundColor:"#1e293b",color:"white",border:"1px solid #334155",borderRadius:"8px",cursor:"pointer",fontWeight:600,zIndex:100,display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx(Ue,{size:12}),"Events (",t.eventCount,")"]})]}),e.jsx(zn,{isVisible:D,onClose:()=>j(!1)}),e.jsx(Dn,{isVisible:G,onClose:()=>ne(!1),sessionId:t.sessionId,condition:t.condition}),e.jsx(kn,{isVisible:te,onClose:()=>q(!1)}),e.jsx(Tn,{isVisible:s,onComplete:async R=>{var P;O.current&&await O.current.addEvent("POST_CASE_PROBES_COMPLETED",{caseId:(P=t.currentCase)==null?void 0:P.caseId,postTrust:R.postTrust,preTrust:t.preTrust,trustDelta:R.postTrust-t.preTrust,comprehensionAnswer:R.comprehensionAnswer,comprehensionCorrect:R.comprehensionCorrect,tlxMental:R.tlxMental,tlxTemporal:R.tlxTemporal,timestamp:new Date().toISOString()}),f(K=>({...K,postTrust:R.postTrust,comprehensionAnswer:R.comprehensionAnswer,comprehensionCorrect:R.comprehensionCorrect})),V(!1),I(!0),await ye()},preTrust:t.preTrust,caseId:((Si=t.currentCase)==null?void 0:Si.caseId)||"",aiFDR:15,aiFOR:8,includeTLX:_==="RESEARCHER",viewMode:_}),n&&F.current&&e.jsx(_n,{isVisible:n,onClose:()=>g(!1),sessionId:t.sessionId,caseResults:t.caseResults,events:F.current.getEvents(),ledger:F.current.getLedger(),condition:t.condition,exportManifest:t.exportManifest,exportManifestEntries:t.exportManifestEntries,verifierOutput:t.verifierOutput,verifierResult:t.verifierResult,tamperDetected:a,viewMode:_}),e.jsx(fn,{}),e.jsx(hn,{})]})};Ji.createRoot(document.getElementById("root")).render(e.jsx(mt.StrictMode,{children:e.jsx(Yn,{})}));
